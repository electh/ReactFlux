import{p as tt,m as oe,u as p,r as g,d as M,P as Vs,i as $s,o as Mt,a as zs,b as Bs,c as Hs,e as $,M as j,C as qs,j as e,f as X,g as Oe,A as Ks,I as Ws,T as k,S as Ee,h as st,k as Ot,l as Gs,n as Ys,q as rt,s as Js,t as Xs,v as ee,w as Ue,B as I,x as Qs,D as Zs,y as me,z as ae,E as nt,F as er,G as tr,H as sr,J as St,K as Ut,L as rr,N as ye,O as nr,Q as Vt,R as Z,U as ar,V as or,W as ir,X as lr,Y as cr,Z as B,_ as Y,$ as A,a0 as wt,a1 as L,a2 as se,a3 as H,a4 as dr,a5 as at,a6 as Ct,a7 as $t,a8 as ur,a9 as zt,aa as Bt,ab as hr,ac as ne,ad as pr,ae as fr,af as gr,ag as mr,ah as xr,ai as yr,aj as _r,ak as jr,al as br,am as vr,an as Ht,ao as qt,ap as ot,aq as Sr,ar as wr,as as Kt,at as R,au as Cr,av as kr,aw as Tr,ax as Ar,ay as Ir,az as Wt,aA as Ve,aB as Gt,aC as Yt,aD as Fe,aE as Er,aF as Fr,aG as Lr,aH as Pr,aI as Nr,aJ as Rr,aK as Ye,aL as Dr,aM as Jt,aN as Mr,aO as Or,aP as Ur,aQ as it,aR as Vr,aS as kt,aT as $r,aU as zr,aV as Br,aW as Hr,aX as qr,aY as Kr,aZ as Wr,a_ as Gr}from"./vendor-DjBkOH20.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();const Yr="modulepreload",Jr=function(t){return"/"+t},Tt={},fe=function(s,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),o=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(r.map(u=>{if(u=Jr(u),u in Tt)return;Tt[u]=!0;const d=u.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Yr,d||(h.as="script"),h.crossOrigin="",h.href=u,o&&h.setAttribute("nonce",o),document.head.appendChild(h),d)return new Promise((f,x)=>{h.addEventListener("load",f),h.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return a.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return s().catch(i)})},Xr=(t,s,r)=>{const n=t[s];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},Qr=()=>{const{language:t}=S.get(),s=lt();return t||s},lt=()=>{const t=navigator.language;return t==="zh-Hans-CN"?"zh-CN":t},Je={articleWidth:90,fontFamily:"system-ui",fontSize:1.05,highlightTheme:"OneDark",homePage:"all",language:lt(),layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showUnreadFeedsOnly:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},S=tt("settings",Je,{encode:JSON.stringify,decode:t=>{const s=JSON.parse(t);return{...Je,...s}}}),O=t=>S.get()[t],V=t=>S.set({...S.get(),...t}),Zr=()=>S.set(Je),T=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},E=oe({polyglot:null}),en=T(E,"polyglot"),tn=async(t,s)=>{let r,n=t;try{r=await Xr(Object.assign({"../locales/en-US.json":()=>fe(()=>import("./en-US-ChexL3K0.js"),[]),"../locales/es-ES.json":()=>fe(()=>import("./es-ES-DsUIXYj5.js"),[]),"../locales/zh-CN.json":()=>fe(()=>import("./zh-CN-Cqs_cN0o.js"),[])}),`../locales/${t}.json`,3)}catch(a){console.error("Failed to load language: ",a),r=await fe(()=>import("./en-US-ChexL3K0.js"),[]),n="en-US"}{const a=new Vs({phrases:r.default,locale:n});en(a)}},Xt=()=>{const{language:t}=p(S);g.useEffect(()=>{t?(tn(t),t==="zh-CN"?M.locale("zh-cn"):t==="es"||t.startsWith("es-")?M.locale("es"):M.locale("en")):V({language:lt()})},[t])},$e=oe({addFeedModalVisible:!1,settingsModalVisible:!1,settingsTabsActiveTab:"1"}),sn=T($e,"addFeedModalVisible"),rn=T($e,"settingsModalVisible"),nn=T($e,"settingsTabsActiveTab"),ze=()=>{const{addFeedModalVisible:t,settingsModalVisible:s,settingsTabsActiveTab:r}=p($e);return{addFeedModalVisible:t,setAddFeedModalVisible:sn,settingsModalVisible:s,setSettingsModalVisible:rn,settingsTabsActiveTab:r,setSettingsTabsActiveTab:nn}},ie=()=>{const[t,s]=g.useState(window.innerWidth),r=t<=768,n=t<=992;return g.useEffect(()=>{const a=()=>s(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},Xe={server:"",token:"",username:"",password:""},Be=tt("auth",Xe,{encode:JSON.stringify,decode:t=>{const s=JSON.parse(t);return{...Xe,...s}}}),Qt=t=>Be.set(t),an=()=>Qt(Xe),on=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},Le=t=>{const{server:s,token:r,username:n,password:a}=t;return!s||!$s(s,{require_protocol:!0})&&!on(s)?!1:r||n&&a},ln=()=>Mt.create({retry:3,onRequest({_request:t,options:s}){const r=Be.get();if(!Le(r))throw new Error("Invalid auth");const{server:n,token:a,username:i,password:l}=r;s.baseURL=n,s.headers=a?{"X-Auth-Token":a}:{Authorization:`Basic ${btoa(`${i}:${l}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var i;s.status===401&&(localStorage.removeItem("auth"),await Ps.navigate("/login"));const a=((i=s._data)==null?void 0:i.error_message)??s.statusText;throw console.error("Response error: ",a),new Error(a)}}),w=ln();w.get=t=>w(t,{method:"GET"});w.post=(t,s)=>w(t,{method:"POST",body:s});w.put=(t,s)=>w(t,{method:"PUT",body:s});const cn=async()=>w.get("/v1/categories"),dn=async t=>w.post("/v1/categories",{title:t}),un=async t=>w.raw(`/v1/categories/${t}`,{method:"DELETE"}),hn=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return w.put(`/v1/categories/${t}`,n)},pn=async t=>w.put(`/v1/categories/${t}/mark-all-as-read`);M.extend(zs);M.extend(Bs);M.extend(Hs);const fn=t=>M(t).isAfter(M().subtract(24,"hour")),gn=()=>M().subtract(24,"hour").unix(),mn=()=>M().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),xn=t=>M(t).format("dddd, MMMM D, YYYY h:mm A"),Zt=(t,s)=>{const{polyglot:r}=E.get();if(!s){const m=M(),_=M(t),v=_.from(m),C=M.duration(m.diff(_)).asSeconds();return C>=0&&C<60?r.t("date.just_now"):v}const n=M(),i=M(t).diff(n),l=M.duration(Math.abs(i)),o=l.years(),u=l.months(),d=l.days(),c=l.hours(),h=l.minutes(),f=[];if(o>0&&f.push(r.t("date.years",o)),u>0&&f.push(r.t("date.months",u)),d>0&&f.push(r.t("date.days",d)),c>0&&f.push(r.t("date.hours",c)),h>0&&f.push(r.t("date.minutes",h)),f.length===0)return r.t("date.just_now");const x=f.join(" ");return i>0?r.t("date.in_time",{time:x}):r.t("date.time_ago",{time:x})},es=t=>{const{polyglot:s}=E.get(),r=s.t("date.minutes",t);return s.t("article_card.reading_time",{time:r})},He=async(t,s)=>w.put("/v1/entries",{entry_ids:t,status:s}),yn=async t=>w.put(`/v1/entries/${t}/bookmark`),_n=async t=>w.get(`/v1/entries/${t}/fetch-content`),jn=async t=>w.raw(`/v1/entries/${t}/save`,{method:"POST"}),le=(t,s={})=>{const{baseUrl:r,orderField:n,offset:a,limit:i,status:l}=t,o=O("orderDirection"),u=new URLSearchParams({order:n,direction:o,offset:a,limit:i,...s});return l&&u.append("status",l),`${r}?${u}`},bn=async(t=0,s=null)=>{const r=O("orderBy"),n=O("pageSize"),a=O("showAllFeeds"),i={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s},l={globally_visible:!a};return w.get(le(i,l))},Ae=async(t=0,s=null,r=null)=>{const n=O("orderBy"),a=r??O("pageSize"),i=O("showAllFeeds"),l=gn(),o={baseUrl:"/v1/entries",orderField:n,offset:t,limit:a,status:s},u={globally_visible:!i,published_after:l};return w.get(le(o,u))},ts=async(t=0,s=null)=>{const r=O("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},a={starred:"true"};return w.get(le(n,a))},vn=async(t=0)=>{const s=O("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return w.get(le(r))},Sn=async()=>w.get("/v1/feeds"),wn=async()=>w.get("/v1/feeds/counters"),Cn=async t=>w.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),kn=async()=>w.raw("/v1/feeds/refresh",{method:"PUT"}),Tn=async(t,s,r)=>w.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),An=async t=>w.raw(`/v1/feeds/${t}`,{method:"DELETE"}),ss=async(t,s)=>{const{categoryId:r,title:n,siteUrl:a,feedUrl:i,hidden:l,disabled:o,isFullText:u}=s;return w.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:a,feed_url:i,hide_globally:l,disabled:o,crawler:u})},In=async t=>w.put(`/v1/feeds/${t}/mark-all-as-read`),En=async()=>w.get("/v1/me"),Fn=async t=>w.get(`/v1/icons/${t}`),Ln=async()=>w.get("/v1/version"),Pn=async()=>{const t=await En();return w.put(`/v1/users/${t.data.id}/mark-all-as-read`)},rs={isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1},D=oe(rs),ct=$(D,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(a=>({...a,unreadCount:s[a.id]??0})).sort((a,i)=>a.title.localeCompare(i.title,"en"))}),_e=$([D,ct],(t,s)=>{const{categoriesData:r}=t;return r.map(a=>{const i=s.filter(l=>l.category.id===a.id);return{...a,unreadCount:i.reduce((l,o)=>l+(o.unreadCount??0),0),feedCount:i.length}}).sort((a,i)=>a.title.localeCompare(i.title,"en"))}),ns=$(_e,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),dt=$([ct,ns],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),as=$([ct,dt,S],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),Nn=$([_e,ns,S],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),os=$(as,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),Rn=$([D,as],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[a,i])=>s.some(l=>l.id===Number(a))?n+i:n,0)}),Ie=T(D,"categoriesData"),re=T(D,"feedsData"),Pe=T(D,"historyCount"),At=T(D,"isAppDataReady"),Ne=T(D,"starredCount"),ut=T(D,"unreadInfo"),ht=T(D,"unreadTodayCount"),Dn=T(D,"isVersionAtLeast2_2_0"),Mn=()=>D.set(rs),is=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(i=>i.id===n.id)||n)},Qe=(t,s)=>{const r={};let n=0;const a=t.filter(d=>d.status!==s);if(a.length===0)return;const{showStatus:i}=S.get();s==="read"?(Pe(d=>d+a.length),i==="unread"&&Me(d=>d-a.length)):(Pe(d=>Math.max(0,d-a.length)),i==="unread"&&Me(d=>d+a.length));for(const d of a){const c=d.feed.id,h=fn(d.published_at),f=s==="read"?-1:1;r[c]=(r[c]??0)+f,n+=h?f:0}ht(d=>Math.max(0,d+n)),ut(d=>{const c={...d};for(const[h,f]of Object.entries(r))c[h]=Math.max(0,(c[h]??0)+f);return c});const l=a.map(d=>({...d,status:s})),{activeContent:o}=F.get(),u=l.find(d=>d.id===(o==null?void 0:o.id));u&&G(u),be(d=>is(d,l))},qe=()=>{const{activeContent:t}=p(F),{polyglot:s}=p(E),r=(u,d)=>{Qe([u],d)},n=(u,d)=>{d?(Ne(h=>h+1),qs({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Ne(h=>Math.max(0,h-1));const c={...u,starred:d};t&&G(c),be(h=>is(h,[c]))};return{handleEntryStatusUpdate:r,handleFetchContent:async()=>{try{const u=await _n(t.id);j.success(s.t("actions.fetched_content_success")),G({...t,content:u.content})}catch(u){console.error("Failed to fetch content: ",u),j.error(s.t("actions.fetched_content_error"))}},handleSaveToThirdPartyServices:async()=>{try{(await jn(t.id)).status===202?j.success(s.t("actions.saved_to_third-party_services_success")):j.error(s.t("actions.saved_to_third-party_services_error"))}catch(u){console.error("Failed to save to third-party services: ",u),j.error(s.t("actions.saved_to_third-party_services_error"))}},handleToggleStarred:async u=>{const d=!u.starred;n(u,d),yn(u.id).catch(()=>{j.error(d?s.t("actions.star_error"):s.t("actions.unstar_error")),n(u,!d)})},handleToggleStatus:async u=>{const d=u.status,c=d==="read"?"unread":"read";r(u,c),He([u.id],c).catch(()=>{j.error(c==="read"?s.t("actions.mark_as_read_error"):s.t("actions.mark_as_unread_error")),r(u,d)})}}},On=(t,s)=>{const{polyglot:r}=E.get();if(t.length===0||s==="none")return t;const n=t.map((c,h)=>({id:c.id,index:h})),a=new Map,i=new Map,l=new Map,o=[],u=t.slice().sort((c,h)=>c.id-h.id).filter(c=>{const{hash:h,title:f,url:x,id:m}=c;switch(s){case"hash":if(a.has(h))return o.push(c),!1;a.set(h,m);break;case"title":if(i.has(f))return o.push(c),!1;i.set(f,m);break;case"url":if(l.has(x))return o.push(c),!1;l.set(x,m);break;default:return!0}return!0}),d=o.filter(c=>c.status==="unread").map(c=>c.id);return d.length>0&&(Qe(o,"read"),He(d,"read").catch(()=>{j.error(r.t("deduplicate.mark_as_read_error")),Qe(o,"unread")})),u.sort((c,h)=>{const f=n.find(m=>m.id===c.id).index,x=n.find(m=>m.id===h.id).index;return f-x})},Un=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},Se=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,a=r?s.toLowerCase():s;if(a.length===0)return 0;const i=Un(a);let l=0,o=0;for(;l<n.length;)if(n[l]===a[o]?(l++,o++):o!==0?o=i[o-1]:l++,o===a.length)return l-o;return-1},Vn=t=>{const s=[],r=[];let n=[];const a=[],i=t.match(/([-+|]?)\s*"([^"]+)"/g);let l=t;i&&(n=i.map(u=>{const d=u.trim()[0],c=u.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(c);break;case"+":s.push(c);break;case"|":a.push([c]);break;default:s.push(c);break}return c}),l=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const o=l.split(/\s+/);for(const u of o){const d=u.replace(/^[-+|]/,"");if(u.startsWith("-")&&d)r.push(d);else if(u.startsWith("+")&&d)s.push(d);else if(u.includes("|")){const c=u.split("|").filter(h=>h);c.length>0&&a.push(c)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:a}},$n=(t,s,r=[],n=!0)=>{const{includeTerms:a,excludeTerms:i,exactPhrases:l,orConditions:o}=Vn(s),u=d=>{if(i.some(f=>Se(d,f,n)!==-1)||l.length>0&&!l.some(f=>Se(d,f,n)!==-1))return!1;const c=a.every(f=>Se(d,f,n)!==-1),h=o.length===0||o.some(f=>f.some(x=>Se(d,x,n)!==-1));return c&&h};return t.filter(d=>r.some(c=>{const h=d[c];return typeof h=="string"&&u(n?h.toLowerCase():h)}))},ls=(t,s,r=[],n=!0)=>!Array.isArray(t)||t.length===0?(console.error("Invalid data input:",{receivedData:t,type:typeof t,isArray:Array.isArray(t),length:Array.isArray(t)?t.length:"N/A"}),[]):typeof s!="string"||s.trim().length===0?(console.error("Invalid query input:",{receivedQuery:s,type:typeof s,trimmedLength:typeof s=="string"?s.trim().length:"N/A"}),[]):$n(t,s,r,n),zn=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),Bn=(t,s,r)=>r?ls(t,r,[s]):t,cs={activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:O("homePage"),isArticleListReady:!1,isArticleLoading:!1,loadMoreVisible:!1,offset:0,total:0},F=oe(cs),je=$([F,D,dt,S],(t,s,r,n)=>{const{entries:a,filterString:i,filterType:l,infoFrom:o}=t,u=Bn(a,l,i),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:c,showAllFeeds:h}=n,f=!["starred","history"].includes(o),x=_=>d||h||!r.includes(_.feed.id),m=f?u.filter(x):u;return c==="none"||["starred","history"].includes(o)?m:On(m,c)}),pt=$([F,je],(t,s)=>{const{activeContent:r}=t;return r?s.findIndex(n=>n.id===r.id):-1}),ds=$([pt,je],(t,s)=>s[t-1]),us=$([pt,je],(t,s)=>s[t+1]),G=T(F,"activeContent"),be=T(F,"entries"),Re=T(F,"filterString"),De=T(F,"filterType"),Hn=T(F,"infoFrom"),It=T(F,"isArticleListReady"),Et=T(F,"isArticleLoading"),hs=T(F,"loadMoreVisible"),Me=T(F,"offset"),qn=T(F,"total"),Kn=()=>F.set(cs),Ft=oe(),we=new Set,Wn=t=>{const s=p(Ft);return g.useEffect(()=>{s[t]||we.has(t)||(we.add(t),Fn(t).then(r=>{const n=`data:${r.data}`;Ft.setKey(t,n),we.delete(t)}).catch(()=>{we.delete(t)}))},[t,s]),s[t]},Gn=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},Lt=t=>{const s=Gn(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},Yn=t=>`https://icons.duckduckgo.com/ip3/${Lt(t.site_url)??Lt(t.feed_url)}.ico`,ps=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,n=Yn(t),[a,i]=g.useState(n),l=Wn(r);return g.useEffect(()=>{l&&i(l)},[l]),r===0?e.jsx("img",{className:s,src:n,alt:"",style:{borderRadius:"20%"}}):e.jsx("img",{className:s,src:a,alt:"",onError:()=>i(n),style:{borderRadius:"20%"}})},fs=X.Item,Jn=({category:t,path:s})=>{var l;const n=(l=p(os)[t.id])==null?void 0:l.reduce((o,u)=>o+u.unreadCount,0),a=ee(),i=()=>{a(`/category/${t.id}`),G(null)};return e.jsxs("div",{className:Ue("category-title",{"submenu-active":s===`/category/${t.id}`,"submenu-inactive":s!==`/category/${t.id}`}),onClick:i,onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&i()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(k.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(k.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},Xn=({count:t})=>e.jsx(k.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),Ce=({path:t,Icon:s,label:r,count:n})=>{const a=Oe(),i=ee(),l=a.pathname===t,o=()=>{i(t),G(null)};return e.jsx(fs,{onClick:o,className:Ue("arco-menu-item",{"arco-menu-selected":l}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(Xn,{count:n})]})},t)},Qn=()=>{const{historyCount:t,starredCount:s,unreadTodayCount:r}=p(D),{polyglot:n}=p(E),a=p(Rn);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{path:"/all",Icon:Gs,label:n.t("sidebar.all"),count:a}),e.jsx(Ce,{path:"/today",Icon:Ys,label:n.t("sidebar.today"),count:r}),e.jsx(Ce,{path:"/starred",Icon:rt,label:n.t("sidebar.starred"),count:s}),e.jsx(Ce,{path:"/history",Icon:Js,label:n.t("sidebar.history"),count:t})]})},Zn=({feed:t})=>{const{showFeedIcon:s}=p(S),r=ee();return e.jsx(fs,{style:{position:"relative",overflow:"hidden"},onClick:n=>{n.stopPropagation(),r(`/feed/${t.id}`),G(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(k.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:t.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[s&&e.jsx(ps,{feed:t,className:"feed-icon-sidebar"}),t.title]}),t.unreadCount!==0&&e.jsx(k.Ellipsis,{className:"item-count",expandable:!1,children:t.unreadCount})]})},`/feed/${t.id}`)},ea=({categoryId:t})=>{var n;const{showUnreadFeedsOnly:s}=p(S),r=p(os);return e.jsx(e.Fragment,{children:(n=r[t])==null?void 0:n.filter(a=>!s||a.unreadCount>0).map(a=>e.jsx(Zn,{feed:a},`/feed/${a.id}`))})},ta=()=>{const{showUnreadFeedsOnly:t}=p(S),s=p(Nn),n=Oe().pathname;return s.filter(a=>!t||a.unreadCount>0).map(a=>e.jsx(Ot.Item,{name:`/category/${a.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(Jn,{category:a,path:n}),expandIcon:e.jsx(Xs,{}),children:e.jsx(ea,{categoryId:a.id})},a.id))},gs=()=>{const{homePage:t}=p(S),{isAppDataReady:s}=p(D),{polyglot:r}=p(E),n=Oe(),[a,i]=g.useState([`/${t}`]),l=n.pathname;return g.useEffect(()=>{i([l])},[l]),e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(X,{hasCollapseButton:!1,selectedKeys:a,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(Ks,{className:"avatar",size:32,children:e.jsx(Ws,{style:{color:"var(--color-bg-1)"}})}),e.jsx(k.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(k.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:r.t("sidebar.articles")}),e.jsx(Ee,{loading:!s,animation:!0,text:{rows:3}}),s&&e.jsx(Qn,{}),e.jsx(k.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:r.t("sidebar.feeds")})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx(st,{style:{maxHeight:"100%"},children:e.jsxs(X,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:a,children:[e.jsx(Ee,{loading:!s,animation:!0,text:{rows:6}}),s&&e.jsx(Ot,{triggerRegion:"icon",bordered:!1,children:e.jsx(ta,{})})]})})})]})},sa=()=>{const{showAllFeeds:t,theme:s}=p(S),{polyglot:r}=p(E),n=[{label:r.t("header.theme_option_light"),value:"light"},{label:r.t("header.theme_option_dark"),value:"dark"},{label:r.t("header.theme_option_system"),value:"system"}],a=ee(),i=Oe().pathname,{setAddFeedModalVisible:l,setSettingsModalVisible:o}=ze(),{isBelowLarge:u}=ie(),[d,c]=g.useState(!1),[h,f]=g.useState(!1),[x,m]=g.useState(!1);g.useEffect(()=>{u||c(!1)},[u]),g.useEffect(()=>{i&&c(!1)},[i]);const _=()=>{V({showAllFeeds:!t})},v=()=>{V({theme:s==="light"?"dark":"light"})},C=()=>{Zr(),f(!1)},U=()=>{an(),Kn(),Mn(),a("/login"),j.success(r.t("header.logout_success"))},N=()=>s==="dark"?e.jsx(ar,{}):s==="system"?e.jsx(or,{}):e.jsx(ir,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(I,{className:"trigger",onClick:()=>c(!d),shape:"circle",size:"small",children:e.jsx(Qs,{})})}),e.jsx(Zs,{className:"sidebar-drawer",visible:d,title:null,footer:null,closable:!1,onCancel:()=>c(!1),placement:"left",width:240,children:e.jsx(gs,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(me,{size:16,children:[e.jsx(ae,{content:r.t("header.add_feed"),mini:!0,children:e.jsx(I,{shape:"circle",size:"small",type:"primary",icon:e.jsx(nt,{}),onClick:()=>l(!0)})}),e.jsx(ae,{content:t?r.t("header.hide_some_feeds"):r.t("header.show_all_feeds"),mini:!0,children:e.jsx(I,{shape:"circle",size:"small",icon:t?e.jsx(er,{}):e.jsx(tr,{}),onClick:_})}),e.jsx(I,{shape:"circle",size:"small",icon:e.jsx(sr,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(St,{droplist:e.jsx(X,{defaultSelectedKeys:[s],className:"theme-menu",children:n.map(({label:y,value:b})=>e.jsxs(X.Item,{className:"theme-menu-item",onClick:()=>V({theme:b}),children:[y,s===b&&e.jsx(Ut,{style:{marginLeft:8}})]},b))}),children:e.jsx(I,{icon:N(),shape:"circle",size:"small",onClick:v})}),e.jsx(St,{droplist:e.jsxs(X,{children:[e.jsxs(X.Item,{onClick:()=>o(!0),children:[e.jsx(rr,{className:"icon-right"}),r.t("header.settings")]},"0"),e.jsxs(X.Item,{onClick:()=>f(!0),children:[e.jsx(ye,{className:"icon-right"}),r.t("header.reset_settings")]},"1"),e.jsxs(X.Item,{onClick:()=>m(!0),children:[e.jsx(nr,{className:"icon-right"}),r.t("header.logout")]},"2")]}),trigger:"click",children:e.jsx(I,{icon:e.jsx(Vt,{}),shape:"circle",size:"small"})})]})}),e.jsx(Z,{title:r.t("header.settings_reset_confirm"),visible:h,onOk:C,onCancel:()=>f(!1),children:e.jsx("p",{children:r.t("header.settings_reset_description")})}),e.jsx(Z,{title:r.t("header.logout_confirm"),visible:x,onOk:U,onCancel:()=>m(!1),children:e.jsx("p",{children:r.t("header.logout_description")})})]})},ra=(t,s)=>{const r=t.split("."),n=s.split(".");for(let a=0;a<Math.max(r.length,n.length);a++){const i=r[a]||"0",l=n[a]||"0",o=i.localeCompare(l,void 0,{numeric:!0});if(o!==0)return o}return 0},ft=()=>{const t=g.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,At(!1);try{const r=await Promise.all([wn(),Ae(0,"unread"),ts(),Sn(),cn(),Ln()]),[n,a,i,l,o,u]=r,d=l.reduce((h,f)=>(h[f.id]=n.unreads[f.id]??0,h),{}),c=Object.values(n.reads).reduce((h,f)=>h+f,0);ut(d),ht(a.total??0),Ne(i.total??0),Pe(c),re(l),Ie(o),Dn(ra(u.version,"2.2.0")>=0),At(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},ms=g.createContext(),na=({children:t})=>{const s=p(E),r=g.useRef(null),n=g.useRef(null),{handleEntryStatusUpdate:a}=qe(),i=g.useCallback(async o=>{Et(!0),G({...o,status:"read"}),setTimeout(()=>{const u=r.current;if(u){const d=u.querySelector(".simplebar-content-wrapper");d&&d.scroll({top:0}),u.focus()}Et(!1),o.status==="unread"&&(a(o,"read"),He([o.id],"read").catch(()=>{j.error(s.t("content.mark_as_read_error")),G({...o,status:"unread"}),a(o,"unread")}))},200)},[s,a]),l=g.useMemo(()=>({entryDetailRef:r,entryListRef:n,handleEntryClick:i,setActiveContent:G}),[i]);return e.jsx(ms.Provider,{value:l,children:t})},xs=()=>g.useContext(ms),Ze={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Green:{light:"#00B42A",dark:"#27C346"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Magenta:{light:"#F5319D",dark:"#F756A9"}},xe=t=>{const s=Ze[t]||Ze.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=O("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},ys=t=>{lr(xe(t),{list:!0}).map(cr).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},z=({title:t,description:s,children:r})=>e.jsxs("section",{className:"setting-row",children:[e.jsxs("header",{children:[e.jsx(k.Title,{heading:6,style:{marginTop:0},children:t}),e.jsx(k.Text,{type:"secondary",children:s})]}),r]}),aa=()=>{const{articleWidth:t,fontSize:s,fontFamily:r,layout:n,showDetailedRelativeTime:a,showFeedIcon:i,themeColor:l}=p(S),{polyglot:o}=p(E),u=[{label:o.t("appearance.font_family_system"),value:"system-ui"},{label:"Sans-serif",value:"sans-serif"},{label:"Serif",value:"serif"},{label:"Fira Sans",value:"'Fira Sans', sans-serif"},{label:"Open Sans",value:"'Open Sans', sans-serif"},{label:"Source Sans Pro",value:"'Source Sans Pro', sans-serif"},{label:"Source Serif Pro",value:"'Source Serif Pro', serif"},{label:o.t("appearance.font_family_noto_sans"),value:"'Noto Sans SC', sans-serif"},{label:o.t("appearance.font_family_noto_serif"),value:"'Noto Serif SC', serif"},{label:o.t("appearance.font_family_lxgw_wenkai"),value:"'LXGW WenKai Screen', sans-serif"}],d=c=>{V(c),c.themeColor&&ys(c.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:o.t("appearance.theme_color_label"),description:o.t("appearance.theme_color_description"),children:e.jsx("div",{style:{display:"flex"},children:Object.keys(Ze).map(c=>e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:xe(c),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:c===l?`1px solid ${xe(c)}`:"none"},onClick:()=>d({themeColor:c}),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&d({themeColor:c})},"aria-label":o.t("appearance.theme_color_aria_label",{color:c}),role:"button",tabIndex:0},c))})}),e.jsx(B,{}),e.jsx(z,{title:o.t("appearance.compact_article_list_label"),description:o.t("appearance.compact_article_list_description"),children:e.jsx(Y,{checked:n==="small",onChange:c=>d({layout:c?"small":"large"})})}),e.jsx(B,{}),e.jsx(z,{title:o.t("appearance.show_detailed_relative_time_label"),description:o.t("appearance.show_detailed_relative_time_description"),children:e.jsx(Y,{checked:a,onChange:c=>d({showDetailedRelativeTime:c})})}),e.jsx(B,{}),e.jsx(z,{title:o.t("appearance.show_feed_icon_label"),description:o.t("appearance.show_feed_icon_description"),children:e.jsx(Y,{checked:i,onChange:c=>d({showFeedIcon:c})})}),e.jsx(B,{}),e.jsx(z,{title:o.t("appearance.font_family_label"),description:o.t("appearance.font_family_description"),children:e.jsx(A,{style:{width:166},value:r,onChange:c=>d({fontFamily:c}),children:u.map(({label:c,value:h})=>e.jsx(A.Option,{value:h,children:c},h))})}),e.jsx(B,{}),e.jsx(z,{title:o.t("appearance.font_size_label"),description:o.t("appearance.font_size_description"),children:e.jsxs(me,{children:[e.jsx(k.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(wt,{formatTooltip:c=>`${c}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:c=>d({fontSize:c})}),e.jsx(k.Text,{style:{fontSize:"1.25rem"},children:"A"})]})}),e.jsx(B,{}),e.jsx(z,{title:o.t("appearance.article_width_label"),description:o.t("appearance.article_width_description"),children:e.jsxs(me,{children:[e.jsx(k.Text,{children:"60%"}),e.jsx(wt,{formatTooltip:c=>`${c}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:c=>d({articleWidth:c})}),e.jsx(k.Text,{children:"90%"})]})})]})},oa=()=>{const t=p(_e),{polyglot:s}=p(E),[r]=L.useForm(),[n,a]=g.useState(!1),[i,l]=g.useState(""),[o,u]=g.useState({}),[d,c]=g.useState(!1),h=async()=>{if(!i.trim()){c(!1);return}try{const m=await dn(i);Ie(_=>[..._,{...m}]),j.success(s.t("category_list.add_category_success"))}catch(m){console.error(`${s.t("category_list.add_category_error")}: `,m),j.error(s.t("category_list.add_category_error"))}l(""),c(!1)},f=async(m,_,v)=>{try{const C=await hn(m,_,v);re(U=>U.map(N=>N.category.id===m?{...N,category:{...N.category,title:_,hide_globally:v}}:N)),Ie(U=>U.map(N=>N.id===m?{...N,...C}:N)),j.success(s.t("category_list.update_category_success"))}catch{j.error(s.t("category_list.update_category_error"))}a(!1),r.resetFields()},x=async m=>{try{(await un(m.id)).status===204?(Ie(v=>v.filter(C=>C.id!==m.id)),j.success(s.t("category_list.remove_category_success",{title:m.title}))):j.error(s.t("category_list.remove_category_error",{title:m.title}))}catch(_){console.error(s.t("category_list.remove_category_error",{title:m.title}),_),j.error(s.t("category_list.remove_category_error",{title:m.title}))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(m=>e.jsx(se,{className:"tag-style",closable:m.feedCount===0,size:"medium",onClick:()=>{u(m),a(!0),r.setFieldsValue({title:m.title})},onClose:async _=>{_.stopPropagation(),await x(m)},children:m.title},m.id)),d?e.jsx(H,{autoFocus:!0,className:"input-style",onBlur:h,onChange:l,onPressEnter:h,size:"small",value:i}):e.jsx(se,{className:"add-category-tag",icon:e.jsx(nt,{}),onClick:()=>c(!0),size:"medium",tabIndex:0})]}),o&&e.jsx(Z,{className:"modal-style",onOk:r.submit,title:s.t("category_list.edit_category_title"),unmountOnExit:!0,visible:n,onCancel:()=>{a(!1),r.resetFields()},children:e.jsxs(L,{form:r,layout:"vertical",onSubmit:m=>f(o.id,m.title,m.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(L.Item,{label:s.t("category_list.edit_category_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(H,{placeholder:s.t("category_list.edit_category_title_placeholder")})}),e.jsx(L.Item,{label:s.t("category_list.edit_category_hidden_label"),field:"hidden",initialValue:o.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Y,{})})]})})]})},ia=t=>new Promise(s=>setTimeout(s,t)),la=(t,s,r=!1)=>{let n;return function(...a){const i=()=>{n=null,r||t.apply(this,a)},l=r&&!n;clearTimeout(n),n=setTimeout(i,s),l&&t.apply(this,a)}},_s=({url:t,text:s})=>{const[r,n]=g.useState(!1),a=()=>n(!r);return e.jsx(dr,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:a,onMouseLeave:a,children:s})},js=at(""),Pt=T(js),gt=at("title"),ca=T(gt),mt=$([D,js,gt],(t,s,r)=>{const{feedsData:n}=t,a=[...n].sort((i,l)=>i.disabled&&!l.disabled?1:!i.disabled&&l.disabled?-1:0).sort((i,l)=>l.parsing_error_count-i.parsing_error_count);return s?ls(a,s,[r]):a}),da=$(mt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),bs=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:mn()}:t,vs=async(t,s,r=!0)=>{const{polyglot:n}=E.get();try{const i=(await t()).status===204;return r&&(i?j.success(n.t("feed_table.refresh_success")):j.error(n.t("feed_table.refresh_error"))),re(l=>l.map(o=>s(o,i))),i}catch(a){return console.error("Failed to refresh feed: ",a),r&&j.error(n.t("feed_table.refresh_error")),re(i=>i.map(l=>s(l,!1))),!1}},Ss=async(t,s=!0)=>{const r=t.id||t.key;return vs(()=>Cn(r),(n,a)=>bs(n,a,r),s)},ua=({visible:t,setVisible:s})=>{const{polyglot:r}=p(E),n=p(mt),a=async()=>{s(!1),await vs(kn,bs)},i=async()=>{s(!1);const o=n.filter(c=>c.parsing_error_count>0);j.success(r.t("feed_table.bulk_refresh_error_feeds_message"));let u=0,d=0;for(const c of o)await Ss(c,!1)?u++:d++,await ia(500);j.success(r.t("feed_table.bulk_refresh_error_feeds_result",{success:u,failure:d}))},l=()=>s(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:e.jsx(ye,{}),shape:"circle",size:"small",onClick:()=>s(!0)}),e.jsx(Z,{className:"edit-modal",onCancel:l,title:r.t("feed_table.refresh_feeds_title"),visible:t,footer:[e.jsx(I,{onClick:l,children:r.t("feed_table.refresh_feeds_cancel")},"cancel"),e.jsx(I,{type:"outline",onClick:i,children:r.t("feed_table.refresh_feeds_error")},"error"),e.jsx(I,{type:"primary",onClick:a,children:r.t("feed_table.refresh_feeds_all")},"all")],children:e.jsx("p",{children:r.t("feed_table.refresh_feeds_description")})})]})},ha=({visible:t,setVisible:s})=>{const{polyglot:r}=p(E),n=p(mt),[a,i]=g.useState(""),l=async()=>{try{const o=await Promise.all(n.map(async d=>{const c=new URL(d.feed_url).hostname;if(c===a)return d;const h=d.feed_url.replace(c,a),f=await ss(d.id,{feedUrl:h});return{...d,...f}})),u=(d,c)=>c.find(f=>f.id===d.id)||d;re(d=>d.map(c=>u(c,o))),j.success(r.t("feed_table.bulk_update_success")),s(!1)}catch(o){console.error("Failed to bulk update feeds: ",o),j.error(r.t("feed_table.bulk_update_error"))}};return e.jsxs(Z,{className:"edit-modal",onOk:l,title:r.t("feed_table.modal_bulk_update_title"),visible:t,onCancel:()=>{s(!1),i("")},children:[e.jsx("p",{children:r.t("feed_table.modal_bulk_update_description")}),e.jsx(H,{placeholder:"rsshub.app",value:a,onChange:o=>i(o)})]})},pa=({visible:t,setVisible:s,feedForm:r,selectedFeed:n})=>{const{polyglot:a}=p(E),i=p(_e),l=async(o,u)=>{try{const d=await ss(o,u);re(c=>c.map(h=>h.id===o?{...h,...d}:h)),j.success(a.t("feed_table.update_feed_success")),s(!1),r.resetFields()}catch(d){console.error("Failed to update feed: ",d),j.error(a.t("feed_table.update_feed_error"))}};return e.jsx(Z,{className:"edit-modal",onOk:r.submit,title:a.t("feed_table.modal_edit_feed_title"),unmountOnExit:!0,visible:t,onCancel:()=>{s(!1),r.resetFields()},children:e.jsxs(L,{form:r,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async o=>{const u={categoryId:o.category,title:o.title,siteUrl:o.siteUrl.trim(),feedUrl:o.feedUrl.trim(),hidden:o.hidden,disabled:o.disabled,isFullText:o.crawler};u.feedUrl?await l(n.key,u):j.error(a.t("feed_table.modal_edit_feed_submit_error"))},children:[e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_category_label"),required:!0,field:"category",rules:[{required:!0}],children:e.jsx(A,{children:i.map(o=>e.jsx(A.Option,{value:o.id,children:o.title},o.id))})}),e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(H,{placeholder:a.t("feed_table.modal_edit_feed_title_placeholder")})}),e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_site_url_label"),field:"siteUrl",rules:[{required:!0}],children:e.jsx(H,{placeholder:a.t("feed_table.modal_edit_feed_site_url_placeholder")})}),e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_feed_url_label"),field:"feedUrl",rules:[{required:!0}],children:e.jsx(H,{placeholder:a.t("feed_table.modal_edit_feed_feed_url_placeholder")})}),e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_hidden_label"),field:"hidden",initialValue:n.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Y,{})}),e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_disabled_label"),field:"disabled",initialValue:n.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Y,{})}),e.jsx(L.Item,{label:a.t("feed_table.modal_edit_feed_crawler_label"),field:"crawler",tooltip:e.jsx("div",{children:a.t("feed_table.modal_edit_feed_crawler_tooltip")}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Y,{})})]})})},fa=()=>{const{isAppDataReady:t}=p(D),{showDetailedRelativeTime:s}=p(S),r=p(gt),n=p(da),{polyglot:a}=p(E),i=a.t("search.tooltip").split(`
`),[l,o]=g.useState(!1),[u,d]=g.useState(!1),[c,h]=g.useState(!1),[f]=L.useForm(),[x,m]=g.useState(null),{isBelowMedium:_}=ie(),v=ee();g.useEffect(()=>{Pt("")},[]);const C=y=>{m(y),h(!0),f.setFieldsValue({category:y.category.id,title:y.title,siteUrl:y.site_url,feedUrl:y.feed_url,hidden:y.hidden,disabled:y.disabled,crawler:y.crawler})},U=async y=>{try{(await An(y.key)).status===204?(re(q=>q.filter(K=>K.id!==y.key)),j.success(a.t("feed_table.remove_feed_success",{title:y.title}))):j.error(a.t("feed_table.remove_feed_error",{title:y.title}))}catch(b){console.error(`Failed to unfollow feed: ${y.title}`,b),j.error(a.t("feed_table.remove_feed_error",{title:y.title}))}},N=[{title:a.t("feed_table.table_title"),dataIndex:"title",sorter:(y,b)=>y.title.localeCompare(b.title,"en"),render:(y,b)=>{const q=b.parsing_error_count;let K=b.disabled?`ðŸš« ${y}`:y;q>0&&(K=`âš ï¸ ${y}`);const te=e.jsxs("div",{children:[y,q>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"âš ï¸ Parsing error count: ",q]})]});return e.jsx(k.Ellipsis,{expandable:!1,children:e.jsx(ae,{mini:!0,content:te,children:e.jsx(_s,{url:`/feed/${b.key}`,text:K})})})}},!_&&{title:a.t("feed_table.table_url"),dataIndex:"feed_url",sorter:(y,b)=>y.feed_url.localeCompare(b.feed_url,"en"),render:y=>e.jsx(k.Ellipsis,{expandable:!1,showTooltip:!0,children:y})},{title:a.t("feed_table.table_category"),dataIndex:"category.title",sorter:(y,b)=>y.category.title.localeCompare(b.category.title,"en"),render:(y,b)=>e.jsx(k.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(se,{size:"small",style:{cursor:"pointer"},onClick:()=>v(`/category/${b.category.id}`),children:y})})},!_&&{title:a.t("feed_table.table_checked_at"),dataIndex:"checked_at",sorter:(y,b)=>y.checked_at.localeCompare(b.checked_at,"en"),render:y=>e.jsx(k.Ellipsis,{expandable:!1,children:Zt(y,s)})},{title:a.t("feed_table.table_actions"),dataIndex:"op",fixed:"right",width:100,render:(y,b)=>e.jsxs(me,{children:[e.jsx("button",{"aria-label":a.t("feed_table.table_feed_edit_label"),className:"list-item-action",onClick:()=>C(b),type:"button",children:e.jsx(Ct,{})}),e.jsx("button",{"aria-label":a.t("feed_table.table_feed_refresh_label"),className:"list-item-action",onClick:()=>Ss(b),type:"button",children:e.jsx(ye,{})}),e.jsx($t,{focusLock:!0,position:"left",title:a.t("feed_table.table_feed_remove_confirm"),onOk:()=>U(b),children:e.jsx("span",{className:"list-item-action",children:e.jsx(ur,{})})})]})}].filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"feed-table-action-bar",children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"left",minWidth:0},children:e.jsx(H.Search,{allowClear:!0,className:"search-input",onChange:Pt,placeholder:a.t("search.placeholder"),addBefore:e.jsxs(A,{onChange:ca,style:{width:80},triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},value:r,children:[e.jsx(A.Option,{value:"title",children:a.t("search.type_title")}),e.jsx(A.Option,{value:"feed_url",children:a.t("search.type_feed_url")}),e.jsx(A.Option,{value:"site_url",children:a.t("search.type_site_url")})]}),prefix:e.jsx(ae,{mini:!0,position:"bottom",content:e.jsx("div",{children:i.map((y,b)=>e.jsxs(g.Fragment,{children:[y,b<i.length-1&&e.jsx("br",{})]},`line-${b}-${y.length}`))}),children:e.jsx(zt,{})})})}),e.jsxs("div",{className:"button-group",children:[e.jsx(I,{icon:e.jsx(Ct,{}),shape:"circle",size:"small",onClick:()=>o(!0)}),e.jsx(ha,{visible:l,setVisible:o}),e.jsx(ua,{visible:u,setVisible:d})]})]}),e.jsx(Bt,{borderCell:!0,className:"feed-table",columns:N,data:n,loading:!t,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),x&&e.jsx(pa,{visible:c,setVisible:h,feedForm:f,selectedFeed:x})]})},ga=[{label:"English",value:"en-US"},{label:"EspaÃ±ol",value:"es-ES"},{label:"ç®€ä½“ä¸­æ–‡",value:"zh-CN"}],ma=()=>{const{homePage:t,language:s,markReadOnScroll:r,orderBy:n,pageSize:a,removeDuplicates:i,showUnreadFeedsOnly:l}=p(S),{polyglot:o}=p(E),u=[{label:o.t("settings.default_home_page_option_all"),value:"all"},{label:o.t("settings.default_home_page_option_today"),value:"today"},{label:o.t("settings.default_home_page_option_starred"),value:"starred"},{label:o.t("settings.default_home_page_option_history"),value:"history"}],d=[{label:o.t("settings.remove_duplicates_option_none"),value:"none"},{label:o.t("settings.remove_duplicates_option_hash"),value:"hash"},{label:o.t("settings.remove_duplicates_option_title"),value:"title"},{label:o.t("settings.remove_duplicates_option_url"),value:"url"}];return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:o.t("appearance.language_label"),description:o.t("appearance.language_description"),children:e.jsx(A,{className:"input-select",onChange:c=>V({language:c}),value:s,children:ga.map(({label:c,value:h})=>e.jsx(A.Option,{value:h,children:c},h))})}),e.jsx(B,{}),e.jsx(z,{title:o.t("settings.default_home_page_label"),description:o.t("settings.default_home_page_description"),children:e.jsx(A,{className:"input-select",onChange:c=>V({homePage:c}),value:t,children:u.map(({label:c,value:h})=>e.jsx(A.Option,{value:h,children:c},h))})}),e.jsx(B,{}),e.jsx(z,{title:o.t("settings.show_unread_feeds_only_label"),description:o.t("settings.show_unread_feeds_only_description"),children:e.jsx(Y,{checked:l,onChange:c=>V({showUnreadFeedsOnly:c})})}),e.jsx(B,{}),e.jsx(z,{title:o.t("settings.entries_order_label"),description:o.t("settings.entries_order_description"),children:e.jsxs(A,{className:"input-select",onChange:c=>V({orderBy:c}),value:n,children:[e.jsx(A.Option,{value:"published_at",children:o.t("settings.entries_order_option_published_at")}),e.jsx(A.Option,{value:"created_at",children:o.t("settings.entries_order_option_created_at")})]})}),e.jsx(B,{}),e.jsx(z,{title:o.t("settings.entries_per_page_label"),description:o.t("settings.entries_per_page_description"),children:e.jsx(hr,{className:"input-select",defaultValue:a,min:1,mode:"button",onChange:c=>V({pageSize:c}),size:"small"})}),e.jsx(B,{}),e.jsx(z,{title:o.t("settings.remove_duplicates_label"),description:o.t("settings.remove_duplicates_description"),children:e.jsx(A,{className:"input-select",onChange:c=>V({removeDuplicates:c}),value:i,children:d.map(({label:c,value:h})=>e.jsx(A.Option,{value:h,children:c},h))})}),e.jsx(B,{}),e.jsx(z,{title:o.t("settings.mark_read_on_scroll_label"),description:o.t("settings.mark_read_on_scroll_description"),children:e.jsx(Y,{checked:r,onChange:c=>V({markReadOnScroll:c})})})]})},et={exitDetailView:["esc"],fetchOriginalArticle:["d"],navigateToNextArticle:["n","j","right"],navigateToNextUnreadArticle:["shift+n","shift+j","ctrl+right"],navigateToPreviousArticle:["p","k","left"],navigateToPreviousUnreadArticle:["shift+p","shift+k","ctrl+left"],openLinkExternally:["v"],openPhotoSlider:["i"],saveToThirdPartyServices:["s"],showHotkeysSettings:["shift+?"],toggleReadStatus:["m"],toggleStarStatus:["f"]},Ke=tt("hotkeys",et,{encode:JSON.stringify,decode:t=>{const s=JSON.parse(t);return{...et,...s}}}),xt=$(Ke,t=>{const r=Object.values(t).flat().reduce((n,a)=>(n[a]=(n[a]||0)+1,n),{});return Object.entries(r).filter(([n,a])=>a>1).map(([n])=>n)}),ge=(t,s)=>{T(Ke,t)(s)},xa=t=>ge(t,et[t]),ya=({value:t,onChange:s,onRemove:r,editOnMount:n=!1})=>{const a=p(xt),[i,l]=g.useState(n),o=()=>{t===""&&r(),l(!1)},u=g.useCallback(d=>{if(i){d.preventDefault();const{key:c,ctrlKey:h,shiftKey:f,altKey:x,metaKey:m}=d;if(["Control","Shift","Alt","Meta","CapsLock"].includes(c))return;let _=c;switch(c){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":_=c.replace("Arrow","").toLowerCase();break;case" ":_="space";break}const v=[];h&&v.push("ctrl"),f&&v.push("shift"),x&&v.push("alt"),m&&v.push("meta");const C=v.length>0?`${v.join("+")}+${_}`:_;s(C),l(!1)}},[i,s]);return g.useEffect(()=>(window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}),[u]),i?e.jsx(H,{autoFocus:!0,onBlur:o,onChange:s,onPressEnter:o,size:"mini",status:a.includes(t)?"error":void 0,style:{width:80},value:t}):e.jsx(se,{closable:!!r,color:a.includes(t)?xe("Red"):void 0,onClick:()=>l(!0),onClose:d=>{d.stopPropagation(),r()},children:t})},Nt=t=>t.charAt(0).toUpperCase()+t.slice(1),_a=t=>t.map(s=>{const r=s.replace("left","â†").replace("right","â†’").replace("up","â†‘").replace("down","â†“");return r.includes("+")?r.split("+").map(Nt).join(" + "):Nt(r)}).join(" / "),ja=({keys:t,record:s})=>{const r=p(xt),[n,a]=g.useState(!1),i=g.useRef(null);return g.useEffect(()=>{const l=o=>{i.current&&!i.current.contains(o.target)&&a(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]),g.useEffect(()=>{if(!n){const l=t.filter(o=>o!=="");l.length!==t.length&&ge(s.action,l)}},[n]),e.jsx("div",{ref:i,children:n?e.jsxs(me,{wrap:!0,style:{marginBottom:-8},children:[t.map((l,o)=>e.jsx(ya,{value:l,editOnMount:l==="",onChange:u=>{const d=[...t];d[o]=u,ge(s.action,d)},onRemove:()=>{const u=t.filter((d,c)=>c!==o);ge(s.action,u)}},`${s.action}-${l}`)),e.jsx(se,{icon:e.jsx(nt,{}),style:{backgroundColor:"var(--color-fill-2)",border:"1px dashed var(--color-fill-3)",cursor:"pointer",width:"32px"},onClick:()=>{const l=[...t,""];ge(s.action,l)}}),e.jsx(I,{icon:e.jsx(ye,{}),onClick:()=>xa(s.action),shape:"circle",size:"mini"})]}):e.jsx(se,{color:t.some(l=>r.includes(l))?xe("Red"):void 0,onClick:()=>a(!0),style:{cursor:"pointer"},children:_a(t)})})},ba=()=>{const{polyglot:t}=p(E),s=p(Ke),r=["navigateToPreviousArticle","navigateToPreviousUnreadArticle","navigateToNextArticle","navigateToNextUnreadArticle","openLinkExternally","toggleReadStatus","fetchOriginalArticle","toggleStarStatus","saveToThirdPartyServices","openPhotoSlider","exitDetailView","showHotkeysSettings"],n=[{title:t.t("hotkeys.key"),dataIndex:"keys",render:(i,l)=>e.jsx(ja,{keys:i,record:l})},{title:t.t("hotkeys.function"),dataIndex:"description"}],a=r.map(i=>({action:i,key:i,keys:s[i],description:t.t(`hotkeys.${i}`)}));return e.jsx(Bt,{borderCell:!0,columns:n,data:a,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}})},pe=({icon:t,title:s})=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t,e.jsx("div",{style:{fontSize:"12px"},children:s})]}),va=({activeTab:t,onTabChange:s})=>{const{polyglot:r}=p(E),{isBelowMedium:n}=ie();return e.jsxs(ne,{activeTab:t,animation:!0,className:"custom-tabs",onChange:s,tabPosition:"top",children:[e.jsx(ne.TabPane,{title:e.jsx(pe,{icon:e.jsx(pr,{style:{fontSize:"20px"}}),title:r.t("settings.feeds")}),children:e.jsx(fa,{})},"1"),e.jsx(ne.TabPane,{title:e.jsx(pe,{icon:e.jsx(fr,{style:{fontSize:"20px"}}),title:r.t("settings.categories")}),children:e.jsx(oa,{})},"2"),e.jsx(ne.TabPane,{title:e.jsx(pe,{icon:e.jsx(gr,{style:{fontSize:"20px"}}),title:r.t("settings.general")}),children:e.jsx(ma,{})},"3"),e.jsx(ne.TabPane,{title:e.jsx(pe,{icon:e.jsx(mr,{style:{fontSize:"20px"}}),title:r.t("settings.appearance")}),children:e.jsx(aa,{})},"4"),!n&&e.jsx(ne.TabPane,{title:e.jsx(pe,{icon:e.jsx(xr,{style:{fontSize:"20px"}}),title:r.t("settings.hotkeys")}),children:e.jsx(ba,{})},"5")]})},Sa=[{required:!0}],wa=[{required:!0}],Ca=[{type:"boolean"}],ka=()=>{const{setSettingsModalVisible:t,setSettingsTabsActiveTab:s,settingsModalVisible:r,settingsTabsActiveTab:n}=ze();return e.jsx(Z,{autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>{t(!1),s("1")},title:null,unmountOnExit:!0,visible:r,children:e.jsx(va,{activeTab:n,onTabChange:s})})},Ta=()=>{const t=p(_e),{polyglot:s}=p(E),{addFeedModalVisible:r,setAddFeedModalVisible:n}=ze(),[a,i]=g.useState(!1),[l]=L.useForm(),{fetchAppData:o}=ft(),u=async(d,c,h)=>{i(!0);try{await Tn(d,c,h),await o(),j.success(s.t("main.add_feed_success")),n(!1),l.resetFields()}catch(f){console.error("Failed to add a feed: ",f),j.error(s.t("main.add_feed_error"))}finally{i(!1)}};return e.jsx(Z,{title:s.t("main.add_feed_modal_title"),visible:r,unmountOnExit:!0,style:{width:"400px"},onOk:l.submit,confirmLoading:a,onCancel:()=>{n(!1),l.resetFields()},children:e.jsxs(L,{form:l,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async d=>{const c=d.url.trim();c?await u(c,d.category,d.crawler):j.error(s.t("main.add_feed_url_empty"))},children:[e.jsx(L.Item,{label:s.t("main.add_feed_modal_feed_url_label"),field:"url",rules:Sa,children:e.jsx(H,{placeholder:s.t("main.add_feed_modal_feed_url_placeholder")})}),e.jsx(L.Item,{field:"category",label:s.t("main.add_feed_modal_category_label"),required:!0,rules:wa,children:e.jsx(A,{placeholder:s.t("main.add_feed_modal_category_placeholder"),showSearch:!0,filterOption:(d,c)=>zn(c.props.children,d),children:t.map(d=>e.jsx(A.Option,{value:d.id,children:d.title},d.id))})}),e.jsx(L.Item,{field:"crawler",initialValue:!1,label:s.t("main.add_feed_modal_crawler_label"),rules:Ca,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(Y,{})})]})})},Aa=()=>e.jsxs("div",{className:"main",children:[e.jsx(na,{children:e.jsx(yr,{})}),e.jsx(ka,{}),e.jsx(Ta,{})]}),ws=()=>{const{theme:t,themeColor:s}=p(S),[r,n]=g.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);g.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),i=l=>n(l.matches);return a.addEventListener("change",i),()=>a.removeEventListener("change",i)},[]),g.useEffect(()=>{const a=i=>{const l=i?"dark":"light";document.body.setAttribute("arco-theme",l),document.body.style.colorScheme=l};ys(s),a(t==="system"?r:t==="dark")},[r,t,s])},yt=()=>{const t=document.querySelector(".spinner");t&&(t.style.display="none")},Ia=()=>{Xt(),ws();const{isBelowLarge:t}=ie(),{polyglot:s}=p(E);return g.useEffect(()=>{yt()},[]),s&&e.jsxs("div",{className:"app",children:[t?null:e.jsx(_r.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(gs,{})}),e.jsx(sa,{}),e.jsx(Aa,{})]})},Cs=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},ks=t=>{var a;const n=(a=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:a.getAttribute("src");return{...t,imgSrc:n}},Ea=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(ks);be(s),qn(t.total),hs(s.length<t.total)}},Fa=(t,s)=>{const{isAppDataReady:r}=p(D),{showStatus:n}=p(S),a=g.useRef(!1),i=async l=>{if(!a.current){a.current=!0,It(!1);try{const o=n==="unread"?await l(0,"unread"):await l();switch(t.from){case"feed":n==="unread"&&ut(u=>({...u,[Number(t.id)]:o.total}));break;case"history":Pe(o.total);break;case"starred":n!=="unread"&&Ne(o.total);break;case"today":n==="unread"&&ht(o.total);break}It(!0),Ea(o)}catch(o){console.error("Error fetching articles: ",o)}finally{a.current=!1}}};return g.useEffect(()=>{r&&i(s)},[r]),{fetchArticleList:i}},_t=oe({isPhotoSliderVisible:!1,selectedIndex:0}),La=T(_t,"isPhotoSliderVisible"),Pa=T(_t,"selectedIndex"),Ts=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=p(_t);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:La,selectedIndex:s,setSelectedIndex:Pa}},As=()=>{const{activeContent:t}=p(F),s=p(pt),r=p(je),n=p(ds),a=p(us),{entryListRef:i,handleEntryClick:l}=xs(),o=()=>{if(i.current){const P=i.current.el.querySelector(".card-custom-selected-style");P&&P.scrollIntoView({behavior:"smooth",block:"nearest"})}},{isPhotoSliderVisible:u,setIsPhotoSliderVisible:d,setSelectedIndex:c}=Ts(),{setSettingsModalVisible:h,setSettingsTabsActiveTab:f}=ze(),x=P=>(...Q)=>{if(t)return P(...Q)},m=x(()=>{G(null),i.current&&i.current.contentWrapperEl.focus()}),_=()=>{n&&(l(n),setTimeout(()=>o(),200))},v=()=>{a&&(l(a),setTimeout(()=>o(),200))},C=(P,Q,ve)=>(Q==="prev"?ve.slice(0,P).toReversed():ve.slice(P+1)).find(We=>We.status==="unread"),U=P=>{const Q=C(s,P,r);Q&&(l(Q),setTimeout(o,200))},N=()=>U("prev"),y=()=>U("next"),b=x(()=>{window.open(t.url,"_blank")}),q=x(P=>{P()}),K=x(P=>{P()}),te=()=>{console.log("showHotkeysSettings"),f("5"),h(!0)},de=x(P=>{P()}),W=x(P=>{P()}),J=x(()=>{!Cs(t.content).length||u||(c(0),d(!0))});return{exitDetailView:m,fetchOriginalArticle:q,navigateToNextArticle:v,navigateToNextUnreadArticle:y,navigateToPreviousArticle:_,navigateToPreviousUnreadArticle:N,openLinkExternally:b,openPhotoSlider:J,saveToThirdPartyServices:K,showHotkeysSettings:te,toggleReadStatus:de,toggleStarStatus:W}},Na=()=>{const{activeContent:t}=p(F),s=p(us),r=p(ds),[n,a]=g.useState(!1),{handleFetchContent:i,handleSaveToThirdPartyServices:l,handleToggleStarred:o,handleToggleStatus:u}=qe(),{exitDetailView:d,navigateToNextArticle:c,navigateToPreviousArticle:h}=As(),f=t.status==="unread",x=t.starred;return g.useEffect(()=>{a(!1)},[t]),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(I,{icon:e.jsx(jr,{}),onClick:()=>d(),shape:"circle"}),e.jsx(I,{icon:e.jsx(br,{}),onClick:()=>h(),shape:"circle",disabled:!r}),e.jsx(I,{icon:e.jsx(vr,{}),onClick:()=>c(),shape:"circle",disabled:!s})]}),e.jsxs("div",{className:"right-side",children:[e.jsx(I,{icon:f?e.jsx(Ht,{}):e.jsx(qt,{}),onClick:()=>u(t),shape:"circle"}),e.jsx(I,{icon:x?e.jsx(ot,{style:{color:"#ffcd00"}}):e.jsx(rt,{}),onClick:()=>o(t),shape:"circle"}),e.jsx(I,{icon:e.jsx(Sr,{}),onClick:async()=>{await i(),a(!0)},shape:"circle",disabled:n}),e.jsx(I,{icon:e.jsx(wr,{}),onClick:l,shape:"circle"})]})]})},jt={bash:"Bash",c:"C",cpp:"C++",csharp:"C#",css:"CSS",dockerfile:"Dockerfile",go:"Go",html:"HTML",java:"Java",javascript:"JavaScript",json:"JSON",kotlin:"Kotlin",markdown:"Markdown",php:"PHP",powershell:"PowerShell",python:"Python",ruby:"Ruby",rust:"Rust",sql:"SQL",swift:"Swift",typescript:"TypeScript",xml:"XML",yaml:"YAML"},Is=Object.keys(jt),Ra="markdown",Da=t=>Is.find(s=>t&&(t.includes(`language-${s}`)||t.includes(`lang-${s}`)||t.includes(s)));(typeof global<"u"?global:window).Prism=Kt;for(const t of Object.keys(jt))fe(()=>import(`prismjs/components/prism-${t}`),[]).catch(s=>{console.warn(`Failed to load language: ${t}`,s)});const Es={Dracula:R.dracula,DuotoneDark:R.duotoneDark,DuotoneLight:R.duotoneLight,GitHub:R.github,MaterialDark:R.gruvboxMaterialDark,MaterialLight:R.gruvboxMaterialLight,JettwaveDark:R.jettwaveDark,JettwaveLight:R.jettwaveLight,NightOwl:R.nightOwl,NightOwlLight:R.nightOwlLight,OceanicNext:R.oceanicNext,Okaidia:R.okaidia,OneDark:R.oneDark,OneLight:R.oneLight,Palenight:R.palenight,ShadesOfPurple:R.shadesOfPurple,Synthwave84:R.synthwave84,Ultramin:R.ultramin,VsDark:R.vsDark,VsLight:R.vsLight},Ma=({children:t,className:s})=>{const{highlightTheme:r}=p(S),{polyglot:n}=p(E),[a,i]=g.useState(()=>Da(s)||Ra),l=g.useCallback(()=>{navigator.clipboard.writeText(t.trim()).then(()=>j.success(n.t("actions.copied")))},[t,n]),o=t.trim(),u=o.split(`
`).length,d=Oa(u),c=`${d+1.5}em`;return e.jsxs("div",{className:"code-block-container",children:[e.jsx(Ua,{language:a,setLanguage:i}),e.jsx(Va,{}),e.jsx($a,{onClick:l}),e.jsx(Ba,{code:o,language:a,theme:Es[r],lineNumberWidth:d,paddingLeft:c})]})},Oa=t=>t<10?1:t<100?2:t<1e3?3:Math.floor(Math.log10(t))+1,Ua=({language:t,setLanguage:s})=>e.jsx(A,{onChange:s,value:t,showSearch:!0,className:"language-selector",children:Is.map(r=>e.jsx(A.Option,{value:r,children:jt[r]||r},r))}),Va=()=>{const{highlightTheme:t}=p(S);return e.jsx(A,{onChange:s=>V({highlightTheme:s}),value:t,showSearch:!0,className:"theme-selector",children:Object.keys(Es).map(s=>e.jsx(A.Option,{value:s,children:s},s))})},$a=({onClick:t})=>e.jsx(I,{icon:e.jsx(Cr,{}),onClick:t,className:"copy-button"}),za=({number:t,width:s})=>e.jsx("span",{style:{position:"absolute",left:`-${s+1.5}em`,width:`${s+.5}em`,textAlign:"right",color:"rgba(255,255,255,0.4)",userSelect:"none",paddingRight:"0.5em"},children:t}),Ba=({code:t,language:s,theme:r,lineNumberWidth:n,paddingLeft:a})=>e.jsx(kr,{code:t,language:s,prism:Kt,theme:r,children:({className:i,style:l,tokens:o,getLineProps:u,getTokenProps:d})=>e.jsx("pre",{className:i,style:{...l,paddingTop:"50px",paddingLeft:a,position:"relative"},children:o.map((c,h)=>{var f;return e.jsxs("div",{...u({line:c,key:h}),style:{position:"relative"},children:[e.jsx(za,{number:h+1,width:n}),c.map((x,m)=>e.jsx("span",{...d({token:x,key:m})},`token-${h}-${m}-${x.content.slice(0,5)}`))]},`line-${h}-${(f=c[0])==null?void 0:f.content.slice(0,5)}`)})})}),ke=({imgNode:t,isIcon:s})=>{const{fontSize:r}=p(S);return e.jsx("img",{...t.attribs,alt:t.attribs.alt??"image",style:s?{display:"inline-block",width:"auto",height:`${r}rem`,margin:0}:{}})},Rt=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var f;const[a,i]=g.useState(!1),[l,o]=g.useState(!1),{isBelowMedium:u}=ie();g.useEffect(()=>{const m=(n?t.children[0]:t).attribs.src,_=new Image;_.src=m,_.onload=()=>o(_.width<=100&&_.height<=100)},[t,n]);const d=n?t.children[0]:t;if(l)return n?e.jsxs("a",{...t.attribs,children:[e.jsx(ke,{imgNode:d,isIcon:l}),(f=t.children[1])==null?void 0:f.data]}):e.jsx(ke,{imgNode:d,isIcon:l});const c=()=>i(!0),h=()=>i(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:c,onMouseLeave:h,children:[n?e.jsx("a",{...t.attribs,children:e.jsx(ke,{imgNode:d,isIcon:l})}):e.jsx(ke,{imgNode:d,isIcon:l}),e.jsx(I,{icon:e.jsx(Tr,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:u||a?1:0,transition:"opacity 0.3s"},onClick:x=>{x.preventDefault(),r(s)}})]})})},Ha=(t,s)=>({replace:r=>{var n;if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const a=r.children[0];if(a.type==="tag"&&a.name==="img"){const i=t.findIndex(l=>l===a.attribs.src);return e.jsx(Rt,{node:r,index:i,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const a=t.findIndex(i=>i===r.attribs.src);return e.jsx(Rt,{node:r,index:a,togglePhotoSlider:s})}else if(r.type==="tag"&&r.name==="pre"&&((n=r.children[0])==null?void 0:n.name)==="code"){const a=r.children[0],i=a.attribs.class||"";return e.jsx(Ma,{className:i,children:a.children[0].data})}return r}}),qa=g.forwardRef((t,s)=>{const r=ee(),{activeContent:n}=p(F),{articleWidth:a,fontFamily:i,fontSize:l}=p(S),{isPhotoSliderVisible:o,setIsPhotoSliderVisible:u,selectedIndex:d,setSelectedIndex:c}=Ts(),h=()=>{De("author"),Re(n.author)},f=y=>{c(y),u(b=>!b)},x=Cs(n.content),m=Ha(x,f),_=Ar(n.content,m),{id:v,title:C}=n.feed.category,{id:U,title:N}=n.feed;return e.jsx("article",{className:"article-content",ref:s,tabIndex:-1,children:e.jsxs(st,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${a}%`},children:[e.jsx(k.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",children:n.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(k.Text,{children:e.jsx(_s,{url:`/feed/${U}`,text:N})}),e.jsx(k.Text,{onClick:h,style:{cursor:"pointer"},children:` - ${n.author}`}),e.jsx(k.Text,{children:e.jsx(se,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>r(`/category/${v}`),children:C})})]}),e.jsx(k.Text,{className:"article-date",children:xn(n.published_at)}),e.jsx("br",{}),e.jsx(k.Text,{className:"article-date",children:es(n.reading_time)}),e.jsx(B,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${l}rem`,width:`${a}%`,fontFamily:i},children:[_,e.jsx(Ir,{images:x.map(y=>({src:y,key:y})),loop:!1,visible:o,onClose:()=>{u(!1)},index:d,onIndexChange:c})]},n.id)]})})}),Fs=at(!1),Dt=T(Fs),Ka=(t,s)=>!s.some(r=>r.id===t.id),Ls=()=>{const{offset:t}=p(F),{pageSize:s,showStatus:r}=p(S),n=p(Fs),a=l=>{const o=(u,d)=>d.filter(c=>Ka(c,u));be(u=>[...u,...o(u,l)]),Me(u=>u+s)};return{handleLoadMore:async l=>{var o;Dt(!0);try{const u=r==="unread"?await l(t+s,"unread"):await l(t+s);if(((o=u==null?void 0:u.entries)==null?void 0:o.length)>0){const d=u.entries.map(ks);a(d)}else hs(!1)}catch(u){console.error("Error fetching more articles: ",u)}finally{Dt(!1)}},loadingMore:n}},Wa=({alt:t,borderRadius:s,height:r,src:n,status:a,width:i})=>{const[l,o]=g.useState(!1),{opacity:u}=Wt({opacity:l?1:0,config:{duration:200}}),{ref:d}=Ve({triggerOnce:!0,onChange:(c,h)=>{if(c&&!l){const f=new Image;f.onload=()=>o(!0),f.onerror=()=>{h.target.style.display="none"},f.src=n}}});return e.jsx("div",{className:"image-container",ref:d,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:l?e.jsx(Gt.img,{className:a==="unread"?"":"read",src:n,alt:t,style:{width:i,height:r,objectFit:"cover",borderRadius:s,opacity:u}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(Ee,{text:{rows:0},image:{style:{width:i,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},Ga=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(Wa,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},Ya=(t,s)=>t?s?"0 10px 0 0":"0 0 10px 0":"0",Ja=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:a}=p(S),i=Ue({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:i,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:Ya(t.imgSrc,r)},children:e.jsx(Ga,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(k.Text,{className:"article-card-title",children:t.title}),e.jsxs(k.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(ps,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Zt(t.published_at,a),e.jsx("br",{}),es(t.reading_time)]}),t.starred&&e.jsx(ot,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},Xa=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:a,showFeedIcon:i}=p(S),{activeContent:l}=p(F),{polyglot:o}=p(E),u=l&&t.id===l.id,{handleToggleStarred:d,handleToggleStatus:c}=qe(),[h,f]=g.useState(0),x=60,m=.5,_=t.starred,v=t.status==="unread",C=Yt({preventScrollOnSwipe:!0,delta:x/2,onSwiping:W=>{const J=Math.min(Math.abs(W.deltaX*m),x)*Math.sign(W.deltaX);f(J)},onSwiped:async W=>{try{W.deltaX>x?(await d(t),j.success(_?o.t("article_card.unmarked_as_starred"):o.t("article_card.marked_as_starred"))):W.deltaX<-x&&(await c(t),j.success(v?o.t("article_card.marked_as_read"):o.t("article_card.marked_as_unread")))}catch(J){console.error("Failed to update entry: ",J),j.error(o.t("article_card.update_failed"))}f(0)}}),[U,N]=g.useState(!1),[y,b]=g.useState(!1),q=()=>c(t),K=20,{ref:te}=Ve({skip:y,onChange:async(W,J)=>{if(!(!a||!v)){if(W)N(!0);else if(U){const{top:P}=J.boundingClientRect;P<K&&(await q(),b(!0))}}}}),de=Wt({x:h});return e.jsx("div",{className:"article-card",...C,children:e.jsxs("div",{ref:te,children:[e.jsx(Gt.div,{className:"swipe-card",style:de,children:e.jsx(Fe,{className:Ue("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":u}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Fe.Meta,{description:e.jsx(Ja,{entry:t,showFeedIcon:i,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:_?e.jsx(ot,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(rt,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:v?e.jsx(Ht,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(qt,{style:{color:"#ffffff",fontSize:"24px"}})})]})]})},t.id)},Qa=({layout:t,isArticleListReady:s})=>e.jsx(Fe,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Fe.Meta,{description:e.jsx(Ee,{loading:!s,animation:!0,text:{rows:3,width:150}})})}),Za=()=>{const{layout:t}=p(S),{isArticleListReady:s}=p(F),r=t==="large"?2:4;return!s&&Array.from({length:r},(n,a)=>e.jsx(Qa,{layout:t,isArticleListReady:s},a))},eo=()=>{const{filterString:t,filterType:s}=p(F),{orderDirection:r}=p(S),{polyglot:n}=p(E),a=n.t("search.tooltip").split(`
`),[i,l]=g.useState(""),o=g.useCallback(la(h=>Re(h),500),[]),u=h=>{l(h),o(h)},{isBelowMedium:d}=ie(),c=()=>{V({orderDirection:r==="desc"?"asc":"desc"})};return g.useEffect(()=>{De("title"),Re("")},[]),g.useEffect(()=>{t!==i&&l(t)},[t]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(H.Search,{allowClear:!0,onChange:u,placeholder:n.t("search.placeholder"),style:{width:d?"100%":308,marginLeft:8},value:i,addBefore:e.jsxs(A,{onChange:De,style:{width:80},triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},value:s,children:[e.jsx(A.Option,{value:"title",children:n.t("search.type_title")}),e.jsx(A.Option,{value:"content",children:n.t("search.type_content")}),e.jsx(A.Option,{value:"author",children:n.t("search.type_author")})]}),prefix:e.jsx(ae,{mini:!0,content:e.jsx("div",{children:a.map((h,f)=>e.jsxs(g.Fragment,{children:[h,f<a.length-1&&e.jsx("br",{})]},`line-${f}-${h.length}`))}),children:e.jsx(zt,{})})}),e.jsx("div",{className:"button-group",children:e.jsx(ae,{mini:!0,content:r==="desc"?n.t("article_list.sort_direction_desc"):n.t("article_list.sort_direction_asc"),children:e.jsx(I,{shape:"circle",size:"small",icon:r==="desc"?e.jsx(Er,{}):e.jsx(Fr,{}),onClick:c})})})]})},to=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},so=(t,s,r)=>{g.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},ro=({duration:t,color:s})=>{const[r,n]=g.useState([]);so(r.length,t,()=>{n([])});const a=i=>{const l=i.currentTarget.getBoundingClientRect(),o=l.width>l.height?l.width:l.height,u=i.pageX-l.x-o/2,d=i.pageY-l.y-o/2,c={x:u,y:d,size:o,id:`${new Date().getTime()}-${u}-${d}`};n([...r,c])};return e.jsx("div",{className:"ripple-container",onMouseDown:a,children:r.length>0&&r.map(i=>e.jsx("span",{className:"ripple-span",style:{top:i.y,left:i.x,width:i.size,height:i.size,backgroundColor:s,animationDuration:`${t}ms`}},i.id))})},no=({getEntries:t})=>{const{isArticleListReady:s,loadMoreVisible:r}=p(F),{loadingMore:n,handleLoadMore:a}=Ls(),{ref:i,inView:l}=Ve(),o=g.useCallback(async()=>{r&&l&&s&&!n&&await a(t)},[r,l,s,n,a,t]);return g.useEffect(()=>{const u=setInterval(o,500);return()=>clearInterval(u)},[o]),s&&r&&e.jsxs("div",{className:"load-more-container",ref:i,children:[e.jsx(Pr,{loading:n,style:{paddingRight:"10px"}}),"Loading more ..."]})},ao=g.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:a,pageSize:i}=p(S),l=a==="small",{isArticleListReady:o,loadMoreVisible:u}=p(F),d=p(je),c=d.length-Math.ceil(i*.2)-1,{loadingMore:h,handleLoadMore:f}=Ls(),{ref:x}=Ve({skip:!u,onChange:async C=>{!C||!o||h||await f(t)}}),m=Lr({count:d.length,getScrollElement:()=>r.current,estimateSize:g.useCallback(()=>l?120:280,[l]),overscan:5}),_=m.getVirtualItems(),v=g.useCallback(C=>C===c?to(m.measureElement,x):m.measureElement,[c,m.measureElement,x]);return e.jsxs(e.Fragment,{children:[e.jsx(eo,{}),e.jsxs(st,{className:"entry-list",ref:n,children:[e.jsx(Za,{}),o&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:m.getTotalSize(),width:"100%",position:"relative"},children:_.map(C=>e.jsx("div",{"data-index":C.index,ref:v(C.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${C.start}px)`},children:e.jsx(Xa,{entry:d[C.index],handleEntryClick:s,mini:l,children:e.jsx(ro,{color:"var(--color-text-4)",duration:1e3})})},C.key))})}),e.jsx(no,{getEntries:t})]})]})}),oo=()=>{be(t=>t.map(s=>({...s,status:"read"})))},io=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:n}=p(F),{showStatus:a}=p(S),{polyglot:i}=p(E),{fetchAppData:l}=ft(),o=async()=>{try{await r(),oo(),await l(),j.success(i.t("article_list.mark_all_as_read_success"))}catch(d){console.error("Failed to mark all as read: ",d),j.error(i.t("article_list.mark_all_as_read_error"))}},u=d=>{V({showStatus:d})};return g.useEffect(()=>{De("title"),Re("")},[a]),e.jsxs("div",{className:"entry-panel",children:[e.jsx($t,{focusLock:!0,onOk:o,title:i.t("article_list.mark_all_as_read_confirm"),children:e.jsx(I,{icon:e.jsx(Ut,{}),shape:"circle",style:{visibility:["starred","history"].includes(t.from)?"hidden":"visible"}})}),e.jsx(Nr.Group,{onChange:u,options:[{label:i.t("article_list.filter_status_all"),value:"all"},{label:i.t("article_list.filter_status_unread"),value:"unread"}],style:{visibility:t.from==="history"?"hidden":"visible"},type:"button",value:a}),e.jsx(I,{icon:e.jsx(ye,{}),loading:!n,shape:"circle",onClick:s})]})},ce=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleListReady:a,isArticleLoading:i}=p(F),{isAppDataReady:l}=p(D),{orderBy:o,orderDirection:u,showAllFeeds:d,showStatus:c}=p(S),{polyglot:h}=p(E),f=p(xt),x=p(dt),m=p(Ke),_=g.useRef(null),{entryDetailRef:v,entryListRef:C,handleEntryClick:U}=xs(),{exitDetailView:N,fetchOriginalArticle:y,navigateToNextArticle:b,navigateToNextUnreadArticle:q,navigateToPreviousArticle:K,navigateToPreviousUnreadArticle:te,openLinkExternally:de,openPhotoSlider:W,saveToThirdPartyServices:J,showHotkeysSettings:P,toggleReadStatus:Q,toggleStarStatus:ve}=As(),{fetchAppData:bt}=ft(),{fetchArticleList:vt}=Fa(t,s),{handleFetchContent:We,handleSaveToThirdPartyServices:Ns,handleToggleStarred:Rs,handleToggleStatus:Ds}=qe(),Ms={exitDetailView:N,fetchOriginalArticle:()=>y(We),navigateToNextArticle:()=>b(),navigateToNextUnreadArticle:()=>q(),navigateToPreviousArticle:()=>K(),navigateToPreviousUnreadArticle:()=>te(),openLinkExternally:de,openPhotoSlider:W,saveToThirdPartyServices:()=>J(Ns),showHotkeysSettings:P,toggleReadStatus:()=>Q(()=>Ds(n)),toggleStarStatus:()=>ve(()=>Rs(n))},Os=he=>he.filter(Ge=>!f.includes(Ge));for(const[he,Ge]of Object.entries(Ms))Rr(Os(m[he]),Ge);const ue=async he=>{Me(0),l?await vt(he):await bt()},Us=Yt({preventScrollOnSwipe:!0,onSwipedLeft:()=>b(),onSwipedRight:()=>K()});return g.useEffect(()=>{f.length>0&&j.error(h.t("settings.duplicate_hotkeys"))},[f]),g.useEffect(()=>{Hn(t.from),n&&G(null),ue(s)},[t]),g.useEffect(()=>{["starred","history"].includes(t.from)||ue(s)},[o]),g.useEffect(()=>{x.length===0||["starred","history"].includes(t.from)||ue(s)},[d]),g.useEffect(()=>{ue(s)},[u,c]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(Ye,{classNames:"slide",in:a,nodeRef:_,timeout:200,children:e.jsx(ao,{cardsRef:_,getEntries:s,handleEntryClick:U,ref:C})}),e.jsx(io,{info:t,refreshArticleList:()=>ue(s),markAllAsRead:r})]}),n?e.jsxs("div",{className:"article-container",...Us,children:[e.jsx(Ye,{classNames:"slide",in:!i,nodeRef:v,timeout:200,unmountOnExit:!0,children:e.jsx(qa,{ref:v})}),e.jsx(Ye,{in:!i,timeout:200,unmountOnExit:!0,children:e.jsx(Na,{})})]}):e.jsxs("div",{className:"content-empty",children:[e.jsx(Dr,{style:{fontSize:"64px"}}),e.jsx(k.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]})]})},lo=()=>e.jsx(ce,{info:{from:"all",id:""},getEntries:bn,markAllAsRead:Pn}),co=()=>{const{id:t}=Jt(),s=O("orderBy"),r=O("pageSize"),n=O("showAllFeeds"),a=async(i=0,l=null)=>{const o={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:i,limit:r,status:l},u={globally_visible:!n};return w.get(le(o,u))};return e.jsx(ce,{info:{from:"category",id:t},getEntries:a,markAllAsRead:()=>pn(t)})},uo=()=>{const t=ee(),s=Mr();return console.error(s),g.useEffect(()=>{yt()},[]),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(Or,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(I,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},ho=()=>{const{id:t}=Jt(),s=O("orderBy"),r=O("pageSize"),n=async(a=0,i=null)=>{const l={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:a,limit:r,status:i};return w.get(le(l))};return e.jsx(ce,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>In(t)})},po=()=>e.jsx(ce,{info:{from:"history",id:""},getEntries:vn}),fo=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,a]of Object.entries(s))if(n!=="password"){const i=a==null?void 0:a.trim();t.setFieldValue(n,i),i||(r=!1)}else a||(r=!1);return r},Te=(t,s)=>{t.key==="Enter"&&s.submit()},go=()=>{Xt(),ws();const t=p(Be),{homePage:s}=p(S),{polyglot:r}=p(E),[n]=Ur(),[a,i]=g.useState(!1),[l,o]=g.useState("token"),u=ee(),d=async h=>{i(!0);const{server:f,token:x,username:m,password:_}=h;try{(await Mt.raw("v1/me",{baseURL:f,headers:x?{"X-Auth-Token":x}:{Authorization:`Basic ${btoa(`${m}:${_}`)}`}})).status===200&&(j.success(r.t("login.success")),Qt({server:f,token:x,username:m,password:_}),u("/"))}catch(v){console.error(v),j.error(v.message)}i(!1)},c=async h=>{if(!Le(h)){j.error(r.t("login.auth_error"));return}await d(h)};return g.useEffect(()=>{yt()},[]),g.useEffect(()=>{const h=new URL(window.location.href),{server:f,token:x,username:m,password:_}=Object.fromEntries(h.searchParams);f&&(m&&o("user"),n.setFieldsValue({server:f,token:x,username:m,password:_}),n.submit())},[r]),Le(t)?e.jsx(it,{to:`/${s}`}):r&&e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(k.Title,{heading:3,children:r.t("login.login_to_your_server")}),e.jsxs(L,{autoComplete:"off",form:n,layout:"vertical",onSubmit:async()=>{fo(n)?(history.replaceState(null,"","/login"),await c(n.getFieldsValue())):j.error(r.t("login.submit_error"))},children:[e.jsx(L.Item,{field:"server",label:r.t("login.server_label"),rules:[{required:!0}],onKeyDown:h=>{Te(h,n)},children:e.jsx(H,{disabled:a,placeholder:r.t("login.server_placeholder"),prefix:e.jsx(Vr,{})})}),l==="token"&&e.jsx(L.Item,{field:"token",label:r.t("login.token_label"),rules:[{required:!0}],onKeyDown:h=>{Te(h,n)},children:e.jsx(H.Password,{disabled:a,placeholder:r.t("login.token_placeholder"),prefix:e.jsx(kt,{})})}),l==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(L.Item,{field:"username",label:r.t("login.username_label"),rules:[{required:!0}],onKeyDown:h=>{Te(h,n)},children:e.jsx(H,{disabled:a,placeholder:r.t("login.username_placeholder"),prefix:e.jsx(Vt,{})})}),e.jsx(L.Item,{field:"password",label:r.t("login.password_label"),rules:[{required:!0}],onKeyDown:h=>{Te(h,n)},children:e.jsx(H.Password,{disabled:a,placeholder:r.t("login.password_placeholder"),prefix:e.jsx(kt,{})})})]})]}),e.jsx(I,{loading:a,type:"primary",long:!0,onClick:()=>n.submit(),style:{marginTop:"20px"},children:r.t("login.login_button")}),e.jsx(B,{orientation:"center",children:r.t("login.another_login_method")}),e.jsx(I,{type:"secondary",long:!0,onClick:()=>o(l==="token"?"user":"token"),style:{marginTop:"20px"},children:l==="token"?r.t("login.another_login_button"):r.t("login.token_label")}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(k.Text,{disabled:!0,children:r.t("login.need_help")}),e.jsx($r,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:r.t("login.miniflux_official_website")})]})]})}),e.jsx("div",{className:"background"})]})},mo=({children:t})=>{const s=p(Be);return Le(s)?e.jsx(e.Fragment,{children:t}):e.jsx(it,{to:"/login"})},xo=()=>e.jsx(ce,{info:{from:"starred",id:""},getEntries:ts}),yo=()=>{const t=async()=>{const s=await Ae(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=Ae(0,"unread",r).then(i=>i.entries));const a=n.map(i=>i.id);return He(a,"read")};return e.jsx(ce,{info:{from:"today",id:""},getEntries:Ae,markAllAsRead:t})},_o=O("homePage"),jo=[{path:"/all",element:e.jsx(lo,{})},{path:"/today",element:e.jsx(yo,{})},{path:"/starred",element:e.jsx(xo,{})},{path:"/history",element:e.jsx(po,{})},{path:"/category/:id",element:e.jsx(co,{})},{path:"/feed/:id",element:e.jsx(ho,{})}],Ps=zr([{path:"/",element:e.jsx(mo,{children:e.jsx(Ia,{})}),errorElement:e.jsx(uo,{}),children:[...jo,{index:!0,element:e.jsx(it,{to:`/${_o}`,replace:!0})}]},{path:"/login",element:e.jsx(go,{})}]),bo={"zh-CN":Wr,"es-ES":Gr},vo=()=>bo[Qr()]||Kr;Br.createRoot(document.getElementById("root")).render(e.jsx(Hr,{locale:vo(),children:e.jsx(qr,{router:Ps})}));

import{p as Ge,m as ne,u as f,r as p,d as D,P as ws,i as Cs,o as Tt,a as ks,b as Is,c as Es,e as H,M as j,C as Ts,j as e,f as Y,g as Pe,A as Fs,I as As,T as I,S as ke,h as Ye,k as Ft,l as Ls,n as Ns,q as Je,s as Ps,t as Rs,v as ee,w as Re,B as E,x as Ms,D as Ds,y as he,z as re,E as Xe,F as Os,G as Vs,H as zs,J as mt,K as At,L as Us,N as pe,O as $s,Q as Lt,R as J,U as Bs,V as Hs,W as Ks,X as qs,Y as Ws,Z as $,_ as q,$ as L,a0 as gt,a1 as N,a2 as Q,a3 as B,a4 as Qe,a5 as xt,a6 as Nt,a7 as Gs,a8 as Pt,a9 as Rt,aa as Ys,ab as se,ac as Js,ad as Xs,ae as Qs,af as Zs,ag as er,ah as tr,ai as sr,aj as rr,ak as nr,al as ar,am as Mt,an as Dt,ao as Ze,ap as or,aq as ir,ar as lr,as as cr,at as dr,au as ur,av as Me,aw as hr,ax as fr,ay as pr,az as Ie,aA as mr,aB as gr,aC as xr,aD as yr,aE as _r,aF as jr,aG as Ke,aH as br,aI as Ot,aJ as vr,aK as Sr,aL as wr,aM as et,aN as Cr,aO as yt,aP as kr,aQ as Ir,aR as Er,aS as Tr,aT as Fr,aU as Ar,aV as Lr,aW as Nr}from"./vendor-BduRoXZB.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=r(a);fetch(a.href,l)}})();const Pr="modulepreload",Rr=function(t){return"/"+t},_t={},ye=function(s,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),o=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(r.map(u=>{if(u=Rr(u),u in _t)return;_t[u]=!0;const d=u.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Pr,d||(h.as="script"),h.crossOrigin="",h.href=u,o&&h.setAttribute("nonce",o),document.head.appendChild(h),d)return new Promise((g,_)=>{h.addEventListener("load",g),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${u}`)))})}))}function l(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return a.then(i=>{for(const o of i||[])o.status==="rejected"&&l(o.reason);return s().catch(l)})},Mr=(t,s,r)=>{const n=t[s];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},Dr=()=>{const{language:t}=w.get(),s=tt();return t||s},tt=()=>{const t=navigator.language;return t==="zh-Hans-CN"?"zh-CN":t},Vt={articleWidth:90,fontFamily:"system-ui",fontSize:1.05,homePage:"all",language:tt(),layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showUnreadFeedsOnly:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},w=Ge("settings",Vt,{encode:JSON.stringify,decode:JSON.parse}),O=t=>w.get()[t],z=t=>w.set({...w.get(),...t}),Or=()=>w.set(Vt),T=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},F=ne({polyglot:null}),Vr=T(F,"polyglot"),zr=async(t,s)=>{let r,n=t;try{r=await Mr(Object.assign({"../locales/en-US.json":()=>ye(()=>import("./en-US-BbREc4P5.js"),[]),"../locales/es-ES.json":()=>ye(()=>import("./es-ES-BbYpW8s-.js"),[]),"../locales/zh-CN.json":()=>ye(()=>import("./zh-CN-CX6BDbmA.js"),[])}),`../locales/${t}.json`,3)}catch(a){console.error("Failed to load language: ",a),r=await ye(()=>import("./en-US-BbREc4P5.js"),[]),n="en-US"}{const a=new ws({phrases:r.default,locale:n});Vr(a)}},zt=()=>{const{language:t}=f(w);p.useEffect(()=>{t?(zr(t),t==="zh-CN"?D.locale("zh-cn"):t==="es"||t.startsWith("es-")?D.locale("es"):D.locale("en")):z({language:tt()})},[t])},st=ne({addFeedModalVisible:!1,settingsModalVisible:!1}),Ur=T(st,"addFeedModalVisible"),$r=T(st,"settingsModalVisible"),rt=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=f(st);return{addFeedModalVisible:t,setAddFeedModalVisible:Ur,settingsModalVisible:s,setSettingsModalVisible:$r}},me=()=>{const[t,s]=p.useState(window.innerWidth),r=t<=768,n=t<=992;return p.useEffect(()=>{const a=()=>s(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},Ut={server:"",token:"",username:"",password:""},De=Ge("auth",Ut,{encode:JSON.stringify,decode:JSON.parse}),$t=t=>De.set(t),Br=()=>$t(Ut),Hr=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},Ee=t=>{const{server:s,token:r,username:n,password:a}=t;return!s||!Cs(s,{require_protocol:!0})&&!Hr(s)?!1:r||n&&a},Kr=()=>Tt.create({retry:3,onRequest({_request:t,options:s}){const r=De.get();if(!Ee(r))throw new Error("Invalid auth");const{server:n,token:a,username:l,password:i}=r;s.baseURL=n,s.headers=a?{"X-Auth-Token":a}:{Authorization:`Basic ${btoa(`${l}:${i}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var l;s.status===401&&(localStorage.removeItem("auth"),await _s.navigate("/login"));const a=((l=s._data)==null?void 0:l.error_message)??s.statusText;throw console.error("Response error: ",a),new Error(a)}}),b=Kr();b.get=t=>b(t,{method:"GET"});b.post=(t,s)=>b(t,{method:"POST",body:s});b.put=(t,s)=>b(t,{method:"PUT",body:s});const qr=async()=>b.get("/v1/categories"),Wr=async t=>b.post("/v1/categories",{title:t}),Gr=async t=>b.raw(`/v1/categories/${t}`,{method:"DELETE"}),Yr=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return b.put(`/v1/categories/${t}`,n)},Jr=async t=>b.put(`/v1/categories/${t}/mark-all-as-read`);D.extend(ks);D.extend(Is);D.extend(Es);const Xr=t=>D(t).isAfter(D().subtract(24,"hour")),Qr=()=>D().subtract(24,"hour").unix(),Zr=()=>D().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),en=t=>D(t).format("dddd, MMMM D, YYYY h:mm A"),Bt=(t,s)=>{const{polyglot:r}=F.get();if(!s){const m=D(),y=D(t),C=y.from(m),v=D.duration(m.diff(y)).asSeconds();return v>=0&&v<60?r.t("date.just_now"):C}const n=D(),l=D(t).diff(n),i=D.duration(Math.abs(l)),o=i.years(),u=i.months(),d=i.days(),c=i.hours(),h=i.minutes(),g=[];if(o>0&&g.push(r.t("date.years",o)),u>0&&g.push(r.t("date.months",u)),d>0&&g.push(r.t("date.days",d)),c>0&&g.push(r.t("date.hours",c)),h>0&&g.push(r.t("date.minutes",h)),g.length===0)return r.t("date.just_now");const _=g.join(" ");return l>0?r.t("date.in_time",{time:_}):r.t("date.time_ago",{time:_})},Ht=t=>{const{polyglot:s}=F.get(),r=s.t("date.minutes",t);return s.t("article_card.reading_time",{time:r})},Oe=async(t,s)=>b.put("/v1/entries",{entry_ids:t,status:s}),tn=async t=>b.put(`/v1/entries/${t}/bookmark`),sn=async t=>b.get(`/v1/entries/${t}/fetch-content`),rn=async t=>b.raw(`/v1/entries/${t}/save`,{method:"POST"}),ae=(t,s={})=>{const{baseUrl:r,orderField:n,offset:a,limit:l,status:i}=t,o=O("orderDirection"),u=new URLSearchParams({order:n,direction:o,offset:a,limit:l,...s});return i&&u.append("status",i),`${r}?${u}`},nn=async(t=0,s=null)=>{const r=O("orderBy"),n=O("pageSize"),a=O("showAllFeeds"),l={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s},i={globally_visible:!a};return b.get(ae(l,i))},we=async(t=0,s=null,r=null)=>{const n=O("orderBy"),a=r??O("pageSize"),l=O("showAllFeeds"),i=Qr(),o={baseUrl:"/v1/entries",orderField:n,offset:t,limit:a,status:s},u={globally_visible:!l,published_after:i};return b.get(ae(o,u))},Kt=async(t=0,s=null)=>{const r=O("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},a={starred:"true"};return b.get(ae(n,a))},an=async(t=0)=>{const s=O("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return b.get(ae(r))},on=async()=>b.get("/v1/feeds"),ln=async()=>b.get("/v1/feeds/counters"),cn=async t=>b.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),dn=async()=>b.raw("/v1/feeds/refresh",{method:"PUT"}),un=async(t,s,r)=>b.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),hn=async t=>b.raw(`/v1/feeds/${t}`,{method:"DELETE"}),qt=async(t,s)=>{const{categoryId:r,title:n,siteUrl:a,feedUrl:l,hidden:i,disabled:o,isFullText:u}=s;return b.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:a,feed_url:l,hide_globally:i,disabled:o,crawler:u})},fn=async t=>b.put(`/v1/feeds/${t}/mark-all-as-read`),pn=async()=>b.get("/v1/me"),mn=async t=>b.get(`/v1/icons/${t}`),gn=async()=>b.get("/v1/version"),xn=async()=>{const t=await pn();return b.put(`/v1/users/${t.data.id}/mark-all-as-read`)},Wt={isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1},P=ne(Wt),nt=H(P,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(a=>({...a,unreadCount:s[a.id]??0})).sort((a,l)=>a.title.localeCompare(l.title,"en"))}),ge=H([P,nt],(t,s)=>{const{categoriesData:r}=t;return r.map(a=>{const l=s.filter(i=>i.category.id===a.id);return{...a,unreadCount:l.reduce((i,o)=>i+(o.unreadCount??0),0),feedCount:l.length}}).sort((a,l)=>a.title.localeCompare(l.title,"en"))}),Gt=H(ge,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),at=H([nt,Gt],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Yt=H([nt,at,w],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),yn=H([ge,Gt,w],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),Jt=H(Yt,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),_n=H([P,Yt],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[a,l])=>s.some(i=>i.id===Number(a))?n+l:n,0)}),Ce=T(P,"categoriesData"),Z=T(P,"feedsData"),Te=T(P,"historyCount"),jt=T(P,"isAppDataReady"),Fe=T(P,"starredCount"),ot=T(P,"unreadInfo"),it=T(P,"unreadTodayCount"),jn=T(P,"isVersionAtLeast2_2_0"),bn=()=>P.set(Wt),Xt=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(l=>l.id===n.id)||n)},qe=(t,s)=>{const r={};let n=0;const a=t.filter(d=>d.status!==s);if(a.length===0)return;const{showStatus:l}=w.get();s==="read"?(Te(d=>d+a.length),l==="unread"&&Ne(d=>d-a.length)):(Te(d=>Math.max(0,d-a.length)),l==="unread"&&Ne(d=>d+a.length));for(const d of a){const c=d.feed.id,h=Xr(d.published_at),g=s==="read"?-1:1;r[c]=(r[c]??0)+g,n+=h?g:0}it(d=>Math.max(0,d+n)),ot(d=>{const c={...d};for(const[h,g]of Object.entries(r))c[h]=Math.max(0,(c[h]??0)+g);return c});const i=a.map(d=>({...d,status:s})),{activeContent:o}=A.get(),u=i.find(d=>d.id===(o==null?void 0:o.id));u&&W(u),xe(d=>Xt(d,i))},Ve=()=>{const{activeContent:t}=f(A),{polyglot:s}=f(F),r=(u,d)=>{qe([u],d)},n=(u,d)=>{d?(Fe(h=>h+1),Ts({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Fe(h=>Math.max(0,h-1));const c={...u,starred:d};t&&W(c),xe(h=>Xt(h,[c]))};return{handleEntryStatusUpdate:r,handleFetchContent:async()=>{try{const u=await sn(t.id);j.success(s.t("actions.fetched_content_success")),W({...t,content:u.content})}catch(u){console.error("Failed to fetch content: ",u),j.error(s.t("actions.fetched_content_error"))}},handleSaveToThirdPartyServices:async()=>{try{(await rn(t.id)).status===202?j.success(s.t("actions.saved_to_third-party_services_success")):j.error(s.t("actions.saved_to_third-party_services_error"))}catch(u){console.error("Failed to save to third-party services: ",u),j.error(s.t("actions.saved_to_third-party_services_error"))}},handleToggleStarred:async u=>{const d=!u.starred;n(u,d),tn(u.id).catch(()=>{j.error(d?s.t("actions.star_error"):s.t("actions.unstar_error")),n(u,!d)})},handleToggleStatus:async u=>{const d=u.status,c=d==="read"?"unread":"read";r(u,c),Oe([u.id],c).catch(()=>{j.error(c==="read"?s.t("actions.mark_as_read_error"):s.t("actions.mark_as_unread_error")),r(u,d)})}}},vn=(t,s)=>{const{polyglot:r}=F.get();if(t.length===0||s==="none")return t;const n=t.map((c,h)=>({id:c.id,index:h})),a=new Map,l=new Map,i=new Map,o=[],u=t.slice().sort((c,h)=>c.id-h.id).filter(c=>{const{hash:h,title:g,url:_,id:m}=c;switch(s){case"hash":if(a.has(h))return o.push(c),!1;a.set(h,m);break;case"title":if(l.has(g))return o.push(c),!1;l.set(g,m);break;case"url":if(i.has(_))return o.push(c),!1;i.set(_,m);break;default:return!0}return!0}),d=o.filter(c=>c.status==="unread").map(c=>c.id);return d.length>0&&(qe(o,"read"),Oe(d,"read").catch(()=>{j.error(r.t("deduplicate.mark_as_read_error")),qe(o,"unread")})),u.sort((c,h)=>{const g=n.find(m=>m.id===c.id).index,_=n.find(m=>m.id===h.id).index;return g-_})},Sn=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},_e=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,a=r?s.toLowerCase():s;if(a.length===0)return 0;const l=Sn(a);let i=0,o=0;for(;i<n.length;)if(n[i]===a[o]?(i++,o++):o!==0?o=l[o-1]:i++,o===a.length)return i-o;return-1},wn=t=>{const s=[],r=[];let n=[];const a=[],l=t.match(/([-+|]?)\s*"([^"]+)"/g);let i=t;l&&(n=l.map(u=>{const d=u.trim()[0],c=u.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(c);break;case"+":s.push(c);break;case"|":a.push([c]);break;default:s.push(c);break}return c}),i=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const o=i.split(/\s+/);for(const u of o){const d=u.replace(/^-|\+|\|$/,"");if(u.startsWith("-")&&d)r.push(d);else if(u.startsWith("+")&&d)s.push(d);else if(u.includes("|")){const c=u.split("|").filter(h=>h);c.length>0&&a.push(c)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:a}},Cn=(t,s,r=[],n=!0)=>{const{includeTerms:a,excludeTerms:l,exactPhrases:i,orConditions:o}=wn(s);return t.filter(u=>r.some(d=>{const c=u[d];if(typeof c!="string")return!1;const h=n?c.toLowerCase():c;if(l.some(m=>_e(h,m,n)!==-1)||i.length>0&&!i.some(m=>_e(h,m,n)!==-1))return!1;const g=a.every(m=>_e(h,m,n)!==-1),_=o.length===0||o.some(m=>m.some(y=>_e(h,y,n)!==-1));return g&&_}))},Qt=(t,s,r=[],n=!0)=>!Array.isArray(t)||t.length===0?(console.error("Invalid data input:",{receivedData:t,type:typeof t,isArray:Array.isArray(t),length:Array.isArray(t)?t.length:"N/A"}),[]):typeof s!="string"||s.trim().length===0?(console.error("Invalid query input:",{receivedQuery:s,type:typeof s,trimmedLength:typeof s=="string"?s.trim().length:"N/A"}),[]):Cn(t,s,r,n),kn=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),In=(t,s,r)=>r?Qt(t,r,[s]):t,Zt={activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:O("homePage"),isArticleListReady:!1,isArticleLoading:!1,loadMoreVisible:!1,offset:0,total:0},A=ne(Zt),ze=H([A,P,at,w],(t,s,r,n)=>{const{entries:a,filterString:l,filterType:i,infoFrom:o}=t,u=In(a,i,l),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:c,showAllFeeds:h}=n,g=!["starred","history"].includes(o),_=y=>d||h||!r.includes(y.feed.id),m=g?u.filter(_):u;return c==="none"||["starred","history"].includes(o)?m:vn(m,c)}),es=H([A,ze],(t,s)=>{const{activeContent:r}=t;return r?s.findIndex(n=>n.id===r.id):-1}),W=T(A,"activeContent"),xe=T(A,"entries"),Ae=T(A,"filterString"),Le=T(A,"filterType"),En=T(A,"infoFrom"),bt=T(A,"isArticleListReady"),vt=T(A,"isArticleLoading"),ts=T(A,"loadMoreVisible"),Ne=T(A,"offset"),Tn=T(A,"total"),Fn=()=>A.set(Zt),St=ne(),je=new Set,An=t=>{const s=f(St);return p.useEffect(()=>{s[t]||je.has(t)||(je.add(t),mn(t).then(r=>{const n=`data:${r.data}`;St.setKey(t,n),je.delete(t)}).catch(()=>{je.delete(t)}))},[t,s]),s[t]},Ln=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},wt=t=>{const s=Ln(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},Nn=t=>`https://icons.duckduckgo.com/ip3/${wt(t.site_url)??wt(t.feed_url)}.ico`,ss=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,n=Nn(t);if(r===0)return e.jsx("img",{className:s,src:n,alt:""});const[a,l]=p.useState(n),i=An(r);return p.useEffect(()=>{i&&l(i)},[i]),e.jsx("img",{className:s,src:a,alt:"",onError:()=>l(n)})},rs=Y.Item,Pn=({category:t,path:s})=>{var i;const n=(i=f(Jt)[t.id])==null?void 0:i.reduce((o,u)=>o+u.unreadCount,0),a=ee(),l=()=>{a(`/category/${t.id}`),W(null)};return e.jsxs("div",{className:Re("category-title",{"submenu-active":s===`/category/${t.id}`,"submenu-inactive":s!==`/category/${t.id}`}),onClick:l,onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&l()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(I.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(I.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},Rn=({count:t})=>e.jsx(I.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),be=({path:t,Icon:s,label:r,count:n})=>{const a=Pe(),l=ee(),i=a.pathname===t,o=()=>{l(t),W(null)};return e.jsx(rs,{onClick:o,className:Re("arco-menu-item",{"arco-menu-selected":i}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(Rn,{count:n})]})},t)},Mn=()=>{const{historyCount:t,starredCount:s,unreadTodayCount:r}=f(P),{polyglot:n}=f(F),a=f(_n);return e.jsxs(e.Fragment,{children:[e.jsx(be,{path:"/all",Icon:Ls,label:n.t("sidebar.all"),count:a}),e.jsx(be,{path:"/today",Icon:Ns,label:n.t("sidebar.today"),count:r}),e.jsx(be,{path:"/starred",Icon:Je,label:n.t("sidebar.starred"),count:s}),e.jsx(be,{path:"/history",Icon:Ps,label:n.t("sidebar.history"),count:t})]})},Dn=({feed:t})=>{const{showFeedIcon:s}=f(w),r=ee();return e.jsx(rs,{style:{position:"relative",overflow:"hidden"},onClick:n=>{n.stopPropagation(),r(`/feed/${t.id}`),W(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(I.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:t.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[s&&e.jsx(ss,{feed:t,className:"feed-icon-sidebar"}),t.title]}),t.unreadCount!==0&&e.jsx(I.Ellipsis,{className:"item-count",expandable:!1,children:t.unreadCount})]})},`/feed/${t.id}`)},On=({categoryId:t})=>{var n;const{showUnreadFeedsOnly:s}=f(w),r=f(Jt);return e.jsx(e.Fragment,{children:(n=r[t])==null?void 0:n.filter(a=>!s||a.unreadCount>0).map(a=>e.jsx(Dn,{feed:a},`/feed/${a.id}`))})},Vn=()=>{const{showUnreadFeedsOnly:t}=f(w),s=f(yn),n=Pe().pathname;return s.filter(a=>!t||a.unreadCount>0).map(a=>e.jsx(Ft.Item,{name:`/category/${a.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(Pn,{category:a,path:n}),expandIcon:e.jsx(Rs,{}),children:e.jsx(On,{categoryId:a.id})},a.id))},ns=()=>{const{homePage:t}=f(w),{isAppDataReady:s}=f(P),{polyglot:r}=f(F),n=Pe(),[a,l]=p.useState([`/${t}`]),i=n.pathname;return p.useEffect(()=>{l([i])},[i]),e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(Y,{hasCollapseButton:!1,selectedKeys:a,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(Fs,{className:"avatar",size:32,children:e.jsx(As,{style:{color:"var(--color-bg-1)"}})}),e.jsx(I.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(I.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:r.t("sidebar.articles")}),e.jsx(ke,{loading:!s,animation:!0,text:{rows:3}}),s&&e.jsx(Mn,{}),e.jsx(I.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:r.t("sidebar.feeds")})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx(Ye,{style:{maxHeight:"100%"},autoHide:!0,children:e.jsxs(Y,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:a,children:[e.jsx(ke,{loading:!s,animation:!0,text:{rows:6}}),s&&e.jsx(Ft,{triggerRegion:"icon",bordered:!1,children:e.jsx(Vn,{})})]})})})]})},zn=()=>{const{showAllFeeds:t,theme:s}=f(w),{polyglot:r}=f(F),n=[{label:r.t("header.theme_option_light"),value:"light"},{label:r.t("header.theme_option_dark"),value:"dark"},{label:r.t("header.theme_option_system"),value:"system"}],a=ee(),l=Pe().pathname,{setAddFeedModalVisible:i,setSettingsModalVisible:o}=rt(),{isBelowLarge:u}=me(),[d,c]=p.useState(!1),[h,g]=p.useState(!1),[_,m]=p.useState(!1);p.useEffect(()=>{u||c(!1)},[u]),p.useEffect(()=>{l&&c(!1)},[l]);const y=()=>{z({showAllFeeds:!t})},C=()=>{z({theme:s==="light"?"dark":"light"})},v=()=>{Or(),g(!1)},R=()=>{Br(),Fn(),bn(),a("/login"),j.success(r.t("header.logout_success"))},x=()=>s==="dark"?e.jsx(Bs,{}):s==="system"?e.jsx(Hs,{}):e.jsx(Ks,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(E,{className:"trigger",onClick:()=>c(!d),shape:"circle",size:"small",children:e.jsx(Ms,{})})}),e.jsx(Ds,{className:"sidebar-drawer",visible:d,title:null,footer:null,closable:!1,onCancel:()=>c(!1),placement:"left",width:240,children:e.jsx(ns,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(he,{size:16,children:[e.jsx(re,{content:r.t("header.add_feed"),mini:!0,children:e.jsx(E,{shape:"circle",size:"small",type:"primary",icon:e.jsx(Xe,{}),onClick:()=>i(!0)})}),e.jsx(re,{content:t?r.t("header.hide_some_feeds"):r.t("header.show_all_feeds"),mini:!0,children:e.jsx(E,{shape:"circle",size:"small",icon:t?e.jsx(Os,{}):e.jsx(Vs,{}),onClick:y})}),e.jsx(E,{shape:"circle",size:"small",icon:e.jsx(zs,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(mt,{droplist:e.jsx(Y,{defaultSelectedKeys:[s],className:"theme-menu",children:n.map(({label:k,value:V})=>e.jsxs(Y.Item,{className:"theme-menu-item",onClick:()=>z({theme:V}),children:[k,s===V&&e.jsx(At,{style:{marginLeft:8}})]},V))}),children:e.jsx(E,{icon:x(),shape:"circle",size:"small",onClick:C})}),e.jsx(mt,{droplist:e.jsxs(Y,{children:[e.jsxs(Y.Item,{onClick:()=>o(!0),children:[e.jsx(Us,{className:"icon-right"}),r.t("header.settings")]},"0"),e.jsxs(Y.Item,{onClick:()=>g(!0),children:[e.jsx(pe,{className:"icon-right"}),r.t("header.reset_settings")]},"1"),e.jsxs(Y.Item,{onClick:()=>m(!0),children:[e.jsx($s,{className:"icon-right"}),r.t("header.logout")]},"2")]}),trigger:"click",children:e.jsx(E,{icon:e.jsx(Lt,{}),shape:"circle",size:"small"})})]})}),e.jsx(J,{title:r.t("header.settings_reset_confirm"),visible:h,onOk:v,onCancel:()=>g(!1),children:e.jsx("p",{children:r.t("header.settings_reset_description")})}),e.jsx(J,{title:r.t("header.logout_confirm"),visible:_,onOk:R,onCancel:()=>m(!1),children:e.jsx("p",{children:r.t("header.logout_description")})})]})},Un=(t,s)=>{const r=t.split("."),n=s.split(".");for(let a=0;a<Math.max(r.length,n.length);a++){const l=r[a]||"0",i=n[a]||"0",o=l.localeCompare(i,void 0,{numeric:!0});if(o!==0)return o}return 0},lt=()=>{const t=p.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,jt(!1);try{const r=await Promise.all([ln(),we(0,"unread"),Kt(),on(),qr(),gn()]),[n,a,l,i,o,u]=r,d=i.reduce((h,g)=>(h[g.id]=n.unreads[g.id]??0,h),{}),c=Object.values(n.reads).reduce((h,g)=>h+g,0);ot(d),it(a.total??0),Fe(l.total??0),Te(c),Z(i),Ce(o),jn(Un(u.version,"2.2.0")>=0),jt(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},as=p.createContext(),$n=({children:t})=>{const s=f(F),r=p.useRef(null),n=p.useRef(null),{handleEntryStatusUpdate:a}=Ve(),i={entryDetailRef:r,entryListRef:n,handleEntryClick:async o=>{vt(!0),W({...o,status:"read"}),setTimeout(()=>{const u=r.current;if(u){const d=u.querySelector(".simplebar-content-wrapper");d&&d.scroll({top:0}),u.focus()}vt(!1),o.status==="unread"&&(a(o,"read"),Oe([o.id],"read").catch(()=>{j.error(s.t("content.mark_as_read_error")),W({...o,status:"unread"}),a(o,"unread")}))},200)}};return e.jsx(as.Provider,{value:i,children:t})},os=()=>p.useContext(as),We={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Green:{light:"#00B42A",dark:"#27C346"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Magenta:{light:"#F5319D",dark:"#F756A9"}},fe=t=>{const s=We[t]||We.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=O("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},is=t=>{qs(fe(t),{list:!0}).map(Ws).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},U=({title:t,description:s,children:r})=>e.jsxs("section",{className:"setting-row",children:[e.jsxs("header",{children:[e.jsx(I.Title,{heading:6,style:{marginTop:0},children:t}),e.jsx(I.Text,{type:"secondary",children:s})]}),r]}),Bn=()=>{const{articleWidth:t,fontSize:s,fontFamily:r,layout:n,showDetailedRelativeTime:a,showFeedIcon:l,themeColor:i}=f(w),{polyglot:o}=f(F),u=[{label:o.t("appearance.font_family_system"),value:"system-ui"},{label:"Sans-serif",value:"sans-serif"},{label:"Serif",value:"serif"},{label:"Fira Sans",value:"'Fira Sans', sans-serif"},{label:"Open Sans",value:"'Open Sans', sans-serif"},{label:"Source Sans Pro",value:"'Source Sans Pro', sans-serif"},{label:"Source Serif Pro",value:"'Source Serif Pro', serif"},{label:o.t("appearance.font_family_noto_sans"),value:"'Noto Sans SC', sans-serif"},{label:o.t("appearance.font_family_noto_serif"),value:"'Noto Serif SC', serif"},{label:o.t("appearance.font_family_lxgw_wenkai"),value:"'LXGW WenKai Screen', sans-serif"}],d=c=>{z(c),c.themeColor&&is(c.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:o.t("appearance.theme_color_label"),description:o.t("appearance.theme_color_description"),children:e.jsx("div",{style:{display:"flex"},children:Object.keys(We).map(c=>e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:fe(c),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:c===i?`1px solid ${fe(c)}`:"none"},onClick:()=>d({themeColor:c}),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&d({themeColor:c})},"aria-label":o.t("appearance.theme_color_aria_label",{color:c}),role:"button",tabIndex:0},c))})}),e.jsx($,{}),e.jsx(U,{title:o.t("appearance.compact_article_list_label"),description:o.t("appearance.compact_article_list_description"),children:e.jsx(q,{checked:n==="small",onChange:c=>d({layout:c?"small":"large"})})}),e.jsx($,{}),e.jsx(U,{title:o.t("appearance.show_detailed_relative_time_label"),description:o.t("appearance.show_detailed_relative_time_description"),children:e.jsx(q,{checked:a,onChange:c=>d({showDetailedRelativeTime:c})})}),e.jsx($,{}),e.jsx(U,{title:o.t("appearance.show_feed_icon_label"),description:o.t("appearance.show_feed_icon_description"),children:e.jsx(q,{checked:l,onChange:c=>d({showFeedIcon:c})})}),e.jsx($,{}),e.jsx(U,{title:o.t("appearance.font_family_label"),description:o.t("appearance.font_family_description"),children:e.jsx(L,{style:{width:166},value:r,onChange:c=>d({fontFamily:c}),children:u.map(({label:c,value:h})=>e.jsx(L.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:o.t("appearance.font_size_label"),description:o.t("appearance.font_size_description"),children:e.jsxs(he,{children:[e.jsx(I.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(gt,{formatTooltip:c=>`${c}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:c=>d({fontSize:c})}),e.jsx(I.Text,{style:{fontSize:"1.25rem"},children:"A"})]})}),e.jsx($,{}),e.jsx(U,{title:o.t("appearance.article_width_label"),description:o.t("appearance.article_width_description"),children:e.jsxs(he,{children:[e.jsx(I.Text,{children:"60%"}),e.jsx(gt,{formatTooltip:c=>`${c}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:c=>d({articleWidth:c})}),e.jsx(I.Text,{children:"90%"})]})})]})},Hn=()=>{const t=f(ge),{polyglot:s}=f(F),[r]=N.useForm(),[n,a]=p.useState(!1),[l,i]=p.useState(""),[o,u]=p.useState({}),[d,c]=p.useState(!1),h=async()=>{if(!l.trim()){c(!1);return}try{const m=await Wr(l);Ce(y=>[...y,{...m}]),j.success(s.t("category_list.add_category_success"))}catch(m){console.error(`${s.t("category_list.add_category_error")}: `,m),j.error(s.t("category_list.add_category_error"))}i(""),c(!1)},g=async(m,y,C)=>{try{const v=await Yr(m,y,C);Z(R=>R.map(x=>x.category.id===m?{...x,category:{...x.category,title:y,hide_globally:C}}:x)),Ce(R=>R.map(x=>x.id===m?{...x,...v}:x)),j.success(s.t("category_list.update_category_success"))}catch{j.error(s.t("category_list.update_category_error"))}a(!1),r.resetFields()},_=async m=>{try{(await Gr(m.id)).status===204?(Ce(C=>C.filter(v=>v.id!==m.id)),j.success(s.t("category_list.remove_category_success",{title:m.title}))):j.error(s.t("category_list.remove_category_error",{title:m.title}))}catch(y){console.error(s.t("category_list.remove_category_error",{title:m.title}),y),j.error(s.t("category_list.remove_category_error",{title:m.title}))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(m=>e.jsx(Q,{className:"tag-style",closable:m.feedCount===0,size:"medium",onClick:()=>{u(m),a(!0),r.setFieldsValue({title:m.title})},onClose:async y=>{y.stopPropagation(),await _(m)},children:m.title},m.id)),d?e.jsx(B,{autoFocus:!0,className:"input-style",onBlur:h,onChange:i,onPressEnter:h,size:"small",value:l}):e.jsx(Q,{className:"add-category-tag",icon:e.jsx(Xe,{}),onClick:()=>c(!0),size:"medium",tabIndex:0})]}),o&&e.jsx(J,{className:"modal-style",onOk:r.submit,title:"Edit Category",unmountOnExit:!0,visible:n,onCancel:()=>{a(!1),r.resetFields()},children:e.jsxs(N,{form:r,layout:"vertical",onSubmit:m=>g(o.id,m.title,m.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(N.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(B,{placeholder:"Please input category title"})}),e.jsx(N.Item,{label:"Hidden",field:"hidden",initialValue:o.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(q,{})})]})})]})},Kn=t=>new Promise(s=>setTimeout(s,t)),qn=(t,s,r=!1)=>{let n;return function(...a){const l=()=>{n=null,r||t.apply(this,a)},i=r&&!n;clearTimeout(n),n=setTimeout(l,s),i&&t.apply(this,a)}},ls=Qe(""),Ct=T(ls),ct=Qe("title"),Wn=T(ct),dt=H([P,ls,ct],(t,s,r)=>{const{feedsData:n}=t,a=[...n].sort((l,i)=>l.disabled&&!i.disabled?1:!l.disabled&&i.disabled?-1:0).sort((l,i)=>i.parsing_error_count-l.parsing_error_count);return s?Qt(a,s,[r]):a}),Gn=H(dt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),cs=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:Zr()}:t,ds=async(t,s,r=!0)=>{const{polyglot:n}=F.get();try{const l=(await t()).status===204;return r&&(l?j.success(n.t("feed_table.refresh_success")):j.error(n.t("feed_table.refresh_error"))),Z(i=>i.map(o=>s(o,l))),l}catch(a){return console.error("Failed to refresh feed: ",a),r&&j.error(n.t("feed_table.refresh_error")),Z(l=>l.map(i=>s(i,!1))),!1}},us=async(t,s=!0)=>{const r=t.id||t.key;return ds(()=>cn(r),(n,a)=>cs(n,a,r),s)},Yn=({visible:t,setVisible:s})=>{const{polyglot:r}=f(F),n=f(dt),a=async()=>{s(!1),await ds(dn,cs)},l=async()=>{s(!1);const o=n.filter(c=>c.parsing_error_count>0);j.success(r.t("feed_table.bulk_refresh_error_feeds_message"));let u=0,d=0;for(const c of o)await us(c,!1)?u++:d++,await Kn(500);j.success(r.t("feed_table.bulk_refresh_error_feeds_result",{success:u,failure:d}))},i=()=>s(!1);return e.jsxs(e.Fragment,{children:[e.jsx(E,{icon:e.jsx(pe,{}),shape:"circle",size:"small",onClick:()=>s(!0)}),e.jsx(J,{className:"edit-modal",onCancel:i,title:r.t("feed_table.refresh_feeds_title"),visible:t,footer:[e.jsx(E,{onClick:i,children:r.t("feed_table.refresh_feeds_cancel")},"cancel"),e.jsx(E,{type:"outline",onClick:l,children:r.t("feed_table.refresh_feeds_error")},"error"),e.jsx(E,{type:"primary",onClick:a,children:r.t("feed_table.refresh_feeds_all")},"all")],children:e.jsx("p",{children:r.t("feed_table.refresh_feeds_description")})})]})},Jn=({visible:t,setVisible:s})=>{const{polyglot:r}=f(F),n=f(dt),[a,l]=p.useState(""),i=async()=>{try{const o=await Promise.all(n.map(async d=>{const c=new URL(d.feed_url).hostname;if(c===a)return d;const h=d.feed_url.replace(c,a),g=await qt(d.id,{feedUrl:h});return{...d,...g}})),u=(d,c)=>c.find(g=>g.id===d.id)||d;Z(d=>d.map(c=>u(c,o))),j.success(r.t("feed_table.bulk_update_success")),s(!1)}catch(o){console.error("Failed to bulk update feeds: ",o),j.error(r.t("feed_table.bulk_update_error"))}};return e.jsxs(J,{className:"edit-modal",onOk:i,title:r.t("feed_table.modal_bulk_update_title"),visible:t,onCancel:()=>{s(!1),l("")},children:[e.jsx("p",{children:r.t("feed_table.modal_bulk_update_description")}),e.jsx(B,{placeholder:"rsshub.app",value:a,onChange:o=>l(o)})]})},Xn=({visible:t,setVisible:s,feedForm:r,selectedFeed:n})=>{const{polyglot:a}=f(F),l=f(ge),i=async(o,u)=>{try{const d=await qt(o,u);Z(c=>c.map(h=>h.id===o?{...h,...d}:h)),j.success(a.t("feed_table.update_feed_success")),s(!1),r.resetFields()}catch(d){console.error("Failed to update feed: ",d),j.error(a.t("feed_table.update_feed_error"))}};return e.jsx(J,{className:"edit-modal",onOk:r.submit,title:a.t("feed_table.modal_edit_feed_title"),unmountOnExit:!0,visible:t,onCancel:()=>{s(!1),r.resetFields()},children:e.jsxs(N,{form:r,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async o=>{const u={categoryId:o.category,title:o.title,siteUrl:o.siteUrl.trim(),feedUrl:o.feedUrl.trim(),hidden:o.hidden,disabled:o.disabled,isFullText:o.crawler};u.feedUrl?await i(n.key,u):j.error(a.t("feed_table.modal_edit_feed_submit_error"))},children:[e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_category_label"),required:!0,field:"category",rules:[{required:!0}],children:e.jsx(L,{children:l.map(o=>e.jsx(L.Option,{value:o.id,children:o.title},o.id))})}),e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(B,{placeholder:a.t("feed_table.modal_edit_feed_title_placeholder")})}),e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_site_url_label"),field:"siteUrl",rules:[{required:!0}],children:e.jsx(B,{placeholder:a.t("feed_table.modal_edit_feed_site_url_placeholder")})}),e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_feed_url_label"),field:"feedUrl",rules:[{required:!0}],children:e.jsx(B,{placeholder:a.t("feed_table.modal_edit_feed_feed_url_placeholder")})}),e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_hidden_label"),field:"hidden",initialValue:n.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(q,{})}),e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_disabled_label"),field:"disabled",initialValue:n.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(q,{})}),e.jsx(N.Item,{label:a.t("feed_table.modal_edit_feed_crawler_label"),field:"crawler",tooltip:e.jsx("div",{children:a.t("feed_table.modal_edit_feed_crawler_tooltip")}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(q,{})})]})})},Qn=()=>{const{isAppDataReady:t}=f(P),{showDetailedRelativeTime:s}=f(w),r=f(ct),n=f(Gn),{polyglot:a}=f(F),l=a.t("search.tooltip").split(`
`),[i,o]=p.useState(!1),[u,d]=p.useState(!1),[c,h]=p.useState(!1),[g]=N.useForm(),[_,m]=p.useState(null),{isBelowMedium:y}=me();p.useEffect(()=>{Ct("")},[]);const C=x=>{m(x),h(!0),g.setFieldsValue({category:x.category.id,title:x.title,siteUrl:x.site_url,feedUrl:x.feed_url,hidden:x.hidden,disabled:x.disabled,crawler:x.crawler})},v=async x=>{try{(await hn(x.key)).status===204?(Z(V=>V.filter(K=>K.id!==x.key)),j.success(a.t("feed_table.remove_feed_success",{title:x.title}))):j.error(a.t("feed_table.remove_feed_error",{title:x.title}))}catch(k){console.error(`Failed to unfollow feed: ${x.title}`,k),j.error(a.t("feed_table.remove_feed_error",{title:x.title}))}},R=[{title:a.t("feed_table.table_title"),dataIndex:"title",sorter:(x,k)=>x.title.localeCompare(k.title,"en"),render:(x,k)=>{const V=k.parsing_error_count;let K=k.disabled?`ðŸš« ${x}`:x;V>0&&(K=`âš ï¸ ${x}`);const X=e.jsxs("div",{children:[x,V>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"âš ï¸ Parsing error count: ",V]})]});return e.jsx(I.Ellipsis,{expandable:!1,children:e.jsx(re,{mini:!0,content:X,children:K})})}},!y&&{title:a.t("feed_table.table_url"),dataIndex:"feed_url",sorter:(x,k)=>x.feed_url.localeCompare(k.feed_url,"en"),render:x=>e.jsx(I.Ellipsis,{expandable:!1,showTooltip:!0,children:x})},{title:a.t("feed_table.table_category"),dataIndex:"category.title",sorter:(x,k)=>x.category.title.localeCompare(k.category.title,"en"),render:x=>e.jsx(I.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(Q,{children:x})})},!y&&{title:a.t("feed_table.table_checked_at"),dataIndex:"checked_at",sorter:(x,k)=>x.checked_at.localeCompare(k.checked_at,"en"),render:x=>e.jsx(I.Ellipsis,{expandable:!1,children:Bt(x,s)})},{title:a.t("feed_table.table_actions"),dataIndex:"op",fixed:"right",width:100,render:(x,k)=>e.jsxs(he,{children:[e.jsx("button",{"aria-label":a.t("feed_table.table_feed_edit_label"),className:"list-item-action",onClick:()=>C(k),type:"button",children:e.jsx(xt,{})}),e.jsx("button",{"aria-label":a.t("feed_table.table_feed_refresh_label"),className:"list-item-action",onClick:()=>us(k),type:"button",children:e.jsx(pe,{})}),e.jsx(Nt,{focusLock:!0,position:"left",title:a.t("feed_table.table_feed_remove_confirm"),onOk:()=>v(k),children:e.jsx("span",{className:"list-item-action",children:e.jsx(Gs,{})})})]})}].filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"feed-table-action-bar",children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(B.Search,{allowClear:!0,className:"search-input",onChange:Ct,placeholder:a.t("search.placeholder"),addBefore:e.jsxs(L,{onChange:Wn,style:{width:126},value:r,children:[e.jsx(L.Option,{value:"title",children:a.t("search.type_title")}),e.jsx(L.Option,{value:"feed_url",children:a.t("search.type_feed_url")}),e.jsx(L.Option,{value:"site_url",children:a.t("search.type_site_url")})]})})}),e.jsxs("div",{className:"button-group",children:[e.jsx(re,{mini:!0,position:"bottom",content:e.jsx("div",{children:l.map((x,k)=>e.jsxs(p.Fragment,{children:[x,k<l.length-1&&e.jsx("br",{})]},`line-${k}-${x.length}`))}),children:e.jsx(E,{shape:"circle",size:"small",icon:e.jsx(Pt,{})})}),e.jsx(E,{icon:e.jsx(xt,{}),shape:"circle",size:"small",onClick:()=>o(!0)}),e.jsx(Jn,{visible:i,setVisible:o}),e.jsx(Yn,{visible:u,setVisible:d})]})]}),e.jsx(Rt,{borderCell:!0,className:"feed-table",columns:R,data:n,loading:!t,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),_&&e.jsx(Xn,{visible:c,setVisible:h,feedForm:g,selectedFeed:_})]})},Zn=[{label:"English",value:"en-US"},{label:"EspaÃ±ol",value:"es-ES"},{label:"ç®€ä½“ä¸­æ–‡",value:"zh-CN"}],ea=()=>{const{homePage:t,language:s,markReadOnScroll:r,orderBy:n,pageSize:a,removeDuplicates:l,showUnreadFeedsOnly:i}=f(w),{polyglot:o}=f(F),u=[{label:o.t("settings.default_home_page_option_all"),value:"all"},{label:o.t("settings.default_home_page_option_today"),value:"today"},{label:o.t("settings.default_home_page_option_starred"),value:"starred"},{label:o.t("settings.default_home_page_option_history"),value:"history"}],d=[{label:o.t("settings.remove_duplicates_option_none"),value:"none"},{label:o.t("settings.remove_duplicates_option_hash"),value:"hash"},{label:o.t("settings.remove_duplicates_option_title"),value:"title"},{label:o.t("settings.remove_duplicates_option_url"),value:"url"}];return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:o.t("appearance.language_label"),description:o.t("appearance.language_description"),children:e.jsx(L,{className:"input-select",onChange:c=>z({language:c}),value:s,children:Zn.map(({label:c,value:h})=>e.jsx(L.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:o.t("settings.default_home_page_label"),description:o.t("settings.default_home_page_description"),children:e.jsx(L,{className:"input-select",onChange:c=>z({homePage:c}),value:t,children:u.map(({label:c,value:h})=>e.jsx(L.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:o.t("settings.show_unread_feeds_only_label"),description:o.t("settings.show_unread_feeds_only_description"),children:e.jsx(q,{checked:i,onChange:c=>z({showUnreadFeedsOnly:c})})}),e.jsx($,{}),e.jsx(U,{title:o.t("settings.entries_order_label"),description:o.t("settings.entries_order_description"),children:e.jsxs(L,{className:"input-select",onChange:c=>z({orderBy:c}),value:n,children:[e.jsx(L.Option,{value:"published_at",children:o.t("settings.entries_order_option_published_at")}),e.jsx(L.Option,{value:"created_at",children:o.t("settings.entries_order_option_created_at")})]})}),e.jsx($,{}),e.jsx(U,{title:o.t("settings.entries_per_page_label"),description:o.t("settings.entries_per_page_description"),children:e.jsx(Ys,{className:"input-select",defaultValue:a,min:1,mode:"button",onChange:c=>z({pageSize:c}),size:"small"})}),e.jsx($,{}),e.jsx(U,{title:o.t("settings.remove_duplicates_label"),description:o.t("settings.remove_duplicates_description"),children:e.jsx(L,{className:"input-select",onChange:c=>z({removeDuplicates:c}),value:l,children:d.map(({label:c,value:h})=>e.jsx(L.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:o.t("settings.mark_read_on_scroll_label"),description:o.t("settings.mark_read_on_scroll_description"),children:e.jsx(q,{checked:r,onChange:c=>z({markReadOnScroll:c})})})]})},hs={exitDetailView:["esc"],fetchOriginalArticle:["d"],navigateToNextArticle:["n","j","right"],navigateToNextUnreadArticle:["N","J","ctrl+right"],navigateToPreviousArticle:["p","k","left"],navigateToPreviousUnreadArticle:["P","K","ctrl+left"],openLinkExternally:["v"],openPhotoSlider:["i"],saveToThirdPartyServices:["s"],toggleReadStatus:["m"],toggleStarStatus:["f"]},Ue=Ge("hotkeys",hs,{encode:JSON.stringify,decode:JSON.parse}),ut=H(Ue,t=>{const r=Object.values(t).flat().reduce((n,a)=>(n[a]=(n[a]||0)+1,n),{});return Object.entries(r).filter(([n,a])=>a>1).map(([n])=>n)}),ue=(t,s)=>{T(Ue,t)(s)},ta=t=>ue(t,hs[t]),sa=({value:t,onChange:s,onRemove:r,editOnMount:n=!1})=>{const a=f(ut),[l,i]=p.useState(n),o=()=>{i(!1)},u=p.useCallback(d=>{if(l){d.preventDefault();const{key:c,ctrlKey:h,shiftKey:g,altKey:_,metaKey:m}=d;if(["Control","Shift","Alt","Meta","CapsLock"].includes(c))return;let y=c;switch(c){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":y=c.replace("Arrow","").toLowerCase();break;case" ":y="space";break}const C=[];h&&C.push("ctrl"),g&&C.push("shift"),_&&C.push("alt"),m&&C.push("meta");const v=C.length>0?`${C.join("+")}+${y}`:y;s(v),i(!1)}},[l,s]);return p.useEffect(()=>(window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}),[u]),l?e.jsx(B,{autoFocus:!0,onBlur:o,onChange:s,onPressEnter:o,size:"mini",status:a.includes(t)?"error":void 0,style:{width:80},value:t}):e.jsx(Q,{closable:!!r,color:a.includes(t)?fe("Red"):void 0,onClick:()=>i(!0),onClose:d=>{d.stopPropagation(),r()},children:t})},kt=t=>t.trim().length>1?t.charAt(0).toUpperCase()+t.slice(1):t,ra=t=>t.map(s=>{const r=s.replace("left","â†").replace("right","â†’").replace("up","â†‘").replace("down","â†“");return r.includes("+")?r.split("+").map(kt).join(" + "):kt(r)}).join(" / "),na=({keys:t,record:s})=>{const r=f(ut),[n,a]=p.useState(!1),l=p.useRef(null);return p.useEffect(()=>{const i=o=>{l.current&&!l.current.contains(o.target)&&a(!1)};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[]),p.useEffect(()=>{if(!n){const i=t.filter(o=>o!=="");i.length!==t.length&&ue(s.action,i)}},[n]),e.jsx("div",{ref:l,children:n?e.jsxs(he,{wrap:!0,style:{marginBottom:-8},children:[t.map((i,o)=>e.jsx(sa,{value:i,editOnMount:i==="",onChange:u=>{const d=[...t];d[o]=u,ue(s.action,d)},onRemove:()=>{const u=t.filter((d,c)=>c!==o);ue(s.action,u)}},`${s.action}-${i}`)),e.jsx(Q,{icon:e.jsx(Xe,{}),style:{backgroundColor:"var(--color-fill-2)",border:"1px dashed var(--color-fill-3)",cursor:"pointer",width:"32px"},onClick:()=>{const i=[...t,""];ue(s.action,i)}}),e.jsx(E,{icon:e.jsx(pe,{}),onClick:()=>ta(s.action),shape:"circle",size:"mini"})]}):e.jsx(Q,{color:t.some(i=>r.includes(i))?fe("Red"):void 0,onClick:()=>a(!0),style:{cursor:"pointer"},children:ra(t)})})},aa=()=>{const{polyglot:t}=f(F),s=f(Ue),r=["navigateToPreviousArticle","navigateToPreviousUnreadArticle","navigateToNextArticle","navigateToNextUnreadArticle","openLinkExternally","toggleReadStatus","fetchOriginalArticle","toggleStarStatus","saveToThirdPartyServices","openPhotoSlider","exitDetailView"],n=[{title:t.t("hotkeys.key"),dataIndex:"keys",render:(l,i)=>e.jsx(na,{keys:l,record:i})},{title:t.t("hotkeys.function"),dataIndex:"description"}],a=r.map(l=>({action:l,key:l,keys:s[l],description:t.t(`hotkeys.${l}`)}));return e.jsx(Rt,{borderCell:!0,columns:n,data:a,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}})},oa=()=>{const{polyglot:t}=f(F),s=(r,n)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r,e.jsx("div",{style:{fontSize:"12px"},children:n})]});return e.jsxs(se,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(se.TabPane,{title:s(e.jsx(Js,{style:{fontSize:"20px"}}),t.t("settings.feeds")),children:e.jsx(Qn,{})},"1"),e.jsx(se.TabPane,{title:s(e.jsx(Xs,{style:{fontSize:"20px"}}),t.t("settings.categories")),children:e.jsx(Hn,{})},"2"),e.jsx(se.TabPane,{title:s(e.jsx(Qs,{style:{fontSize:"20px"}}),t.t("settings.general")),children:e.jsx(ea,{})},"3"),e.jsx(se.TabPane,{title:s(e.jsx(Zs,{style:{fontSize:"20px"}}),t.t("settings.appearance")),children:e.jsx(Bn,{})},"4"),e.jsx(se.TabPane,{title:s(e.jsx(er,{style:{fontSize:"20px"}}),t.t("settings.hotkeys")),children:e.jsx(aa,{})},"5")]})},ia=[{required:!0}],la=[{required:!0}],ca=[{type:"boolean"}],da=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=rt();return e.jsx(J,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(oa,{})})},ua=()=>{const t=f(ge),{polyglot:s}=f(F),{addFeedModalVisible:r,setAddFeedModalVisible:n}=rt(),[a,l]=p.useState(!1),[i]=N.useForm(),{fetchAppData:o}=lt(),u=async(d,c,h)=>{l(!0);try{await un(d,c,h),await o(),j.success(s.t("main.add_feed_success")),n(!1),i.resetFields()}catch(g){console.error("Failed to add a feed: ",g),j.error(s.t("main.add_feed_error"))}finally{l(!1)}};return e.jsx(J,{title:s.t("main.add_feed_modal_title"),visible:r,unmountOnExit:!0,style:{width:"400px"},onOk:i.submit,confirmLoading:a,onCancel:()=>{n(!1),i.resetFields()},children:e.jsxs(N,{form:i,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async d=>{const c=d.url.trim();c?await u(c,d.category,d.crawler):j.error(s.t("main.add_feed_url_empty"))},children:[e.jsx(N.Item,{label:s.t("main.add_feed_modal_feed_url_label"),field:"url",rules:ia,children:e.jsx(B,{placeholder:s.t("main.add_feed_modal_feed_url_placeholder")})}),e.jsx(N.Item,{field:"category",label:s.t("main.add_feed_modal_category_label"),required:!0,rules:la,children:e.jsx(L,{placeholder:s.t("main.add_feed_modal_category_placeholder"),showSearch:!0,filterOption:(d,c)=>kn(c.props.children,d),children:t.map(d=>e.jsx(L.Option,{value:d.id,children:d.title},d.id))})}),e.jsx(N.Item,{field:"crawler",initialValue:!1,label:s.t("main.add_feed_modal_crawler_label"),rules:ca,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(q,{})})]})})},ha=()=>e.jsxs("div",{className:"main",children:[e.jsx($n,{children:e.jsx(tr,{})}),e.jsx(da,{}),e.jsx(ua,{})]}),fs=()=>{const{theme:t,themeColor:s}=f(w),[r,n]=p.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);p.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),l=i=>n(i.matches);return a.addEventListener("change",l),()=>a.removeEventListener("change",l)},[]),p.useEffect(()=>{const a=l=>{const i=l?"dark":"light";document.body.setAttribute("arco-theme",i),document.body.style.colorScheme=i};is(s),a(t==="system"?r:t==="dark")},[r,t,s])},ht=()=>{const t=document.querySelector(".spinner");t&&(t.style.display="none")},fa=()=>{zt(),fs();const{isBelowLarge:t}=me(),{polyglot:s}=f(F);return p.useEffect(()=>{ht()},[]),s&&e.jsxs("div",{className:"app",children:[t?null:e.jsx(sr.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(ns,{})}),e.jsx(zn,{}),e.jsx(ha,{})]})},ps=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},ms=t=>{var a;const n=(a=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:a.getAttribute("src");return{...t,imgSrc:n}},pa=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(ms);xe(s),Tn(t.total),ts(s.length<t.total)}},ma=(t,s)=>{const{isAppDataReady:r}=f(P),{showStatus:n}=f(w),a=p.useRef(!1),l=async i=>{if(!a.current){a.current=!0,bt(!1);try{const o=n==="unread"?await i(0,"unread"):await i();switch(t.from){case"feed":n==="unread"&&ot(u=>({...u,[Number(t.id)]:o.total}));break;case"history":Te(o.total);break;case"starred":n!=="unread"&&Fe(o.total);break;case"today":n==="unread"&&it(o.total);break}bt(!0),pa(o)}catch(o){console.error("Error fetching articles: ",o)}finally{a.current=!1}}};return p.useEffect(()=>{r&&l(s)},[r]),{fetchArticleList:l}},gs=Qe(!1),It=T(gs),ga=(t,s)=>!s.some(r=>r.id===t.id),ft=()=>{const{offset:t}=f(A),{pageSize:s,showStatus:r}=f(w),n=f(gs),a=i=>{const o=(u,d)=>d.filter(c=>ga(c,u));xe(u=>[...u,...o(u,i)]),Ne(u=>u+s)};return{handleLoadMore:async i=>{var o;It(!0);try{const u=r==="unread"?await i(t+s,"unread"):await i(t+s);if(((o=u==null?void 0:u.entries)==null?void 0:o.length)>0){const d=u.entries.map(ms);a(d)}else ts(!1)}catch(u){console.error("Error fetching more articles: ",u)}finally{It(!1)}},loadingMore:n}},pt=ne({isPhotoSliderVisible:!1,selectedIndex:0}),xa=T(pt,"isPhotoSliderVisible"),ya=T(pt,"selectedIndex"),xs=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=f(pt);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:xa,selectedIndex:s,setSelectedIndex:ya}},ys=()=>{const{activeContent:t,loadMoreVisible:s}=f(A),r=f(es),n=f(ze),{isPhotoSliderVisible:a,setIsPhotoSliderVisible:l,setSelectedIndex:i}=xs(),{loadingMore:o}=ft(),[u,d]=p.useState(!1),[c,h]=p.useState(!1),{entryListRef:g,handleEntryClick:_}=os();p.useEffect(()=>{c&&!o&&(d(!1),h(!1),x())},[o,c]);const m=()=>{if(g.current){const S=g.current.el.querySelector(".card-custom-selected-style");S&&S.scrollIntoView({behavior:"smooth",block:"nearest"})}},y=S=>(...M)=>{if(t)return S(...M)},C=y(()=>{W(null),g.current&&g.current.contentWrapperEl.focus()}),v=(S,M,G,le)=>{const $e=M==="prev"?le.slice(0,S).toReversed():le.slice(S+1);return G?$e.find(Be=>Be.status==="unread"):le[S+(M==="prev"?-1:1)]},R=(S=!1)=>{if(r>0){const M=v(r,"prev",S,n);M&&(_(M),setTimeout(()=>m(),200))}},x=(S=!1)=>{if(u)return;if(r===n.length-1&&s){d(!0),h(!0);return}if(r===-1){g.current.contentWrapperEl.scrollTo({top:0});return}const G=v(r,"next",S,n);G&&(_(G),setTimeout(()=>m(),200),h(!1))},k=y(()=>{window.open(t.url,"_blank")}),V=y(S=>{S()}),K=y(S=>{S()}),X=y(S=>{S()}),te=y(S=>{S()}),ie=y(()=>{!ps(t.content).length||a||(i(0),l(!0))});return{exitDetailView:C,fetchOriginalArticle:V,navigateToNextArticle:x,navigateToPreviousArticle:R,openLinkExternally:k,openPhotoSlider:ie,saveToThirdPartyServices:K,toggleReadStatus:X,toggleStarStatus:te}},_a=()=>{const{activeContent:t}=f(A),s=f(es),r=f(ze),n=s===0,a=s===r.length-1,[l,i]=p.useState(!1),{handleFetchContent:o,handleSaveToThirdPartyServices:u,handleToggleStarred:d,handleToggleStatus:c}=Ve(),{exitDetailView:h,navigateToNextArticle:g,navigateToPreviousArticle:_}=ys(),m=t.status==="unread",y=t.starred;return p.useEffect(()=>{i(!1)},[t]),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(E,{icon:e.jsx(rr,{}),onClick:()=>h(),shape:"circle"}),e.jsx(E,{icon:e.jsx(nr,{}),onClick:()=>_(),shape:"circle",disabled:n}),e.jsx(E,{icon:e.jsx(ar,{}),onClick:()=>g(),shape:"circle",disabled:a})]}),e.jsxs("div",{className:"right-side",children:[e.jsx(E,{icon:m?e.jsx(Mt,{}):e.jsx(Dt,{}),onClick:()=>c(t),shape:"circle"}),e.jsx(E,{icon:y?e.jsx(Ze,{style:{color:"#ffcd00"}}):e.jsx(Je,{}),onClick:()=>d(t),shape:"circle"}),e.jsx(E,{icon:e.jsx(or,{}),onClick:async()=>{await o(),i(!0)},shape:"circle",disabled:l}),e.jsx(E,{icon:e.jsx(ir,{}),onClick:u,shape:"circle"})]})]})},ja=({url:t,text:s})=>{const[r,n]=p.useState(!1),a=()=>n(!r);return e.jsx(dr,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:a,onMouseLeave:a,children:s})},ve=({imgNode:t,isIcon:s})=>{const{fontSize:r}=f(w);return e.jsx("img",{...t.attribs,alt:t.attribs.alt??"image",style:s?{display:"inline-block",width:"auto",height:`${r}rem`,margin:0}:{}})},Et=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var g;const[a,l]=p.useState(!1),[i,o]=p.useState(!1),{isBelowMedium:u}=me();p.useEffect(()=>{const m=(n?t.children[0]:t).attribs.src,y=new Image;y.src=m,y.onload=()=>o(y.width<=100&&y.height<=100)},[t,n]);const d=n?t.children[0]:t;if(i)return n?e.jsxs("a",{...t.attribs,children:[e.jsx(ve,{imgNode:d,isIcon:i}),(g=t.children[1])==null?void 0:g.data]}):e.jsx(ve,{imgNode:d,isIcon:i});const c=()=>l(!0),h=()=>l(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:c,onMouseLeave:h,children:[n?e.jsx("a",{...t.attribs,children:e.jsx(ve,{imgNode:d,isIcon:i})}):e.jsx(ve,{imgNode:d,isIcon:i}),e.jsx(E,{icon:e.jsx(ur,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:u||a?1:0,transition:"opacity 0.3s"},onClick:_=>{_.preventDefault(),r(s)}})]})})},ba=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const n=r.children[0];if(n.type==="tag"&&n.name==="img"){const a=t.findIndex(l=>l===n.attribs.src);return e.jsx(Et,{node:r,index:a,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const n=t.findIndex(a=>a===r.attribs.src);return e.jsx(Et,{node:r,index:n,togglePhotoSlider:s})}return r}}),va=p.forwardRef((t,s)=>{const r=ee(),{activeContent:n}=f(A),{articleWidth:a,fontFamily:l,fontSize:i}=f(w),{isPhotoSliderVisible:o,setIsPhotoSliderVisible:u,selectedIndex:d,setSelectedIndex:c}=xs(),h=()=>{Le("author"),Ae(n.author)},g=R=>{c(R),u(x=>!x)},_=ps(n.content),m=ba(_,g),y=lr(n.content,m),{id:C,title:v}=n.feed.category;return e.jsx("article",{className:"article-content",ref:s,tabIndex:-1,children:e.jsxs(Ye,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${a}%`},children:[e.jsx(I.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",children:n.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(I.Text,{children:e.jsx(ja,{url:`/feed/${n.feed.id}`,text:n.feed.title})}),e.jsx(I.Text,{onClick:h,style:{cursor:"pointer"},children:` - ${n.author}`}),e.jsx(I.Text,{children:e.jsx(Q,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>r(`/category/${C}`),children:v})})]}),e.jsx(I.Text,{className:"article-date",children:en(n.published_at)}),e.jsx("br",{}),e.jsx(I.Text,{className:"article-date",children:Ht(n.reading_time)}),e.jsx($,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${i}rem`,width:`${a}%`,fontFamily:l},children:[y,e.jsx(cr,{images:_.map(R=>({src:R,key:R})),loop:!1,visible:o,onClose:()=>{u(!1)},index:d,onIndexChange:c})]},n.id)]})})}),Sa=({alt:t,borderRadius:s,height:r,src:n,status:a,width:l})=>{const[i,o]=p.useState(!1),{ref:u}=Me({triggerOnce:!0,onChange:(d,c)=>{if(d&&!i){const h=new Image;h.onload=()=>o(!0),h.onerror=()=>{c.target.style.display="none"},h.src=n}}});return e.jsx("div",{className:"image-container",ref:u,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:i?e.jsx("img",{className:a==="unread"?"":"read",src:n,alt:t,style:{width:l,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(ke,{text:{rows:0},image:{style:{width:l,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},wa=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(Sa,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},Ca=(t,s)=>t?s?"0 10px 0 0":"0 0 10px 0":"0",ka=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:a}=f(w),l=Re({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:l,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:Ca(t.imgSrc,r)},children:e.jsx(wa,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(I.Text,{className:"article-card-title",children:t.title}),e.jsxs(I.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(ss,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Bt(t.published_at,a),e.jsx("br",{}),Ht(t.reading_time)]}),t.starred&&e.jsx(Ze,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},Ia=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:a,showFeedIcon:l}=f(w),{activeContent:i}=f(A),{polyglot:o}=f(F),u=i&&t.id===i.id,{handleToggleStarred:d,handleToggleStatus:c}=Ve(),[h,g]=p.useState(0),_=60,m=.5,y=t.starred,C=t.status==="unread",v=hr({preventScrollOnSwipe:!0,delta:_/2,onSwiping:S=>{const M=Math.min(Math.abs(S.deltaX*m),_)*Math.sign(S.deltaX);g(M)},onSwiped:async S=>{try{S.deltaX>_?(await d(t),j.success(y?o.t("article_card.unmarked_as_starred"):o.t("article_card.marked_as_starred"))):S.deltaX<-_&&(await c(t),j.success(C?o.t("article_card.marked_as_read"):o.t("article_card.marked_as_unread")))}catch(M){console.error("Failed to update entry: ",M),j.error(o.t("article_card.update_failed"))}g(0)}}),[R,x]=p.useState(!1),[k,V]=p.useState(!1),K=()=>c(t),X=20,{ref:te}=Me({skip:k,onChange:async(S,M)=>{if(!(!a||!C)){if(S)x(!0);else if(R){const{top:G}=M.boundingClientRect;G<X&&(await K(),V(!0))}}}}),ie=fr({x:h});return p.createElement("div",{...v,className:"article-card",key:t.id},e.jsxs("div",{ref:te,children:[e.jsx(pr.div,{className:"swipe-card",style:ie,children:e.jsx(Ie,{className:Re("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":u}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Ie.Meta,{description:e.jsx(ka,{entry:t,showFeedIcon:l,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:y?e.jsx(Ze,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(Je,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:C?e.jsx(Mt,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(Dt,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},Ea=({layout:t,isArticleListReady:s})=>e.jsx(Ie,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Ie.Meta,{description:e.jsx(ke,{loading:!s,animation:!0,text:{rows:3,width:150}})})}),Ta=()=>{const{layout:t}=f(w),{isArticleListReady:s}=f(A),r=t==="large"?2:4;return!s&&Array.from({length:r},(n,a)=>e.jsx(Ea,{layout:t,isArticleListReady:s},a))},Fa=()=>{const{filterString:t,filterType:s}=f(A),{orderDirection:r}=f(w),{polyglot:n}=f(F),a=n.t("search.tooltip").split(`
`),[l,i]=p.useState(""),o=p.useCallback(qn(h=>Ae(h),500),[]),u=h=>{i(h),o(h)},{isBelowMedium:d}=me(),c=()=>{z({orderDirection:r==="desc"?"asc":"desc"})};return p.useEffect(()=>{Le("title"),Ae("")},[]),p.useEffect(()=>{t!==l&&i(t)},[t]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(B.Search,{allowClear:!0,onChange:u,placeholder:n.t("search.placeholder"),style:{width:d?"100%":272,marginLeft:8},value:l,addBefore:e.jsxs(L,{onChange:Le,style:{width:100},value:s,children:[e.jsx(L.Option,{value:"title",children:n.t("search.type_title")}),e.jsx(L.Option,{value:"content",children:n.t("search.type_content")}),e.jsx(L.Option,{value:"author",children:n.t("search.type_author")})]})}),e.jsxs("div",{className:"button-group",children:[e.jsx(re,{mini:!0,content:e.jsx("div",{children:a.map((h,g)=>e.jsxs(p.Fragment,{children:[h,g<a.length-1&&e.jsx("br",{})]},`line-${g}-${h.length}`))}),children:e.jsx(E,{shape:"circle",size:"small",icon:e.jsx(Pt,{})})}),e.jsx(re,{mini:!0,content:r==="desc"?n.t("article_list.sort_direction_desc"):n.t("article_list.sort_direction_asc"),children:e.jsx(E,{shape:"circle",size:"small",icon:r==="desc"?e.jsx(mr,{}):e.jsx(gr,{}),onClick:c})})]})]})},Aa=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},La=(t,s,r)=>{p.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},Na=({duration:t,color:s})=>{const[r,n]=p.useState([]);La(r.length,t,()=>{n([])});const a=l=>{const i=l.currentTarget.getBoundingClientRect(),o=i.width>i.height?i.width:i.height,u=l.pageX-i.x-o/2,d=l.pageY-i.y-o/2,c={x:u,y:d,size:o,id:`${new Date().getTime()}-${u}-${d}`};n([...r,c])};return e.jsx("div",{className:"ripple-container",onMouseDown:a,children:r.length>0&&r.map(l=>e.jsx("span",{className:"ripple-span",style:{top:l.y,left:l.x,width:l.size,height:l.size,backgroundColor:s,animationDuration:`${t}ms`}},l.id))})},Pa=({getEntries:t})=>{const{isArticleListReady:s,loadMoreVisible:r}=f(A),{loadingMore:n,handleLoadMore:a}=ft(),{ref:l,inView:i}=Me(),o=p.useCallback(async()=>{r&&i&&s&&!n&&await a(t)},[r,i,s,n,a,t]);return p.useEffect(()=>{const u=setInterval(o,500);return()=>clearInterval(u)},[o]),s&&r&&e.jsxs("div",{className:"load-more-container",ref:l,children:[e.jsx(yr,{loading:n,style:{paddingRight:"10px"}}),"Loading more ..."]})},Ra=p.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:a,pageSize:l}=f(w),i=a==="small",{isArticleListReady:o,loadMoreVisible:u}=f(A),d=f(ze),c=d.length-Math.ceil(l*.2)-1,{loadingMore:h,handleLoadMore:g}=ft(),{ref:_}=Me({skip:!u,onChange:async v=>{!v||!o||h||await g(t)}}),m=xr({count:d.length,getScrollElement:()=>r.current,estimateSize:p.useCallback(()=>i?120:280,[i]),overscan:5}),y=m.getVirtualItems(),C=p.useCallback(v=>v===c?Aa(m.measureElement,_):m.measureElement,[c,m.measureElement,_]);return e.jsxs(e.Fragment,{children:[e.jsx(Fa,{}),e.jsxs(Ye,{className:"entry-list",ref:n,children:[e.jsx(Ta,{}),o&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:m.getTotalSize(),width:"100%",position:"relative"},children:y.map(v=>e.jsx("div",{"data-index":v.index,ref:C(v.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${v.start}px)`},children:e.jsx(Ia,{entry:d[v.index],handleEntryClick:s,mini:i,children:e.jsx(Na,{color:"var(--color-text-4)",duration:1e3})})},v.key))})}),e.jsx(Pa,{getEntries:t})]})]})}),Ma=()=>{xe(t=>t.map(s=>({...s,status:"read"})))},Da=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:n}=f(A),{showStatus:a}=f(w),{polyglot:l}=f(F),{fetchAppData:i}=lt(),o=async()=>{try{await r(),Ma(),await i(),j.success(l.t("article_list.mark_all_as_read_success"))}catch(d){console.error("Failed to mark all as read: ",d),j.error(l.t("article_list.mark_all_as_read_error"))}},u=d=>{z({showStatus:d})};return p.useEffect(()=>{Le("title"),Ae("")},[a]),e.jsxs("div",{className:"entry-panel",children:[e.jsx(Nt,{focusLock:!0,onOk:o,title:l.t("article_list.mark_all_as_read_confirm"),children:e.jsx(E,{icon:e.jsx(At,{}),shape:"circle",style:{visibility:["starred","history"].includes(t.from)?"hidden":"visible"}})}),e.jsx(_r.Group,{onChange:u,options:[{label:l.t("article_list.filter_status_all"),value:"all"},{label:l.t("article_list.filter_status_unread"),value:"unread"}],style:{visibility:t.from==="history"?"hidden":"visible"},type:"button",value:a}),e.jsx(E,{icon:e.jsx(pe,{}),loading:!n,shape:"circle",onClick:s})]})},oe=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleListReady:a,isArticleLoading:l}=f(A),{isAppDataReady:i}=f(P),{orderBy:o,orderDirection:u,showAllFeeds:d,showStatus:c}=f(w),{polyglot:h}=f(F),g=f(ut),_=f(at),m=f(Ue),{entryDetailRef:y,entryListRef:C,handleEntryClick:v}=os(),{handleFetchContent:R,handleSaveToThirdPartyServices:x,handleToggleStarred:k,handleToggleStatus:V}=Ve(),{fetchAppData:K}=lt(),{fetchArticleList:X}=ma(t,s),te=p.useRef(null),{exitDetailView:ie,fetchOriginalArticle:S,navigateToNextArticle:M,navigateToPreviousArticle:G,openLinkExternally:le,openPhotoSlider:$e,saveToThirdPartyServices:Be,toggleReadStatus:js,toggleStarStatus:bs}=ys(),vs={exitDetailView:ie,fetchOriginalArticle:()=>S(R),navigateToNextArticle:()=>M(),navigateToNextUnreadArticle:()=>M(!0),navigateToPreviousArticle:()=>G(),navigateToPreviousUnreadArticle:()=>G(!0),openLinkExternally:le,openPhotoSlider:$e,saveToThirdPartyServices:()=>Be(x),toggleReadStatus:()=>js(()=>V(n)),toggleStarStatus:()=>bs(()=>k(n))},Ss=de=>de.filter(He=>!g.includes(He));for(const[de,He]of Object.entries(vs))jr(Ss(m[de]),He);const ce=async de=>{Ne(0),i?await X(de):await K()};return p.useEffect(()=>{g.length>0&&j.error(h.t("settings.duplicate_hotkeys"))},[g]),p.useEffect(()=>{En(t.from),n&&W(null),ce(s)},[t]),p.useEffect(()=>{["starred","history"].includes(t.from)||ce(s)},[o]),p.useEffect(()=>{_.length===0||["starred","history"].includes(t.from)||ce(s)},[d]),p.useEffect(()=>{ce(s)},[u,c]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(Ke,{in:a,timeout:200,nodeRef:te,classNames:"fade",children:e.jsx(Ra,{cardsRef:te,getEntries:s,handleEntryClick:v,ref:C})}),e.jsx(Da,{info:t,refreshArticleList:()=>ce(s),markAllAsRead:r})]}),n?e.jsxs("div",{className:"article-container",children:[e.jsx(Ke,{in:!l,timeout:200,nodeRef:y,classNames:"fade",unmountOnExit:!0,children:e.jsx(va,{ref:y})}),e.jsx(Ke,{in:!l,timeout:200,unmountOnExit:!0,children:e.jsx(_a,{})})]}):e.jsxs("div",{className:"content-empty",children:[e.jsx(br,{style:{fontSize:"64px"}}),e.jsx(I.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]})]})},Oa=()=>e.jsx(oe,{info:{from:"all",id:""},getEntries:nn,markAllAsRead:xn}),Va=()=>{const{id:t}=Ot(),s=O("orderBy"),r=O("pageSize"),n=O("showAllFeeds"),a=async(l=0,i=null)=>{const o={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:l,limit:r,status:i},u={globally_visible:!n};return b.get(ae(o,u))};return e.jsx(oe,{info:{from:"category",id:t},getEntries:a,markAllAsRead:()=>Jr(t)})},za=()=>{const t=ee(),s=vr();return console.error(s),p.useEffect(()=>{ht()},[]),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(Sr,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(E,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},Ua=()=>{const{id:t}=Ot(),s=O("orderBy"),r=O("pageSize"),n=async(a=0,l=null)=>{const i={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:a,limit:r,status:l};return b.get(ae(i))};return e.jsx(oe,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>fn(t)})},$a=()=>e.jsx(oe,{info:{from:"history",id:""},getEntries:an}),Ba=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,a]of Object.entries(s))if(n!=="password"){const l=a==null?void 0:a.trim();t.setFieldValue(n,l),l||(r=!1)}else a||(r=!1);return r},Se=(t,s)=>{t.key==="Enter"&&s.submit()},Ha=()=>{zt(),fs();const t=f(De),{homePage:s}=f(w),{polyglot:r}=f(F),[n]=wr(),[a,l]=p.useState(!1),[i,o]=p.useState("token"),u=ee(),d=async()=>{l(!0);const{server:h,token:g,username:_,password:m}=n.getFieldsValue();try{(await Tt.raw("v1/me",{baseURL:h,headers:g?{"X-Auth-Token":g}:{Authorization:`Basic ${btoa(`${_}:${m}`)}`}})).status===200&&(j.success(r.t("login.success")),$t({server:h,token:g,username:_,password:m}),u("/"))}catch(y){console.error(y),j.error(y.message)}l(!1)},c=async()=>{const h=n.getFieldsValue();if(!Ee(h)){j.error(r.t("login.auth_error"));return}await d()};return p.useEffect(()=>{ht()},[]),Ee(t)?e.jsx(et,{to:`/${s}`}):r&&e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(I.Title,{heading:3,children:r.t("login.login_to_your_server")}),e.jsxs(N,{autoComplete:"off",form:n,layout:"vertical",onSubmit:async()=>{Ba(n)?await c():j.error(r.t("login.submit_error"))},children:[e.jsx(N.Item,{field:"server",label:r.t("login.server_label"),rules:[{required:!0}],onKeyDown:h=>{Se(h,n)},children:e.jsx(B,{disabled:a,placeholder:r.t("login.server_placeholder"),prefix:e.jsx(Cr,{})})}),i==="token"&&e.jsx(N.Item,{field:"token",label:r.t("login.token_label"),rules:[{required:!0}],onKeyDown:h=>{Se(h,n)},children:e.jsx(B.Password,{disabled:a,placeholder:r.t("login.token_placeholder"),prefix:e.jsx(yt,{})})}),i==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(N.Item,{field:"username",label:r.t("login.username_label"),rules:[{required:!0}],onKeyDown:h=>{Se(h,n)},children:e.jsx(B,{disabled:a,placeholder:r.t("login.username_placeholder"),prefix:e.jsx(Lt,{})})}),e.jsx(N.Item,{field:"password",label:r.t("login.password_label"),rules:[{required:!0}],onKeyDown:h=>{Se(h,n)},children:e.jsx(B.Password,{disabled:a,placeholder:r.t("login.password_placeholder"),prefix:e.jsx(yt,{})})})]})]}),e.jsx(E,{loading:a,type:"primary",long:!0,onClick:()=>n.submit(),style:{marginTop:"20px"},children:r.t("login.login_button")}),e.jsx($,{orientation:"center",children:r.t("login.another_login_method")}),e.jsx(E,{type:"secondary",long:!0,onClick:()=>o(i==="token"?"user":"token"),style:{marginTop:"20px"},children:i==="token"?r.t("login.another_login_button"):r.t("login.token_label")}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(I.Text,{disabled:!0,children:r.t("login.need_help")}),e.jsx(kr,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:r.t("login.miniflux_official_website")})]})]})}),e.jsx("div",{className:"background"})]})},Ka=({children:t})=>{const s=f(De);return Ee(s)?e.jsx(e.Fragment,{children:t}):e.jsx(et,{to:"/login"})},qa=()=>e.jsx(oe,{info:{from:"starred",id:""},getEntries:Kt}),Wa=()=>{const t=async()=>{const s=await we(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=we(0,"unread",r).then(l=>l.entries));const a=n.map(l=>l.id);return Oe(a,"read")};return e.jsx(oe,{info:{from:"today",id:""},getEntries:we,markAllAsRead:t})},Ga=O("homePage"),Ya=[{path:"/all",element:e.jsx(Oa,{})},{path:"/today",element:e.jsx(Wa,{})},{path:"/starred",element:e.jsx(qa,{})},{path:"/history",element:e.jsx($a,{})},{path:"/category/:id",element:e.jsx(Va,{})},{path:"/feed/:id",element:e.jsx(Ua,{})}],_s=Ir([{path:"/",element:e.jsx(Ka,{children:e.jsx(fa,{})}),errorElement:e.jsx(za,{}),children:[...Ya,{index:!0,element:e.jsx(et,{to:`/${Ga}`,replace:!0})}]},{path:"/login",element:e.jsx(Ha,{})}]),Ja={"zh-CN":Lr,"es-ES":Nr},Xa=()=>Ja[Dr()]||Ar;Er.createRoot(document.getElementById("root")).render(e.jsx(Tr,{locale:Xa(),children:e.jsx(Fr,{router:_s})}));

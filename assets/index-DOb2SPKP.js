import{p as We,m as le,u as f,r as g,d as M,P as bs,i as vs,o as Ft,a as Ss,b as ws,c as Cs,e as q,M as j,C as ks,j as e,f as J,g as Pe,A as Is,I as Ts,T as k,S as ke,h as Ge,k as Et,l as Fs,n as Es,q as Ye,s as As,t as Ns,v as ae,w as Re,B as I,x as Ls,D as Ps,y as he,z as ie,E as Je,F as Rs,G as Ms,H as Ds,J as gt,K as At,L as Os,N as fe,O as Vs,Q as Nt,R as Z,U as zs,V as Us,W as $s,X as Bs,Y as Hs,Z as $,_ as W,$ as N,a0 as xt,a1 as L,a2 as se,a3 as B,a4 as Xe,a5 as yt,a6 as Lt,a7 as qs,a8 as Pt,a9 as Rt,aa as Ks,ab as oe,ac as Ws,ad as Gs,ae as Ys,af as Js,ag as Xs,ah as Qs,ai as Zs,aj as er,ak as tr,al as sr,am as Mt,an as Dt,ao as Qe,ap as rr,aq as ar,ar as nr,as as or,at as ir,au as lr,av as Me,aw as cr,ax as dr,ay as ur,az as Ie,aA as hr,aB as fr,aC as pr,aD as mr,aE as gr,aF as K,aG as Be,aH as xr,aI as Ot,aJ as yr,aK as _r,aL as jr,aM as Ze,aN as br,aO as _t,aP as vr,aQ as Sr,aR as wr,aS as Cr,aT as kr,aU as Ir,aV as Tr,aW as Fr}from"./vendor-BduRoXZB.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const Er="modulepreload",Ar=function(t){return"/"+t},jt={},xe=function(s,r,a){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),i=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.allSettled(r.map(u=>{if(u=Ar(u),u in jt)return;jt[u]=!0;const d=u.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Er,d||(h.as="script"),h.crossOrigin="",h.href=u,i&&h.setAttribute("nonce",i),document.head.appendChild(h),d)return new Promise((p,_)=>{h.addEventListener("load",p),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return n.then(l=>{for(const i of l||[])i.status==="rejected"&&o(i.reason);return s().catch(o)})},Nr=(t,s,r)=>{const a=t[s];return a?typeof a=="function"?a():Promise.resolve(a):new Promise((n,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},Lr=()=>{const{language:t}=w.get(),s=et();return t||s},et=()=>{const t=navigator.language;return t==="zh-Hans-CN"?"zh-CN":t},Vt={articleWidth:90,fontFamily:"system-ui",fontSize:1.05,homePage:"all",language:et(),layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showUnreadFeedsOnly:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},w=We("settings",Vt,{encode:JSON.stringify,decode:JSON.parse}),D=t=>w.get()[t],z=t=>w.set({...w.get(),...t}),Pr=()=>w.set(Vt),F=(t,s=null)=>r=>{const a=t.get();if(typeof a=="object"&&a!==null){if(s===null)return;typeof r=="function"?t.set({...a,[s]:r(a[s])}):t.set({...a,[s]:r})}else typeof r=="function"?t.set(r(a)):t.set(r)},E=le({polyglot:null}),Rr=F(E,"polyglot"),Mr=async(t,s)=>{let r,a=t;try{r=await Nr(Object.assign({"../locales/en-US.json":()=>xe(()=>import("./en-US-CD3hYYdV.js"),[]),"../locales/es-ES.json":()=>xe(()=>import("./es-ES-DfoSseyR.js"),[]),"../locales/zh-CN.json":()=>xe(()=>import("./zh-CN-BcGsx3tM.js"),[])}),`../locales/${t}.json`,3)}catch(n){console.error("Failed to load language: ",n),r=await xe(()=>import("./en-US-CD3hYYdV.js"),[]),a="en-US"}{const n=new bs({phrases:r.default,locale:a});Rr(n)}},zt=()=>{const{language:t}=f(w);g.useEffect(()=>{t?(Mr(t),t==="zh-CN"?M.locale("zh-cn"):t==="es"||t.startsWith("es-")?M.locale("es"):M.locale("en")):z({language:et()})},[t])},tt=le({addFeedModalVisible:!1,settingsModalVisible:!1}),Dr=F(tt,"addFeedModalVisible"),Or=F(tt,"settingsModalVisible"),st=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=f(tt);return{addFeedModalVisible:t,setAddFeedModalVisible:Dr,settingsModalVisible:s,setSettingsModalVisible:Or}},pe=()=>{const[t,s]=g.useState(window.innerWidth),r=t<=768,a=t<=992;return g.useEffect(()=>{const n=()=>s(window.innerWidth);return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),{width:t,isBelowMedium:r,isBelowLarge:a}},Ut={server:"",token:"",username:"",password:""},De=We("auth",Ut,{encode:JSON.stringify,decode:JSON.parse}),$t=t=>De.set(t),Vr=()=>$t(Ut),zr=t=>{try{const s=new URL(t),{hostname:r,port:a}=s;return!!r&&!!a}catch{return!1}},Te=t=>{const{server:s,token:r,username:a,password:n}=t;return!s||!vs(s,{require_protocol:!0})&&!zr(s)?!1:r||a&&n},Ur=()=>Ft.create({retry:3,onRequest({_request:t,options:s}){const r=De.get();if(!Te(r))throw new Error("Invalid auth");const{server:a,token:n,username:o,password:l}=r;s.baseURL=a,s.headers=n?{"X-Auth-Token":n}:{Authorization:`Basic ${btoa(`${o}:${l}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var o;s.status===401&&(localStorage.removeItem("auth"),await xs.navigate("/login"));const n=((o=s._data)==null?void 0:o.error_message)??s.statusText;throw console.error("Response error: ",n),new Error(n)}}),b=Ur();b.get=t=>b(t,{method:"GET"});b.post=(t,s)=>b(t,{method:"POST",body:s});b.put=(t,s)=>b(t,{method:"PUT",body:s});const $r=async()=>b.get("/v1/categories"),Br=async t=>b.post("/v1/categories",{title:t}),Hr=async t=>b.raw(`/v1/categories/${t}`,{method:"DELETE"}),qr=async(t,s,r=!1)=>{const a={title:s,hide_globally:r?"on":void 0};return b.put(`/v1/categories/${t}`,a)},Kr=async t=>b.put(`/v1/categories/${t}/mark-all-as-read`);M.extend(Ss);M.extend(ws);M.extend(Cs);const Wr=t=>M(t).isAfter(M().subtract(24,"hour")),Gr=()=>M().subtract(24,"hour").unix(),Yr=()=>M().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),Jr=t=>M(t).format("dddd, MMMM D, YYYY h:mm A"),Bt=(t,s)=>{const{polyglot:r}=E.get();if(!s){const m=M(),y=M(t),T=y.from(m),v=M.duration(m.diff(y)).asSeconds();return v>=0&&v<60?r.t("date.just_now"):T}const a=M(),o=M(t).diff(a),l=M.duration(Math.abs(o)),i=l.years(),u=l.months(),d=l.days(),c=l.hours(),h=l.minutes(),p=[];if(i>0&&p.push(r.t("date.years",i)),u>0&&p.push(r.t("date.months",u)),d>0&&p.push(r.t("date.days",d)),c>0&&p.push(r.t("date.hours",c)),h>0&&p.push(r.t("date.minutes",h)),p.length===0)return r.t("date.just_now");const _=p.join(" ");return o>0?r.t("date.in_time",{time:_}):r.t("date.time_ago",{time:_})},Ht=t=>{const{polyglot:s}=E.get(),r=s.t("date.minutes",t);return s.t("article_card.reading_time",{time:r})},Oe=async(t,s)=>b.put("/v1/entries",{entry_ids:t,status:s}),Xr=async t=>b.put(`/v1/entries/${t}/bookmark`),Qr=async t=>b.get(`/v1/entries/${t}/fetch-content`),Zr=async t=>b.raw(`/v1/entries/${t}/save`,{method:"POST"}),ce=(t,s={})=>{const{baseUrl:r,orderField:a,offset:n,limit:o,status:l}=t,i=D("orderDirection"),u=new URLSearchParams({order:a,direction:i,offset:n,limit:o,...s});return l&&u.append("status",l),`${r}?${u}`},ea=async(t=0,s=null)=>{const r=D("orderBy"),a=D("pageSize"),n=D("showAllFeeds"),o={baseUrl:"/v1/entries",orderField:r,offset:t,limit:a,status:s},l={globally_visible:!n};return b.get(ce(o,l))},Se=async(t=0,s=null,r=null)=>{const a=D("orderBy"),n=r??D("pageSize"),o=D("showAllFeeds"),l=Gr(),i={baseUrl:"/v1/entries",orderField:a,offset:t,limit:n,status:s},u={globally_visible:!o,published_after:l};return b.get(ce(i,u))},qt=async(t=0,s=null)=>{const r=D("pageSize"),a={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},n={starred:"true"};return b.get(ce(a,n))},ta=async(t=0)=>{const s=D("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return b.get(ce(r))},sa=async()=>b.get("/v1/feeds"),ra=async()=>b.get("/v1/feeds/counters"),aa=async t=>b.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),na=async()=>b.raw("/v1/feeds/refresh",{method:"PUT"}),oa=async(t,s,r)=>b.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),ia=async t=>b.raw(`/v1/feeds/${t}`,{method:"DELETE"}),Kt=async(t,s)=>{const{categoryId:r,title:a,siteUrl:n,feedUrl:o,hidden:l,disabled:i,isFullText:u}=s;return b.put(`/v1/feeds/${t}`,{category_id:r,title:a,site_url:n,feed_url:o,hide_globally:l,disabled:i,crawler:u})},la=async t=>b.put(`/v1/feeds/${t}/mark-all-as-read`),ca=async()=>b.get("/v1/me"),da=async t=>b.get(`/v1/icons/${t}`),ua=async()=>b.get("/v1/version"),ha=async()=>{const t=await ca();return b.put(`/v1/users/${t.data.id}/mark-all-as-read`)},Wt={isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1},P=le(Wt),rt=q(P,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(n=>({...n,unreadCount:s[n.id]??0})).sort((n,o)=>n.title.localeCompare(o.title,"en"))}),me=q([P,rt],(t,s)=>{const{categoriesData:r}=t;return r.map(n=>{const o=s.filter(l=>l.category.id===n.id);return{...n,unreadCount:o.reduce((l,i)=>l+(i.unreadCount??0),0),feedCount:o.length}}).sort((n,o)=>n.title.localeCompare(o.title,"en"))}),Gt=q(me,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),at=q([rt,Gt],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Yt=q([rt,at,w],(t,s,r)=>{const{showAllFeeds:a}=r;return t.filter(n=>a||!s.includes(n.id))}),fa=q([me,Gt,w],(t,s,r)=>{const{showAllFeeds:a}=r;return t.filter(n=>a||!s.includes(n.id))}),Jt=q(Yt,t=>t.reduce((s,r)=>{const{id:a}=r.category;return s[a]||(s[a]=[]),s[a].push(r),s},{})),pa=q([P,Yt],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((a,[n,o])=>s.some(l=>l.id===Number(n))?a+o:a,0)}),we=F(P,"categoriesData"),re=F(P,"feedsData"),Fe=F(P,"historyCount"),bt=F(P,"isAppDataReady"),Ee=F(P,"starredCount"),nt=F(P,"unreadInfo"),ot=F(P,"unreadTodayCount"),ma=F(P,"isVersionAtLeast2_2_0"),ga=()=>P.set(Wt),Xt=(t,s)=>{const r=s.map(a=>a.id);return t.map(a=>r.includes(a.id)&&s.find(o=>o.id===a.id)||a)},He=(t,s)=>{const r={};let a=0;const n=t.filter(d=>d.status!==s);if(n.length===0)return;const{showStatus:o}=w.get();s==="read"?(Fe(d=>d+n.length),o==="unread"&&Le(d=>d-n.length)):(Fe(d=>Math.max(0,d-n.length)),o==="unread"&&Le(d=>d+n.length));for(const d of n){const c=d.feed.id,h=Wr(d.published_at),p=s==="read"?-1:1;r[c]=(r[c]??0)+p,a+=h?p:0}ot(d=>Math.max(0,d+a)),nt(d=>{const c={...d};for(const[h,p]of Object.entries(r))c[h]=Math.max(0,(c[h]??0)+p);return c});const l=n.map(d=>({...d,status:s})),{activeContent:i}=A.get(),u=l.find(d=>d.id===(i==null?void 0:i.id));u&&G(u),ge(d=>Xt(d,l))},it=()=>{const{activeContent:t}=f(A),{polyglot:s}=f(E),r=(u,d)=>{He([u],d)},a=(u,d)=>{d?(Ee(h=>h+1),ks({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Ee(h=>Math.max(0,h-1));const c={...u,starred:d};t&&G(c),ge(h=>Xt(h,[c]))};return{handleEntryStatusUpdate:r,handleFetchContent:async()=>{try{const u=await Qr(t.id);j.success(s.t("actions.fetched_content_success")),G({...t,content:u.content})}catch(u){console.error("Failed to fetch content: ",u),j.error(s.t("actions.fetched_content_error"))}},handleSaveToThirdPartyServices:async()=>{try{(await Zr(t.id)).status===202?j.success(s.t("actions.saved_to_third-party_services_success")):j.error(s.t("actions.saved_to_third-party_services_error"))}catch(u){console.error("Failed to save to third-party services: ",u),j.error(s.t("actions.saved_to_third-party_services_error"))}},handleToggleStarred:async u=>{const d=!u.starred;a(u,d),Xr(u.id).catch(()=>{j.error(d?s.t("actions.star_error"):s.t("actions.unstar_error")),a(u,!d)})},handleToggleStatus:async u=>{const d=u.status,c=d==="read"?"unread":"read";r(u,c),Oe([u.id],c).catch(()=>{j.error(c==="read"?s.t("actions.mark_as_read_error"):s.t("actions.mark_as_unread_error")),r(u,d)})}}},xa=(t,s)=>{const{polyglot:r}=E.get();if(t.length===0||s==="none")return t;const a=t.map((c,h)=>({id:c.id,index:h})),n=new Map,o=new Map,l=new Map,i=[],u=t.slice().sort((c,h)=>c.id-h.id).filter(c=>{const{hash:h,title:p,url:_,id:m}=c;switch(s){case"hash":if(n.has(h))return i.push(c),!1;n.set(h,m);break;case"title":if(o.has(p))return i.push(c),!1;o.set(p,m);break;case"url":if(l.has(_))return i.push(c),!1;l.set(_,m);break;default:return!0}return!0}),d=i.filter(c=>c.status==="unread").map(c=>c.id);return d.length>0&&(He(i,"read"),Oe(d,"read").catch(()=>{j.error(r.t("deduplicate.mark_as_read_error")),He(i,"unread")})),u.sort((c,h)=>{const p=a.find(m=>m.id===c.id).index,_=a.find(m=>m.id===h.id).index;return p-_})},ya=t=>{const s=new Array(t.length).fill(0);let r=0,a=1;for(;a<t.length;)t[a]===t[r]?(r++,s[a]=r,a++):r!==0?r=s[r-1]:(s[a]=0,a++);return s},ye=(t,s,r=!0)=>{const a=r?t.toLowerCase():t,n=r?s.toLowerCase():s;if(n.length===0)return 0;const o=ya(n);let l=0,i=0;for(;l<a.length;)if(a[l]===n[i]?(l++,i++):i!==0?i=o[i-1]:l++,i===n.length)return l-i;return-1},_a=t=>{const s=[],r=[];let a=[];const n=[],o=t.match(/([-+|]?)\s*"([^"]+)"/g);let l=t;o&&(a=o.map(u=>{const d=u.trim()[0],c=u.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(c);break;case"+":s.push(c);break;case"|":n.push([c]);break;default:s.push(c);break}return c}),l=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const i=l.split(/\s+/);for(const u of i){const d=u.replace(/^-|\+|\|$/,"");if(u.startsWith("-")&&d)r.push(d);else if(u.startsWith("+")&&d)s.push(d);else if(u.includes("|")){const c=u.split("|").filter(h=>h);c.length>0&&n.push(c)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:a,orConditions:n}},ja=(t,s,r=[],a=!0)=>{const{includeTerms:n,excludeTerms:o,exactPhrases:l,orConditions:i}=_a(s);return t.filter(u=>r.some(d=>{const c=u[d];if(typeof c!="string")return!1;const h=a?c.toLowerCase():c;if(o.some(m=>ye(h,m,a)!==-1)||l.length>0&&!l.some(m=>ye(h,m,a)!==-1))return!1;const p=n.every(m=>ye(h,m,a)!==-1),_=i.length===0||i.some(m=>m.some(y=>ye(h,y,a)!==-1));return p&&_}))},Qt=(t,s,r=[],a=!0)=>!Array.isArray(t)||t.length===0?(console.error("Invalid data input:",{receivedData:t,type:typeof t,isArray:Array.isArray(t),length:Array.isArray(t)?t.length:"N/A"}),[]):typeof s!="string"||s.trim().length===0?(console.error("Invalid query input:",{receivedQuery:s,type:typeof s,trimmedLength:typeof s=="string"?s.trim().length:"N/A"}),[]):ja(t,s,r,a),ba=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),va=(t,s,r)=>r?Qt(t,r,[s]):t,Zt={activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:D("homePage"),isArticleListReady:!1,loadMoreVisible:!1,offset:0,total:0},A=le(Zt),Ve=q([A,P,at,w],(t,s,r,a)=>{const{entries:n,filterString:o,filterType:l,infoFrom:i}=t,u=va(n,l,o),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:c,showAllFeeds:h}=a,p=!["starred","history"].includes(i),_=y=>d||h||!r.includes(y.feed.id),m=p?u.filter(_):u;return c==="none"||["starred","history"].includes(i)?m:xa(m,c)}),es=q([A,Ve],(t,s)=>{const{activeContent:r}=t;return r?s.findIndex(a=>a.id===r.id):-1}),G=F(A,"activeContent"),ge=F(A,"entries"),Ae=F(A,"filterString"),Ne=F(A,"filterType"),Sa=F(A,"infoFrom"),vt=F(A,"isArticleListReady"),ts=F(A,"loadMoreVisible"),Le=F(A,"offset"),wa=F(A,"total"),Ca=()=>A.set(Zt),St=le(),_e=new Set,ka=t=>{const s=f(St);return g.useEffect(()=>{s[t]||_e.has(t)||(_e.add(t),da(t).then(r=>{const a=`data:${r.data}`;St.setKey(t,a),_e.delete(t)}).catch(()=>{_e.delete(t)}))},[t,s]),s[t]},Ia=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},wt=t=>{const s=Ia(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},Ta=t=>`https://icons.duckduckgo.com/ip3/${wt(t.site_url)??wt(t.feed_url)}.ico`,ss=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,a=Ta(t);if(r===0)return e.jsx("img",{className:s,src:a,alt:""});const[n,o]=g.useState(a),l=ka(r);return g.useEffect(()=>{l&&o(l)},[l]),e.jsx("img",{className:s,src:n,alt:"",onError:()=>o(a)})},rs=J.Item,Fa=({category:t,path:s})=>{var l;const a=(l=f(Jt)[t.id])==null?void 0:l.reduce((i,u)=>i+u.unreadCount,0),n=ae(),o=()=>{n(`/category/${t.id}`),G(null)};return e.jsxs("div",{className:Re("category-title",{"submenu-active":s===`/category/${t.id}`,"submenu-inactive":s!==`/category/${t.id}`}),onClick:o,onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&o()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(k.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:a?"80%":"100%",fontWeight:500},children:t.title}),a>0&&e.jsx(k.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:a})]})},Ea=({count:t})=>e.jsx(k.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),je=({path:t,Icon:s,label:r,count:a})=>{const n=Pe(),o=ae(),l=n.pathname===t,i=()=>{o(t),G(null)};return e.jsx(rs,{onClick:i,className:Re("arco-menu-item",{"arco-menu-selected":l}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(Ea,{count:a})]})},t)},Aa=()=>{const{historyCount:t,starredCount:s,unreadTodayCount:r}=f(P),{polyglot:a}=f(E),n=f(pa);return e.jsxs(e.Fragment,{children:[e.jsx(je,{path:"/all",Icon:Fs,label:a.t("sidebar.all"),count:n}),e.jsx(je,{path:"/today",Icon:Es,label:a.t("sidebar.today"),count:r}),e.jsx(je,{path:"/starred",Icon:Ye,label:a.t("sidebar.starred"),count:s}),e.jsx(je,{path:"/history",Icon:As,label:a.t("sidebar.history"),count:t})]})},Na=({feed:t})=>{const{showFeedIcon:s}=f(w),r=ae();return e.jsx(rs,{style:{position:"relative",overflow:"hidden"},onClick:a=>{a.stopPropagation(),r(`/feed/${t.id}`),G(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(k.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:t.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[s&&e.jsx(ss,{feed:t,className:"feed-icon-sidebar"}),t.title]}),t.unreadCount!==0&&e.jsx(k.Ellipsis,{className:"item-count",expandable:!1,children:t.unreadCount})]})},`/feed/${t.id}`)},La=({categoryId:t})=>{var a;const{showUnreadFeedsOnly:s}=f(w),r=f(Jt);return e.jsx(e.Fragment,{children:(a=r[t])==null?void 0:a.filter(n=>!s||n.unreadCount>0).map(n=>e.jsx(Na,{feed:n},`/feed/${n.id}`))})},Pa=()=>{const{showUnreadFeedsOnly:t}=f(w),s=f(fa),a=Pe().pathname;return s.filter(n=>!t||n.unreadCount>0).map(n=>e.jsx(Et.Item,{name:`/category/${n.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(Fa,{category:n,path:a}),expandIcon:e.jsx(Ns,{}),children:e.jsx(La,{categoryId:n.id})},n.id))},as=()=>{const{homePage:t}=f(w),{isAppDataReady:s}=f(P),{polyglot:r}=f(E),a=Pe(),[n,o]=g.useState([`/${t}`]),l=a.pathname;return g.useEffect(()=>{o([l])},[l]),e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(J,{hasCollapseButton:!1,selectedKeys:n,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(Is,{className:"avatar",size:32,children:e.jsx(Ts,{style:{color:"var(--color-bg-1)"}})}),e.jsx(k.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(k.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:r.t("sidebar.articles")}),e.jsx(ke,{loading:!s,animation:!0,text:{rows:3}}),s&&e.jsx(Aa,{}),e.jsx(k.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:r.t("sidebar.feeds")})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx(Ge,{style:{maxHeight:"100%"},autoHide:!0,children:e.jsxs(J,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:n,children:[e.jsx(ke,{loading:!s,animation:!0,text:{rows:6}}),s&&e.jsx(Et,{triggerRegion:"icon",bordered:!1,children:e.jsx(Pa,{})})]})})})]})},Ra=()=>{const{showAllFeeds:t,theme:s}=f(w),{polyglot:r}=f(E),a=[{label:r.t("header.theme_option_light"),value:"light"},{label:r.t("header.theme_option_dark"),value:"dark"},{label:r.t("header.theme_option_system"),value:"system"}],n=ae(),o=Pe().pathname,{setAddFeedModalVisible:l,setSettingsModalVisible:i}=st(),{isBelowLarge:u}=pe(),[d,c]=g.useState(!1),[h,p]=g.useState(!1),[_,m]=g.useState(!1);g.useEffect(()=>{u||c(!1)},[u]),g.useEffect(()=>{o&&c(!1)},[o]);const y=()=>{z({showAllFeeds:!t})},T=()=>{z({theme:s==="light"?"dark":"light"})},v=()=>{Pr(),p(!1)},R=()=>{Vr(),Ca(),ga(),n("/login"),j.success(r.t("header.logout_success"))},x=()=>s==="dark"?e.jsx(zs,{}):s==="system"?e.jsx(Us,{}):e.jsx($s,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(I,{className:"trigger",onClick:()=>c(!d),shape:"circle",size:"small",children:e.jsx(Ls,{})})}),e.jsx(Ps,{className:"sidebar-drawer",visible:d,title:null,footer:null,closable:!1,onCancel:()=>c(!1),placement:"left",width:240,children:e.jsx(as,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(he,{size:16,children:[e.jsx(ie,{content:r.t("header.add_feed"),mini:!0,children:e.jsx(I,{shape:"circle",size:"small",type:"primary",icon:e.jsx(Je,{}),onClick:()=>l(!0)})}),e.jsx(ie,{content:t?r.t("header.hide_some_feeds"):r.t("header.show_all_feeds"),mini:!0,children:e.jsx(I,{shape:"circle",size:"small",icon:t?e.jsx(Rs,{}):e.jsx(Ms,{}),onClick:y})}),e.jsx(I,{shape:"circle",size:"small",icon:e.jsx(Ds,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(gt,{droplist:e.jsx(J,{defaultSelectedKeys:[s],className:"theme-menu",children:a.map(({label:C,value:O})=>e.jsxs(J.Item,{className:"theme-menu-item",onClick:()=>z({theme:O}),children:[C,s===O&&e.jsx(At,{style:{marginLeft:8}})]},O))}),children:e.jsx(I,{icon:x(),shape:"circle",size:"small",onClick:T})}),e.jsx(gt,{droplist:e.jsxs(J,{children:[e.jsxs(J.Item,{onClick:()=>i(!0),children:[e.jsx(Os,{className:"icon-right"}),r.t("header.settings")]},"0"),e.jsxs(J.Item,{onClick:()=>p(!0),children:[e.jsx(fe,{className:"icon-right"}),r.t("header.reset_settings")]},"1"),e.jsxs(J.Item,{onClick:()=>m(!0),children:[e.jsx(Vs,{className:"icon-right"}),r.t("header.logout")]},"2")]}),trigger:"click",children:e.jsx(I,{icon:e.jsx(Nt,{}),shape:"circle",size:"small"})})]})}),e.jsx(Z,{title:r.t("header.settings_reset_confirm"),visible:h,onOk:v,onCancel:()=>p(!1),children:e.jsx("p",{children:r.t("header.settings_reset_description")})}),e.jsx(Z,{title:r.t("header.logout_confirm"),visible:_,onOk:R,onCancel:()=>m(!1),children:e.jsx("p",{children:r.t("header.logout_description")})})]})},Ma=(t,s)=>{const r=t.split("."),a=s.split(".");for(let n=0;n<Math.max(r.length,a.length);n++){const o=r[n]||"0",l=a[n]||"0",i=o.localeCompare(l,void 0,{numeric:!0});if(i!==0)return i}return 0},lt=()=>{const t=g.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,bt(!1);try{const r=await Promise.all([ra(),Se(0,"unread"),qt(),sa(),$r(),ua()]),[a,n,o,l,i,u]=r,d=l.reduce((h,p)=>(h[p.id]=a.unreads[p.id]??0,h),{}),c=Object.values(a.reads).reduce((h,p)=>h+p,0);nt(d),ot(n.total??0),Ee(o.total??0),Fe(c),re(l),we(i),ma(Ma(u.version,"2.2.0")>=0),bt(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},qe={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Green:{light:"#00B42A",dark:"#27C346"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Magenta:{light:"#F5319D",dark:"#F756A9"}},Ke=t=>{const s=qe[t]||qe.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,a=D("theme");return(a==="system"?r:a==="dark")?s.dark:s.light},ns=t=>{Bs(Ke(t),{list:!0}).map(Hs).forEach((r,a)=>{document.body.style.setProperty(`--primary-${a+1}`,r)})},U=({title:t,description:s,children:r})=>e.jsxs("section",{className:"setting-row",children:[e.jsxs("header",{children:[e.jsx(k.Title,{heading:6,style:{marginTop:0},children:t}),e.jsx(k.Text,{type:"secondary",children:s})]}),r]}),Da=()=>{const{articleWidth:t,fontSize:s,fontFamily:r,layout:a,showDetailedRelativeTime:n,showFeedIcon:o,themeColor:l}=f(w),{polyglot:i}=f(E),u=[{label:i.t("appearance.font_family_system"),value:"system-ui"},{label:"Sans-serif",value:"sans-serif"},{label:"Serif",value:"serif"},{label:"Fira Sans",value:"'Fira Sans', sans-serif"},{label:"Open Sans",value:"'Open Sans', sans-serif"},{label:"Source Sans Pro",value:"'Source Sans Pro', sans-serif"},{label:"Source Serif Pro",value:"'Source Serif Pro', serif"},{label:i.t("appearance.font_family_noto_sans"),value:"'Noto Sans SC', sans-serif"},{label:i.t("appearance.font_family_noto_serif"),value:"'Noto Serif SC', serif"},{label:i.t("appearance.font_family_lxgw_wenkai"),value:"'LXGW WenKai Screen', sans-serif"}],d=c=>{z(c),c.themeColor&&ns(c.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:i.t("appearance.theme_color_label"),description:i.t("appearance.theme_color_description"),children:e.jsx("div",{style:{display:"flex"},children:Object.keys(qe).map(c=>e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:Ke(c),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:c===l?`1px solid ${Ke(c)}`:"none"},onClick:()=>d({themeColor:c}),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&d({themeColor:c})},"aria-label":i.t("appearance.theme_color_aria_label",{color:c}),role:"button",tabIndex:0},c))})}),e.jsx($,{}),e.jsx(U,{title:i.t("appearance.compact_article_list_label"),description:i.t("appearance.compact_article_list_description"),children:e.jsx(W,{checked:a==="small",onChange:c=>d({layout:c?"small":"large"})})}),e.jsx($,{}),e.jsx(U,{title:i.t("appearance.show_detailed_relative_time_label"),description:i.t("appearance.show_detailed_relative_time_description"),children:e.jsx(W,{checked:n,onChange:c=>d({showDetailedRelativeTime:c})})}),e.jsx($,{}),e.jsx(U,{title:i.t("appearance.show_feed_icon_label"),description:i.t("appearance.show_feed_icon_description"),children:e.jsx(W,{checked:o,onChange:c=>d({showFeedIcon:c})})}),e.jsx($,{}),e.jsx(U,{title:i.t("appearance.font_family_label"),description:i.t("appearance.font_family_description"),children:e.jsx(N,{style:{width:166},value:r,onChange:c=>d({fontFamily:c}),children:u.map(({label:c,value:h})=>e.jsx(N.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:i.t("appearance.font_size_label"),description:i.t("appearance.font_size_description"),children:e.jsxs(he,{children:[e.jsx(k.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(xt,{formatTooltip:c=>`${c}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:c=>d({fontSize:c})}),e.jsx(k.Text,{style:{fontSize:"1.25rem"},children:"A"})]})}),e.jsx($,{}),e.jsx(U,{title:i.t("appearance.article_width_label"),description:i.t("appearance.article_width_description"),children:e.jsxs(he,{children:[e.jsx(k.Text,{children:"60%"}),e.jsx(xt,{formatTooltip:c=>`${c}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:c=>d({articleWidth:c})}),e.jsx(k.Text,{children:"90%"})]})})]})},Oa=()=>{const t=f(me),{polyglot:s}=f(E),[r]=L.useForm(),[a,n]=g.useState(!1),[o,l]=g.useState(""),[i,u]=g.useState({}),[d,c]=g.useState(!1),h=async()=>{if(o.trim()){try{const m=await Br(o);we(y=>[...y,{...m}]),j.success(s.t("category_list.add_category_success"))}catch(m){console.error(`${s.t("category_list.add_category_error")}: `,m),j.error(s.t("category_list.add_category_error"))}l(""),c(!1)}},p=async(m,y,T)=>{try{const v=await qr(m,y,T);re(R=>R.map(x=>x.category.id===m?{...x,category:{...x.category,title:y,hide_globally:T}}:x)),we(R=>R.map(x=>x.id===m?{...x,...v}:x)),j.success(s.t("category_list.update_category_success"))}catch{j.error(s.t("category_list.update_category_error"))}n(!1),r.resetFields()},_=async m=>{try{(await Hr(m.id)).status===204?(we(T=>T.filter(v=>v.id!==m.id)),j.success(s.t("category_list.remove_category_success",{title:m.title}))):j.error(s.t("category_list.remove_category_error",{title:m.title}))}catch(y){console.error(s.t("category_list.remove_category_error",{title:m.title}),y),j.error(s.t("category_list.remove_category_error",{title:m.title}))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(m=>e.jsx(se,{className:"tag-style",closable:m.feedCount===0,size:"medium",onClick:()=>{u(m),n(!0),r.setFieldsValue({title:m.title})},onClose:async y=>{y.stopPropagation(),await _(m)},children:m.title},m.id)),d?e.jsx(B,{autoFocus:!0,className:"input-style",onBlur:h,onChange:l,onPressEnter:h,size:"small",value:o}):e.jsx(se,{className:"add-category-tag",icon:e.jsx(Je,{}),onClick:()=>c(!0),size:"medium",tabIndex:0})]}),i&&e.jsx(Z,{className:"modal-style",onOk:r.submit,title:"Edit Category",unmountOnExit:!0,visible:a,onCancel:()=>{n(!1),r.resetFields()},children:e.jsxs(L,{form:r,layout:"vertical",onSubmit:m=>p(i.id,m.title,m.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(L.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(B,{placeholder:"Please input category title"})}),e.jsx(L.Item,{label:"Hidden",field:"hidden",initialValue:i.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(W,{})})]})})]})},Va=t=>new Promise(s=>setTimeout(s,t)),za=(t,s,r=!1)=>{let a;return function(...n){const o=()=>{a=null,r||t.apply(this,n)},l=r&&!a;clearTimeout(a),a=setTimeout(o,s),l&&t.apply(this,n)}},os=Xe(""),Ct=F(os),ct=Xe("title"),Ua=F(ct),dt=q([P,os,ct],(t,s,r)=>{const{feedsData:a}=t,n=[...a].sort((o,l)=>o.disabled&&!l.disabled?1:!o.disabled&&l.disabled?-1:0).sort((o,l)=>l.parsing_error_count-o.parsing_error_count);return s?Qt(n,s,[r]):n}),$a=q(dt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),is=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:Yr()}:t,ls=async(t,s,r=!0)=>{const{polyglot:a}=E.get();try{const o=(await t()).status===204;return r&&(o?j.success(a.t("feed_table.refresh_success")):j.error(a.t("feed_table.refresh_error"))),re(l=>l.map(i=>s(i,o))),o}catch(n){return console.error("Failed to refresh feed: ",n),r&&j.error(a.t("feed_table.refresh_error")),re(o=>o.map(l=>s(l,!1))),!1}},cs=async(t,s=!0)=>{const r=t.id||t.key;return ls(()=>aa(r),(a,n)=>is(a,n,r),s)},Ba=({visible:t,setVisible:s})=>{const{polyglot:r}=f(E),a=f(dt),n=async()=>{s(!1),await ls(na,is)},o=async()=>{s(!1);const i=a.filter(c=>c.parsing_error_count>0);j.success(r.t("feed_table.bulk_refresh_error_feeds_message"));let u=0,d=0;for(const c of i)await cs(c,!1)?u++:d++,await Va(500);j.success(r.t("feed_table.bulk_refresh_error_feeds_result",{success:u,failure:d}))},l=()=>s(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:e.jsx(fe,{}),shape:"circle",size:"small",onClick:()=>s(!0)}),e.jsx(Z,{className:"edit-modal",onCancel:l,title:r.t("feed_table.refresh_feeds_title"),visible:t,footer:[e.jsx(I,{onClick:l,children:r.t("feed_table.refresh_feeds_cancel")},"cancel"),e.jsx(I,{type:"outline",onClick:o,children:r.t("feed_table.refresh_feeds_error")},"error"),e.jsx(I,{type:"primary",onClick:n,children:r.t("feed_table.refresh_feeds_all")},"all")],children:e.jsx("p",{children:r.t("feed_table.refresh_feeds_description")})})]})},Ha=({visible:t,setVisible:s})=>{const{polyglot:r}=f(E),a=f(dt),[n,o]=g.useState(""),l=async()=>{try{const i=await Promise.all(a.map(async d=>{const c=new URL(d.feed_url).hostname;if(c===n)return d;const h=d.feed_url.replace(c,n),p=await Kt(d.id,{feedUrl:h});return{...d,...p}})),u=(d,c)=>c.find(p=>p.id===d.id)||d;re(d=>d.map(c=>u(c,i))),j.success(r.t("feed_table.bulk_update_success")),s(!1)}catch(i){console.error("Failed to bulk update feeds: ",i),j.error(r.t("feed_table.bulk_update_error"))}};return e.jsxs(Z,{className:"edit-modal",onOk:l,title:r.t("feed_table.modal_bulk_update_title"),visible:t,onCancel:()=>{s(!1),o("")},children:[e.jsx("p",{children:r.t("feed_table.modal_bulk_update_description")}),e.jsx(B,{placeholder:"rsshub.app",value:n,onChange:i=>o(i)})]})},qa=({visible:t,setVisible:s,feedForm:r,selectedFeed:a})=>{const{polyglot:n}=f(E),o=f(me),l=async(i,u)=>{try{const d=await Kt(i,u);re(c=>c.map(h=>h.id===i?{...h,...d}:h)),j.success(n.t("feed_table.update_feed_success")),s(!1),r.resetFields()}catch(d){console.error("Failed to update feed: ",d),j.error(n.t("feed_table.update_feed_error"))}};return e.jsx(Z,{className:"edit-modal",onOk:r.submit,title:n.t("feed_table.modal_edit_feed_title"),unmountOnExit:!0,visible:t,onCancel:()=>{s(!1),r.resetFields()},children:e.jsxs(L,{form:r,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async i=>{const u={categoryId:i.category,title:i.title,siteUrl:i.siteUrl.trim(),feedUrl:i.feedUrl.trim(),hidden:i.hidden,disabled:i.disabled,isFullText:i.crawler};u.feedUrl?await l(a.key,u):j.error(n.t("feed_table.modal_edit_feed_submit_error"))},children:[e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_category_label"),required:!0,field:"category",rules:[{required:!0}],children:e.jsx(N,{children:o.map(i=>e.jsx(N.Option,{value:i.id,children:i.title},i.id))})}),e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(B,{placeholder:n.t("feed_table.modal_edit_feed_title_placeholder")})}),e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_site_url_label"),field:"siteUrl",rules:[{required:!0}],children:e.jsx(B,{placeholder:n.t("feed_table.modal_edit_feed_site_url_placeholder")})}),e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_feed_url_label"),field:"feedUrl",rules:[{required:!0}],children:e.jsx(B,{placeholder:n.t("feed_table.modal_edit_feed_feed_url_placeholder")})}),e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_hidden_label"),field:"hidden",initialValue:a.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(W,{})}),e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_disabled_label"),field:"disabled",initialValue:a.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(W,{})}),e.jsx(L.Item,{label:n.t("feed_table.modal_edit_feed_crawler_label"),field:"crawler",tooltip:e.jsx("div",{children:n.t("feed_table.modal_edit_feed_crawler_tooltip")}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(W,{})})]})})},Ka=()=>{const{isAppDataReady:t}=f(P),{showDetailedRelativeTime:s}=f(w),r=f(ct),a=f($a),{polyglot:n}=f(E),o=n.t("search.tooltip").split(`
`),[l,i]=g.useState(!1),[u,d]=g.useState(!1),[c,h]=g.useState(!1),[p]=L.useForm(),[_,m]=g.useState(null),{isBelowMedium:y}=pe();g.useEffect(()=>{Ct("")},[]);const T=x=>{m(x),h(!0),p.setFieldsValue({category:x.category.id,title:x.title,siteUrl:x.site_url,feedUrl:x.feed_url,hidden:x.hidden,disabled:x.disabled,crawler:x.crawler})},v=async x=>{try{(await ia(x.key)).status===204?(re(O=>O.filter(H=>H.id!==x.key)),j.success(n.t("feed_table.remove_feed_success",{title:x.title}))):j.error(n.t("feed_table.remove_feed_error",{title:x.title}))}catch(C){console.error(`Failed to unfollow feed: ${x.title}`,C),j.error(n.t("feed_table.remove_feed_error",{title:x.title}))}},R=[{title:n.t("feed_table.table_title"),dataIndex:"title",sorter:(x,C)=>x.title.localeCompare(C.title,"en"),render:(x,C)=>{const O=C.parsing_error_count;let H=C.disabled?`ðŸš« ${x}`:x;O>0&&(H=`âš ï¸ ${x}`);const X=e.jsxs("div",{children:[x,O>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"âš ï¸ Parsing error count: ",O]})]});return e.jsx(k.Ellipsis,{expandable:!1,children:e.jsx(ie,{mini:!0,content:X,children:H})})}},!y&&{title:n.t("feed_table.table_url"),dataIndex:"feed_url",sorter:(x,C)=>x.feed_url.localeCompare(C.feed_url,"en"),render:x=>e.jsx(k.Ellipsis,{expandable:!1,showTooltip:!0,children:x})},{title:n.t("feed_table.table_category"),dataIndex:"category.title",sorter:(x,C)=>x.category.title.localeCompare(C.category.title,"en"),render:x=>e.jsx(k.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(se,{children:x})})},!y&&{title:n.t("feed_table.table_checked_at"),dataIndex:"checked_at",sorter:(x,C)=>x.checked_at.localeCompare(C.checked_at,"en"),render:x=>e.jsx(k.Ellipsis,{expandable:!1,children:Bt(x,s)})},{title:n.t("feed_table.table_actions"),dataIndex:"op",fixed:"right",width:100,render:(x,C)=>e.jsxs(he,{children:[e.jsx("button",{"aria-label":n.t("feed_table.table_feed_edit_label"),className:"list-item-action",onClick:()=>T(C),type:"button",children:e.jsx(yt,{})}),e.jsx("button",{"aria-label":n.t("feed_table.table_feed_refresh_label"),className:"list-item-action",onClick:()=>cs(C),type:"button",children:e.jsx(fe,{})}),e.jsx(Lt,{focusLock:!0,position:"left",title:n.t("feed_table.table_feed_remove_confirm"),onOk:()=>v(C),children:e.jsx("span",{className:"list-item-action",children:e.jsx(qs,{})})})]})}].filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"feed-table-action-bar",children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(B.Search,{allowClear:!0,className:"search-input",onChange:Ct,placeholder:n.t("search.placeholder"),addBefore:e.jsxs(N,{onChange:Ua,style:{width:126},value:r,children:[e.jsx(N.Option,{value:"title",children:n.t("search.type_title")}),e.jsx(N.Option,{value:"feed_url",children:n.t("search.type_feed_url")}),e.jsx(N.Option,{value:"site_url",children:n.t("search.type_site_url")})]})})}),e.jsxs("div",{className:"button-group",children:[e.jsx(ie,{mini:!0,position:"bottom",content:e.jsx("div",{children:o.map((x,C)=>e.jsxs(g.Fragment,{children:[x,C<o.length-1&&e.jsx("br",{})]},`line-${C}-${x.length}`))}),children:e.jsx(I,{shape:"circle",size:"small",icon:e.jsx(Pt,{})})}),e.jsx(I,{icon:e.jsx(yt,{}),shape:"circle",size:"small",onClick:()=>i(!0)}),e.jsx(Ha,{visible:l,setVisible:i}),e.jsx(Ba,{visible:u,setVisible:d})]})]}),e.jsx(Rt,{borderCell:!0,className:"feed-table",columns:R,data:a,loading:!t,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),_&&e.jsx(qa,{visible:c,setVisible:h,feedForm:p,selectedFeed:_})]})},Wa=[{label:"English",value:"en-US"},{label:"EspaÃ±ol",value:"es-ES"},{label:"ç®€ä½“ä¸­æ–‡",value:"zh-CN"}],Ga=()=>{const{homePage:t,language:s,markReadOnScroll:r,orderBy:a,pageSize:n,removeDuplicates:o,showUnreadFeedsOnly:l}=f(w),{polyglot:i}=f(E),u=[{label:i.t("settings.default_home_page_option_all"),value:"all"},{label:i.t("settings.default_home_page_option_today"),value:"today"},{label:i.t("settings.default_home_page_option_starred"),value:"starred"},{label:i.t("settings.default_home_page_option_history"),value:"history"}],d=[{label:i.t("settings.remove_duplicates_option_none"),value:"none"},{label:i.t("settings.remove_duplicates_option_hash"),value:"hash"},{label:i.t("settings.remove_duplicates_option_title"),value:"title"},{label:i.t("settings.remove_duplicates_option_url"),value:"url"}];return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:i.t("appearance.language_label"),description:i.t("appearance.language_description"),children:e.jsx(N,{className:"input-select",onChange:c=>z({language:c}),value:s,children:Wa.map(({label:c,value:h})=>e.jsx(N.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:i.t("settings.default_home_page_label"),description:i.t("settings.default_home_page_description"),children:e.jsx(N,{className:"input-select",onChange:c=>z({homePage:c}),value:t,children:u.map(({label:c,value:h})=>e.jsx(N.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:i.t("settings.show_unread_feeds_only_label"),description:i.t("settings.show_unread_feeds_only_description"),children:e.jsx(W,{checked:l,onChange:c=>z({showUnreadFeedsOnly:c})})}),e.jsx($,{}),e.jsx(U,{title:i.t("settings.entries_order_label"),description:i.t("settings.entries_order_description"),children:e.jsxs(N,{className:"input-select",onChange:c=>z({orderBy:c}),value:a,children:[e.jsx(N.Option,{value:"published_at",children:i.t("settings.entries_order_option_published_at")}),e.jsx(N.Option,{value:"created_at",children:i.t("settings.entries_order_option_created_at")})]})}),e.jsx($,{}),e.jsx(U,{title:i.t("settings.entries_per_page_label"),description:i.t("settings.entries_per_page_description"),children:e.jsx(Ks,{className:"input-select",defaultValue:n,min:1,mode:"button",onChange:c=>z({pageSize:c}),size:"small"})}),e.jsx($,{}),e.jsx(U,{title:i.t("settings.remove_duplicates_label"),description:i.t("settings.remove_duplicates_description"),children:e.jsx(N,{className:"input-select",onChange:c=>z({removeDuplicates:c}),value:o,children:d.map(({label:c,value:h})=>e.jsx(N.Option,{value:h,children:c},h))})}),e.jsx($,{}),e.jsx(U,{title:i.t("settings.mark_read_on_scroll_label"),description:i.t("settings.mark_read_on_scroll_description"),children:e.jsx(W,{checked:r,onChange:c=>z({markReadOnScroll:c})})})]})},ds={exitDetailView:["esc"],fetchOriginalArticle:["d"],navigateToNextArticle:["n","j","right"],navigateToNextUnreadArticle:["N","J","ctrl+right"],navigateToPreviousArticle:["p","k","left"],navigateToPreviousUnreadArticle:["P","K","ctrl+left"],openLinkExternally:["v"],openPhotoSlider:["i"],saveToThirdPartyServices:["s"],toggleReadStatus:["m"],toggleStarStatus:["f"]},ut=We("hotkeys",ds,{encode:JSON.stringify,decode:JSON.parse}),Ce=(t,s)=>{F(ut,t)(s)},Ya=t=>Ce(t,ds[t]),Ja=({value:t,onChange:s,onRemove:r,editOnMount:a=!1})=>{const[n,o]=g.useState(a),l=()=>{o(!1)},i=g.useCallback(u=>{if(n){u.preventDefault();const{key:d,ctrlKey:c,shiftKey:h,altKey:p,metaKey:_}=u;if(["Control","Shift","Alt","Meta","CapsLock"].includes(d))return;let m=d;switch(d){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":m=d.replace("Arrow","").toLowerCase();break;case" ":m="space";break}const y=[];c&&y.push("ctrl"),h&&y.push("shift"),p&&y.push("alt"),_&&y.push("meta");const T=y.length>0?`${y.join("+")}+${m}`:m;s(T),o(!1)}},[n,s]);return g.useEffect(()=>(window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}),[i]),n?e.jsx(B,{autoFocus:!0,size:"mini",value:t,style:{width:84,marginRight:8},onPressEnter:l,onBlur:l,onChange:s}):e.jsx(se,{style:{marginRight:8},closable:!!r,onClose:u=>{u.stopPropagation(),r()},onClick:()=>o(!0),children:t})},kt=t=>t.trim().length>1?t.charAt(0).toUpperCase()+t.slice(1):t,Xa=t=>t.map(s=>{const r=s.replace("left","â†").replace("right","â†’").replace("up","â†‘").replace("down","â†“");return r.includes("+")?r.split("+").map(kt).join(" + "):kt(r)}).join(" / "),Qa=({keys:t,record:s})=>{const[r,a]=g.useState(!1),n=g.useRef(null);return g.useEffect(()=>{const o=l=>{n.current&&!n.current.contains(l.target)&&a(!1)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]),e.jsx("div",{ref:n,children:r?e.jsxs(he,{wrap:!0,children:[t.map((o,l)=>e.jsx(Ja,{value:o,editOnMount:o==="",onChange:i=>{const u=[...t];u[l]=i,Ce(s.action,u)},onRemove:()=>{const i=t.filter((u,d)=>d!==l);Ce(s.action,i)}},`${s.action}-${o}`)),e.jsx(se,{icon:e.jsx(Je,{}),style:{backgroundColor:"var(--color-fill-2)",border:"1px dashed var(--color-fill-3)",cursor:"pointer"},onClick:()=>{const o=[...t,""];Ce(s.action,o)}}),e.jsx(I,{icon:e.jsx(fe,{}),shape:"circle",size:"small",onClick:()=>Ya(s.action)})]}):e.jsx(se,{onClick:()=>a(!0),style:{cursor:"pointer"},children:Xa(t)})})},Za=()=>{const{polyglot:t}=f(E),s=f(ut),r=["navigateToPreviousArticle","navigateToPreviousUnreadArticle","navigateToNextArticle","navigateToNextUnreadArticle","openLinkExternally","toggleReadStatus","fetchOriginalArticle","toggleStarStatus","saveToThirdPartyServices","openPhotoSlider","exitDetailView"],a=[{title:t.t("hotkeys.key"),dataIndex:"keys",render:(o,l)=>e.jsx(Qa,{keys:o,record:l})},{title:t.t("hotkeys.function"),dataIndex:"description"}],n=r.map(o=>({action:o,key:o,keys:s[o],description:t.t(`hotkeys.${o}`)}));return e.jsx(Rt,{borderCell:!0,columns:a,data:n,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}})},en=()=>{const{polyglot:t}=f(E),s=(r,a)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r,e.jsx("div",{style:{fontSize:"12px"},children:a})]});return e.jsxs(oe,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(oe.TabPane,{title:s(e.jsx(Ws,{style:{fontSize:"20px"}}),t.t("settings.feeds")),children:e.jsx(Ka,{})},"1"),e.jsx(oe.TabPane,{title:s(e.jsx(Gs,{style:{fontSize:"20px"}}),t.t("settings.categories")),children:e.jsx(Oa,{})},"2"),e.jsx(oe.TabPane,{title:s(e.jsx(Ys,{style:{fontSize:"20px"}}),t.t("settings.general")),children:e.jsx(Ga,{})},"3"),e.jsx(oe.TabPane,{title:s(e.jsx(Js,{style:{fontSize:"20px"}}),t.t("settings.appearance")),children:e.jsx(Da,{})},"4"),e.jsx(oe.TabPane,{title:s(e.jsx(Xs,{style:{fontSize:"20px"}}),t.t("settings.hotkeys")),children:e.jsx(Za,{})},"5")]})},tn=[{required:!0}],sn=[{required:!0}],rn=[{type:"boolean"}],an=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=st();return e.jsx(Z,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(en,{})})},nn=()=>{const t=f(me),{polyglot:s}=f(E),{addFeedModalVisible:r,setAddFeedModalVisible:a}=st(),[n,o]=g.useState(!1),[l]=L.useForm(),{fetchAppData:i}=lt(),u=async(d,c,h)=>{o(!0);try{await oa(d,c,h),await i(),j.success(s.t("main.add_feed_success")),a(!1),l.resetFields()}catch(p){console.error("Failed to add a feed: ",p),j.error(s.t("main.add_feed_error"))}finally{o(!1)}};return e.jsx(Z,{title:s.t("main.add_feed_modal_title"),visible:r,unmountOnExit:!0,style:{width:"400px"},onOk:l.submit,confirmLoading:n,onCancel:()=>{a(!1),l.resetFields()},children:e.jsxs(L,{form:l,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async d=>{const c=d.url.trim();c?await u(c,d.category,d.crawler):j.error(s.t("main.add_feed_url_empty"))},children:[e.jsx(L.Item,{label:s.t("main.add_feed_modal_feed_url_label"),field:"url",rules:tn,children:e.jsx(B,{placeholder:s.t("main.add_feed_modal_feed_url_placeholder")})}),e.jsx(L.Item,{field:"category",label:s.t("main.add_feed_modal_category_label"),required:!0,rules:sn,children:e.jsx(N,{placeholder:s.t("main.add_feed_modal_category_placeholder"),showSearch:!0,filterOption:(d,c)=>ba(c.props.children,d),children:t.map(d=>e.jsx(N.Option,{value:d.id,children:d.title},d.id))})}),e.jsx(L.Item,{field:"crawler",initialValue:!1,label:s.t("main.add_feed_modal_crawler_label"),rules:rn,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(W,{})})]})})},on=()=>e.jsxs("div",{className:"main",children:[e.jsx(Qs,{}),e.jsx(an,{}),e.jsx(nn,{})]}),us=()=>{const{theme:t,themeColor:s}=f(w),[r,a]=g.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);g.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)"),o=l=>a(l.matches);return n.addEventListener("change",o),()=>n.removeEventListener("change",o)},[]),g.useEffect(()=>{const n=o=>{const l=o?"dark":"light";document.body.setAttribute("arco-theme",l),document.body.style.colorScheme=l};ns(s),n(t==="system"?r:t==="dark")},[r,t,s])},ht=()=>{const t=document.querySelector(".spinner");t&&(t.style.display="none")},ln=()=>{zt(),us();const{isBelowLarge:t}=pe(),{polyglot:s}=f(E);return g.useEffect(()=>{ht()},[]),s&&e.jsxs("div",{className:"app",children:[t?null:e.jsx(Zs.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(as,{})}),e.jsx(Ra,{}),e.jsx(on,{})]})},hs=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(a=>a.getAttribute("src"))},fs=t=>{var n;const a=(n=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:n.getAttribute("src");return{...t,imgSrc:a}},cn=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(fs);ge(s),wa(t.total),ts(s.length<t.total)}},dn=(t,s)=>{const{isAppDataReady:r}=f(P),{showStatus:a}=f(w),n=g.useRef(!1),o=async l=>{if(!n.current){n.current=!0,vt(!1);try{const i=a==="unread"?await l(0,"unread"):await l();switch(t.from){case"feed":a==="unread"&&nt(u=>({...u,[Number(t.id)]:i.total}));break;case"history":Fe(i.total);break;case"starred":a!=="unread"&&Ee(i.total);break;case"today":a==="unread"&&ot(i.total);break}vt(!0),cn(i)}catch(i){console.error("Error fetching articles: ",i)}finally{n.current=!1}}};return g.useEffect(()=>{r&&o(s)},[r]),{fetchArticleList:o}},ps=Xe(!1),It=F(ps),un=(t,s)=>!s.some(r=>r.id===t.id),ft=()=>{const{offset:t}=f(A),{pageSize:s,showStatus:r}=f(w),a=f(ps),n=l=>{const i=(u,d)=>d.filter(c=>un(c,u));ge(u=>[...u,...i(u,l)]),Le(u=>u+s)};return{handleLoadMore:async l=>{var i;It(!0);try{const u=r==="unread"?await l(t+s,"unread"):await l(t+s);if(((i=u==null?void 0:u.entries)==null?void 0:i.length)>0){const d=u.entries.map(fs);n(d)}else ts(!1)}catch(u){console.error("Error fetching more articles: ",u)}finally{It(!1)}},loadingMore:a}},pt=le({isPhotoSliderVisible:!1,selectedIndex:0}),hn=F(pt,"isPhotoSliderVisible"),fn=F(pt,"selectedIndex"),ms=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=f(pt);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:hn,selectedIndex:s,setSelectedIndex:fn}},gs=(t,s)=>{const{activeContent:r,loadMoreVisible:a}=f(A),n=f(es),o=f(Ve),{isPhotoSliderVisible:l,setIsPhotoSliderVisible:i,setSelectedIndex:u}=ms(),{loadingMore:d}=ft(),[c,h]=g.useState(!1),[p,_]=g.useState(!1);g.useEffect(()=>{p&&!d&&(h(!1),_(!1),x())},[d,p]);const m=()=>{if(s.current){const S=s.current.el.querySelector(".card-custom-selected-style");S&&S.scrollIntoView({behavior:"smooth",block:"nearest"})}},y=S=>(...V)=>{if(r)return S(...V)},T=y(()=>{G(null),s.current&&s.current.contentWrapperEl.focus()}),v=(S,V,Y,ne)=>{const ze=V==="prev"?ne.slice(0,S).toReversed():ne.slice(S+1);return Y?ze.find(Ue=>Ue.status==="unread"):ne[S+(V==="prev"?-1:1)]},R=(S=!1)=>{if(n>0){const V=v(n,"prev",S,o);V&&(t(V),setTimeout(()=>m(),200))}},x=(S=!1)=>{if(c)return;if(n===o.length-1&&a){h(!0),_(!0);return}if(n===-1){s.current.contentWrapperEl.scrollTo({top:0});return}const Y=v(n,"next",S,o);Y&&(t(Y),setTimeout(()=>m(),200),_(!1))},C=y(()=>{window.open(r.url,"_blank")}),O=y(S=>{S()}),H=y(S=>{S()}),X=y(S=>{S()}),ee=y(S=>{S()}),te=y(()=>{!hs(r.content).length||l||(u(0),i(!0))});return{exitDetailView:T,fetchOriginalArticle:O,navigateToNextArticle:x,navigateToPreviousArticle:R,openLinkExternally:C,openPhotoSlider:te,saveToThirdPartyServices:H,toggleReadStatus:X,toggleStarStatus:ee}},pn=({handleEntryClick:t,entryListRef:s})=>{const{activeContent:r}=f(A),a=f(es),n=f(Ve),o=a===0,l=a===n.length-1,[i,u]=g.useState(!1),{handleFetchContent:d,handleSaveToThirdPartyServices:c,handleToggleStarred:h,handleToggleStatus:p}=it(),{exitDetailView:_,navigateToNextArticle:m,navigateToPreviousArticle:y}=gs(t,s),T=r.status==="unread",v=r.starred;return g.useEffect(()=>{u(!1)},[r]),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(I,{icon:e.jsx(er,{}),onClick:()=>_(),shape:"circle"}),e.jsx(I,{icon:e.jsx(tr,{}),onClick:()=>y(),shape:"circle",disabled:o}),e.jsx(I,{icon:e.jsx(sr,{}),onClick:()=>m(),shape:"circle",disabled:l})]}),e.jsxs("div",{className:"right-side",children:[e.jsx(I,{icon:T?e.jsx(Mt,{}):e.jsx(Dt,{}),onClick:()=>p(r),shape:"circle"}),e.jsx(I,{icon:v?e.jsx(Qe,{style:{color:"#ffcd00"}}):e.jsx(Ye,{}),onClick:()=>h(r),shape:"circle"}),e.jsx(I,{icon:e.jsx(rr,{}),onClick:async()=>{await d(),u(!0)},shape:"circle",disabled:i}),e.jsx(I,{icon:e.jsx(ar,{}),onClick:c,shape:"circle"})]})]})},mn=({url:t,text:s})=>{const[r,a]=g.useState(!1),n=()=>a(!r);return e.jsx(ir,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:n,onMouseLeave:n,children:s})},be=({imgNode:t,isIcon:s})=>{const{fontSize:r}=f(w);return e.jsx("img",{...t.attribs,alt:t.attribs.alt??"image",style:s?{display:"inline-block",width:"auto",height:`${r}rem`,margin:0}:{}})},Tt=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:a=!1})=>{var p;const[n,o]=g.useState(!1),[l,i]=g.useState(!1),{isBelowMedium:u}=pe();g.useEffect(()=>{const m=(a?t.children[0]:t).attribs.src,y=new Image;y.src=m,y.onload=()=>i(y.width<=100&&y.height<=100)},[t,a]);const d=a?t.children[0]:t;if(l)return a?e.jsxs("a",{...t.attribs,children:[e.jsx(be,{imgNode:d,isIcon:l}),(p=t.children[1])==null?void 0:p.data]}):e.jsx(be,{imgNode:d,isIcon:l});const c=()=>o(!0),h=()=>o(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:c,onMouseLeave:h,children:[a?e.jsx("a",{...t.attribs,children:e.jsx(be,{imgNode:d,isIcon:l})}):e.jsx(be,{imgNode:d,isIcon:l}),e.jsx(I,{icon:e.jsx(lr,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:u||n?1:0,transition:"opacity 0.3s"},onClick:_=>{_.preventDefault(),r(s)}})]})})},gn=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const a=r.children[0];if(a.type==="tag"&&a.name==="img"){const n=t.findIndex(o=>o===a.attribs.src);return e.jsx(Tt,{node:r,index:n,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const a=t.findIndex(n=>n===r.attribs.src);return e.jsx(Tt,{node:r,index:a,togglePhotoSlider:s})}return r}}),xn=g.forwardRef((t,s)=>{const r=ae(),{activeContent:a}=f(A),{articleWidth:n,fontFamily:o,fontSize:l}=f(w),{isPhotoSliderVisible:i,setIsPhotoSliderVisible:u,selectedIndex:d,setSelectedIndex:c}=ms(),h=()=>{Ne("author"),Ae(a.author)},p=R=>{c(R),u(x=>!x)},_=hs(a.content),m=gn(_,p),y=nr(a.content,m),{id:T,title:v}=a.feed.category;return e.jsx("article",{className:"article-content",ref:s,tabIndex:-1,children:e.jsxs(Ge,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${n}%`},children:[e.jsx(k.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(k.Text,{children:e.jsx(mn,{url:`/feed/${a.feed.id}`,text:a.feed.title})}),e.jsx(k.Text,{onClick:h,style:{cursor:"pointer"},children:` - ${a.author}`}),e.jsx(k.Text,{children:e.jsx(se,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>r(`/category/${T}`),children:v})})]}),e.jsx(k.Text,{className:"article-date",children:Jr(a.published_at)}),e.jsx("br",{}),e.jsx(k.Text,{className:"article-date",children:Ht(a.reading_time)}),e.jsx($,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${l}rem`,width:`${n}%`,fontFamily:o},children:[y,e.jsx(or,{images:_.map(R=>({src:R,key:R})),loop:!1,visible:i,onClose:()=>{u(!1)},index:d,onIndexChange:c})]},a.id)]})})}),yn=({alt:t,borderRadius:s,height:r,src:a,status:n,width:o})=>{const[l,i]=g.useState(!1),{ref:u}=Me({triggerOnce:!0,onChange:(d,c)=>{if(d&&!l){const h=new Image;h.onload=()=>i(!0),h.onerror=()=>{c.target.style.display="none"},h.src=a}}});return e.jsx("div",{className:"image-container",ref:u,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:l?e.jsx("img",{className:n==="unread"?"":"read",src:a,alt:t,style:{width:o,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(ke,{text:{rows:0},image:{style:{width:o,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},_n=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(yn,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},jn=(t,s)=>t?s?"0 10px 0 0":"0 0 10px 0":"0",bn=({entry:t,showFeedIcon:s,mini:r,children:a})=>{const{showDetailedRelativeTime:n}=f(w),o=Re({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:o,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:jn(t.imgSrc,r)},children:e.jsx(_n,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(k.Text,{className:"article-card-title",children:t.title}),e.jsxs(k.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(ss,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Bt(t.published_at,n),e.jsx("br",{}),Ht(t.reading_time)]}),t.starred&&e.jsx(Qe,{className:"icon-starred"})]}),e.jsx("div",{children:a})]})},vn=({entry:t,handleEntryClick:s,mini:r,children:a})=>{const{markReadOnScroll:n,showFeedIcon:o}=f(w),{activeContent:l}=f(A),{polyglot:i}=f(E),u=l&&t.id===l.id,{handleToggleStarred:d,handleToggleStatus:c}=it(),[h,p]=g.useState(0),_=60,m=.5,y=t.starred,T=t.status==="unread",v=cr({preventScrollOnSwipe:!0,delta:_/2,onSwiping:S=>{const V=Math.min(Math.abs(S.deltaX*m),_)*Math.sign(S.deltaX);p(V)},onSwiped:async S=>{try{S.deltaX>_?(await d(t),j.success(y?i.t("article_card.unmarked_as_starred"):i.t("article_card.marked_as_starred"))):S.deltaX<-_&&(await c(t),j.success(T?i.t("article_card.marked_as_read"):i.t("article_card.marked_as_unread")))}catch(V){console.error("Failed to update entry: ",V),j.error(i.t("article_card.update_failed"))}p(0)}}),[R,x]=g.useState(!1),[C,O]=g.useState(!1),H=()=>c(t),X=20,{ref:ee}=Me({skip:C,onChange:async(S,V)=>{if(!(!n||!T)){if(S)x(!0);else if(R){const{top:Y}=V.boundingClientRect;Y<X&&(await H(),O(!0))}}}}),te=dr({x:h});return g.createElement("div",{...v,className:"article-card",key:t.id},e.jsxs("div",{ref:ee,children:[e.jsx(ur.div,{className:"swipe-card",style:te,children:e.jsx(Ie,{className:Re("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":u}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Ie.Meta,{description:e.jsx(bn,{entry:t,showFeedIcon:o,mini:r,children:a})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:y?e.jsx(Qe,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(Ye,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:T?e.jsx(Mt,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(Dt,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},Sn=({layout:t,isArticleListReady:s})=>e.jsx(Ie,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Ie.Meta,{description:e.jsx(ke,{loading:!s,animation:!0,text:{rows:3,width:150}})})}),wn=()=>{const{layout:t}=f(w),{isArticleListReady:s}=f(A),r=t==="large"?2:4;return!s&&Array.from({length:r},(a,n)=>e.jsx(Sn,{layout:t,isArticleListReady:s},n))},Cn=()=>{const{filterString:t,filterType:s}=f(A),{orderDirection:r}=f(w),{polyglot:a}=f(E),n=a.t("search.tooltip").split(`
`),[o,l]=g.useState(""),i=g.useCallback(za(h=>Ae(h),500),[]),u=h=>{l(h),i(h)},{isBelowMedium:d}=pe(),c=()=>{z({orderDirection:r==="desc"?"asc":"desc"})};return g.useEffect(()=>{Ne("title"),Ae("")},[]),g.useEffect(()=>{t!==o&&l(t)},[t]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(B.Search,{allowClear:!0,onChange:u,placeholder:a.t("search.placeholder"),style:{width:d?"100%":272,marginLeft:8},value:o,addBefore:e.jsxs(N,{onChange:Ne,style:{width:100},value:s,children:[e.jsx(N.Option,{value:"title",children:a.t("search.type_title")}),e.jsx(N.Option,{value:"content",children:a.t("search.type_content")}),e.jsx(N.Option,{value:"author",children:a.t("search.type_author")})]})}),e.jsxs("div",{className:"button-group",children:[e.jsx(ie,{mini:!0,content:e.jsx("div",{children:n.map((h,p)=>e.jsxs(g.Fragment,{children:[h,p<n.length-1&&e.jsx("br",{})]},`line-${p}-${h.length}`))}),children:e.jsx(I,{shape:"circle",size:"small",icon:e.jsx(Pt,{})})}),e.jsx(ie,{mini:!0,content:r==="desc"?a.t("article_list.sort_direction_desc"):a.t("article_list.sort_direction_asc"),children:e.jsx(I,{shape:"circle",size:"small",icon:r==="desc"?e.jsx(hr,{}):e.jsx(fr,{}),onClick:c})})]})]})},kn=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},In=(t,s,r)=>{g.useLayoutEffect(()=>{let a=null;return t>0&&(clearTimeout(a),a=setTimeout(()=>{r(),clearTimeout(a)},s*4)),()=>clearTimeout(a)},[t,s,r])},Tn=({duration:t,color:s})=>{const[r,a]=g.useState([]);In(r.length,t,()=>{a([])});const n=o=>{const l=o.currentTarget.getBoundingClientRect(),i=l.width>l.height?l.width:l.height,u=o.pageX-l.x-i/2,d=o.pageY-l.y-i/2,c={x:u,y:d,size:i,id:`${new Date().getTime()}-${u}-${d}`};a([...r,c])};return e.jsx("div",{className:"ripple-container",onMouseDown:n,children:r.length>0&&r.map(o=>e.jsx("span",{className:"ripple-span",style:{top:o.y,left:o.x,width:o.size,height:o.size,backgroundColor:s,animationDuration:`${t}ms`}},o.id))})},Fn=({getEntries:t})=>{const{isArticleListReady:s,loadMoreVisible:r}=f(A),{loadingMore:a,handleLoadMore:n}=ft(),{ref:o,inView:l}=Me(),i=g.useCallback(async()=>{r&&l&&s&&!a&&await n(t)},[r,l,s,a,n,t]);return g.useEffect(()=>{const u=setInterval(i,500);return()=>clearInterval(u)},[i]),s&&r&&e.jsxs("div",{className:"load-more-container",ref:o,children:[e.jsx(mr,{loading:a,style:{paddingRight:"10px"}}),"Loading more ..."]})},En=g.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},a)=>{const{layout:n,pageSize:o}=f(w),l=n==="small",{isArticleListReady:i,loadMoreVisible:u}=f(A),d=f(Ve),c=d.length-Math.ceil(o*.2)-1,{loadingMore:h,handleLoadMore:p}=ft(),{ref:_}=Me({skip:!u,onChange:async v=>{!v||!i||h||await p(t)}}),m=pr({count:d.length,getScrollElement:()=>r.current,estimateSize:g.useCallback(()=>l?120:280,[l]),overscan:5}),y=m.getVirtualItems(),T=g.useCallback(v=>v===c?kn(m.measureElement,_):m.measureElement,[c,m.measureElement,_]);return e.jsxs(e.Fragment,{children:[e.jsx(Cn,{}),e.jsxs(Ge,{className:"entry-list",ref:a,children:[e.jsx(wn,{}),i&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:m.getTotalSize(),width:"100%",position:"relative"},children:y.map(v=>e.jsx("div",{"data-index":v.index,ref:T(v.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${v.start}px)`},children:e.jsx(vn,{entry:d[v.index],handleEntryClick:s,mini:l,children:e.jsx(Tn,{color:"var(--color-text-4)",duration:1e3})})},v.key))})}),e.jsx(Fn,{getEntries:t})]})]})}),An=()=>{ge(t=>t.map(s=>({...s,status:"read"})))},Nn=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:a}=f(A),{showStatus:n}=f(w),{polyglot:o}=f(E),{fetchAppData:l}=lt(),i=async()=>{try{await r(),An(),await l(),j.success(o.t("article_list.mark_all_as_read_success"))}catch(d){console.error("Failed to mark all as read: ",d),j.error(o.t("article_list.mark_all_as_read_error"))}},u=d=>{z({showStatus:d})};return g.useEffect(()=>{Ne("title"),Ae("")},[n]),e.jsxs("div",{className:"entry-panel",children:[e.jsx(Lt,{focusLock:!0,onOk:i,title:o.t("article_list.mark_all_as_read_confirm"),children:e.jsx(I,{icon:e.jsx(At,{}),shape:"circle",style:{visibility:["starred","history"].includes(t.from)?"hidden":"visible"}})}),e.jsx(gr.Group,{onChange:u,options:[{label:o.t("article_list.filter_status_all"),value:"all"},{label:o.t("article_list.filter_status_unread"),value:"unread"}],style:{visibility:t.from==="history"?"hidden":"visible"},type:"button",value:n}),e.jsx(I,{icon:e.jsx(fe,{}),loading:!a,shape:"circle",onClick:s})]})},de=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:a,isArticleListReady:n}=f(A),{isAppDataReady:o}=f(P),{orderBy:l,orderDirection:i,showAllFeeds:u,showStatus:d}=f(w),{polyglot:c}=f(E),h=f(at),p=f(ut),{handleFetchContent:_,handleSaveToThirdPartyServices:m,handleToggleStarred:y,handleToggleStatus:T,handleEntryStatusUpdate:v}=it(),{fetchAppData:R}=lt(),{fetchArticleList:x}=dn(t,s),[C,O]=g.useState(!1),H=g.useRef(null),X=g.useRef(null),ee=g.useRef(null);g.useEffect(()=>{Sa(t.from),a&&G(null),ue(s)},[t]),g.useEffect(()=>{["starred","history"].includes(t.from)||ue(s)},[l]),g.useEffect(()=>{h.length===0||["starred","history"].includes(t.from)||ue(s)},[u]),g.useEffect(()=>{ue(s)},[i,d]);const te=async Q=>{O(!0),G({...Q,status:"read"}),setTimeout(()=>{const $e=ee.current;if($e){const mt=$e.querySelector(".simplebar-content-wrapper");mt&&mt.scroll({top:0}),$e.focus()}O(!1),Q.status==="unread"&&(v(Q,"read"),Oe([Q.id],"read").catch(()=>{j.error(c.t("content.mark_as_read_error")),G({...Q,status:"unread"}),v(Q,"unread")}))},200)},{exitDetailView:S,fetchOriginalArticle:V,navigateToNextArticle:Y,navigateToPreviousArticle:ne,openLinkExternally:ze,openPhotoSlider:Ue,saveToThirdPartyServices:ys,toggleReadStatus:_s,toggleStarStatus:js}=gs(te,H);K(p.exitDetailView,()=>S()),K(p.fetchOriginalArticle,()=>V(_)),K(p.navigateToNextArticle,()=>Y()),K(p.navigateToNextUnreadArticle,()=>Y(!0)),K(p.navigateToPreviousArticle,()=>ne()),K(p.navigateToPreviousUnreadArticle,()=>ne(!0)),K(p.openLinkExternally,()=>ze()),K(p.openPhotoSlider,()=>Ue()),K(p.saveToThirdPartyServices,()=>ys(m)),K(p.toggleReadStatus,()=>_s(()=>T(a))),K(p.toggleStarStatus,()=>js(()=>y(a)));const ue=async Q=>{Le(0),o?await x(Q):await R()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(Be,{in:n,timeout:200,nodeRef:X,classNames:"fade",children:e.jsx(En,{cardsRef:X,getEntries:s,handleEntryClick:te,ref:H})}),e.jsx(Nn,{info:t,refreshArticleList:()=>ue(s),markAllAsRead:r})]}),a?e.jsxs("div",{className:"article-container",children:[e.jsx(Be,{in:!C,timeout:200,nodeRef:ee,classNames:"fade",unmountOnExit:!0,children:e.jsx(xn,{ref:ee})}),e.jsx(Be,{in:!C,timeout:200,unmountOnExit:!0,children:e.jsx(pn,{handleEntryClick:te,entryListRef:H})})]}):e.jsxs("div",{className:"content-empty",children:[e.jsx(xr,{style:{fontSize:"64px"}}),e.jsx(k.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]})]})},Ln=()=>e.jsx(de,{info:{from:"all",id:""},getEntries:ea,markAllAsRead:ha}),Pn=()=>{const{id:t}=Ot(),s=D("orderBy"),r=D("pageSize"),a=D("showAllFeeds"),n=async(o=0,l=null)=>{const i={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:o,limit:r,status:l},u={globally_visible:!a};return b.get(ce(i,u))};return e.jsx(de,{info:{from:"category",id:t},getEntries:n,markAllAsRead:()=>Kr(t)})},Rn=()=>{const t=ae(),s=yr();return console.error(s),g.useEffect(()=>{ht()},[]),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(_r,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(I,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},Mn=()=>{const{id:t}=Ot(),s=D("orderBy"),r=D("pageSize"),a=async(n=0,o=null)=>{const l={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:n,limit:r,status:o};return b.get(ce(l))};return e.jsx(de,{info:{from:"feed",id:t},getEntries:a,markAllAsRead:()=>la(t)})},Dn=()=>e.jsx(de,{info:{from:"history",id:""},getEntries:ta}),On=t=>{const s=t.getFieldsValue();let r=!0;for(const[a,n]of Object.entries(s))if(a!=="password"){const o=n==null?void 0:n.trim();t.setFieldValue(a,o),o||(r=!1)}else n||(r=!1);return r},ve=(t,s)=>{t.key==="Enter"&&s.submit()},Vn=()=>{zt(),us();const t=f(De),{homePage:s}=f(w),{polyglot:r}=f(E),[a]=jr(),[n,o]=g.useState(!1),[l,i]=g.useState("token"),u=ae(),d=async()=>{o(!0);const{server:h,token:p,username:_,password:m}=a.getFieldsValue();try{(await Ft.raw("v1/me",{baseURL:h,headers:p?{"X-Auth-Token":p}:{Authorization:`Basic ${btoa(`${_}:${m}`)}`}})).status===200&&(j.success(r.t("login.success")),$t({server:h,token:p,username:_,password:m}),u("/"))}catch(y){console.error(y),j.error(y.message)}o(!1)},c=async()=>{const h=a.getFieldsValue();if(!Te(h)){j.error(r.t("login.auth_error"));return}await d()};return g.useEffect(()=>{ht()},[]),Te(t)?e.jsx(Ze,{to:`/${s}`}):r&&e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(k.Title,{heading:3,children:r.t("login.login_to_your_server")}),e.jsxs(L,{autoComplete:"off",form:a,layout:"vertical",onSubmit:async()=>{On(a)?await c():j.error(r.t("login.submit_error"))},children:[e.jsx(L.Item,{field:"server",label:r.t("login.server_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,a)},children:e.jsx(B,{disabled:n,placeholder:r.t("login.server_placeholder"),prefix:e.jsx(br,{})})}),l==="token"&&e.jsx(L.Item,{field:"token",label:r.t("login.token_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,a)},children:e.jsx(B.Password,{disabled:n,placeholder:r.t("login.token_placeholder"),prefix:e.jsx(_t,{})})}),l==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(L.Item,{field:"username",label:r.t("login.username_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,a)},children:e.jsx(B,{disabled:n,placeholder:r.t("login.username_placeholder"),prefix:e.jsx(Nt,{})})}),e.jsx(L.Item,{field:"password",label:r.t("login.password_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,a)},children:e.jsx(B.Password,{disabled:n,placeholder:r.t("login.password_placeholder"),prefix:e.jsx(_t,{})})})]})]}),e.jsx(I,{loading:n,type:"primary",long:!0,onClick:()=>a.submit(),style:{marginTop:"20px"},children:r.t("login.login_button")}),e.jsx($,{orientation:"center",children:r.t("login.another_login_method")}),e.jsx(I,{type:"secondary",long:!0,onClick:()=>i(l==="token"?"user":"token"),style:{marginTop:"20px"},children:l==="token"?r.t("login.another_login_button"):r.t("login.token_label")}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(k.Text,{disabled:!0,children:r.t("login.need_help")}),e.jsx(vr,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:r.t("login.miniflux_official_website")})]})]})}),e.jsx("div",{className:"background"})]})},zn=({children:t})=>{const s=f(De);return Te(s)?e.jsx(e.Fragment,{children:t}):e.jsx(Ze,{to:"/login"})},Un=()=>e.jsx(de,{info:{from:"starred",id:""},getEntries:qt}),$n=()=>{const t=async()=>{const s=await Se(0,"unread"),r=s.total;let a=s.entries;r>a.length&&(a=Se(0,"unread",r).then(o=>o.entries));const n=a.map(o=>o.id);return Oe(n,"read")};return e.jsx(de,{info:{from:"today",id:""},getEntries:Se,markAllAsRead:t})},Bn=D("homePage"),Hn=[{path:"/all",element:e.jsx(Ln,{})},{path:"/today",element:e.jsx($n,{})},{path:"/starred",element:e.jsx(Un,{})},{path:"/history",element:e.jsx(Dn,{})},{path:"/category/:id",element:e.jsx(Pn,{})},{path:"/feed/:id",element:e.jsx(Mn,{})}],xs=Sr([{path:"/",element:e.jsx(zn,{children:e.jsx(ln,{})}),errorElement:e.jsx(Rn,{}),children:[...Hn,{index:!0,element:e.jsx(Ze,{to:`/${Bn}`,replace:!0})}]},{path:"/login",element:e.jsx(Vn,{})}]),qn={"zh-CN":Tr,"es-ES":Fr},Kn=()=>qn[Lr()]||Ir;wr.createRoot(document.getElementById("root")).render(e.jsx(Cr,{locale:Kn(),children:e.jsx(kr,{router:xs})}));

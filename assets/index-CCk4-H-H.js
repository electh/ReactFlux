import{m as Re,u as x,r as p,p as jt,i as rs,o as bt,d as q,a as ns,b as as,c as is,e as z,M as w,C as os,j as e,f as Q,g as qe,h as te,A as wt,I as ls,T as y,S as ve,k as it,l as cs,n as ds,q as We,s as us,t as hs,v as Le,B as L,w as ms,D as fs,x as Ce,y as de,z as St,E as ps,F as gs,G as xs,H as ot,J as vt,K as ys,L as ke,N as js,O as Ct,P as Z,Q as bs,R as ws,U as Ss,V as vs,W as Cs,X as H,Y as J,Z as lt,_ as D,$ as ue,a0 as _,a1 as kt,a2 as ct,a3 as Ft,a4 as R,a5 as Tt,a6 as ks,a7 as Fs,a8 as ae,a9 as Ts,aa as Is,ab as Es,ac as Ns,ad as As,ae as Ms,af as Rs,ag as Ls,ah as It,ai as Et,aj as Ke,ak as Ps,al as Ds,am as Us,an as Os,ao as $s,ap as Vs,aq as _s,ar as zs,as as Pe,at as Bs,au as Hs,av as qs,aw as Fe,ax as Ws,ay as Ks,az as Gs,aA as Ys,aB as Xs,aC as dt,aD as Nt,aE as Js,aF as Qs,aG as Zs,aH as er,aI as ut,aJ as tr,aK as At,aL as sr,aM as rr,aN as nr,aO as ar,aP as ir}from"./vendor-Bj8ABivq.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();const N=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},Ge=Re({addFeedModalVisible:!1,settingsModalVisible:!1}),or=N(Ge,"addFeedModalVisible"),lr=N(Ge,"settingsModalVisible"),Ye=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=x(Ge);return{addFeedModalVisible:t,setAddFeedModalVisible:or,settingsModalVisible:s,setSettingsModalVisible:lr}},he=()=>{const[t,s]=p.useState(window.innerWidth),r=t<=768,n=t<=992;return p.useEffect(()=>{const a=()=>s(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},Mt={server:"",token:"",username:"",password:""},Xe=jt("auth",Mt,{encode:JSON.stringify,decode:JSON.parse}),Rt=t=>Xe.set(t),cr=()=>Rt(Mt),dr=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},Je=t=>{const{server:s,token:r,username:n,password:a}=t;return!s||!rs(s,{require_protocol:!0})&&!dr(s)?!1:r||n&&a},ur=()=>bt.create({retry:3,onRequest({_request:t,options:s}){const r=Xe.get();if(!Je(r))throw new Error("Invalid auth");const{server:n,token:a,username:o,password:i}=r;s.baseURL=n,s.headers=a?{"X-Auth-Token":a}:{Authorization:`Basic ${btoa(`${o}:${i}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var o;s.status===401&&(localStorage.removeItem("auth"),await ss.navigate("/login"));const a=((o=s._data)==null?void 0:o.error_message)??s.statusText;throw console.error("Response error: ",a),new Error(a)}}),F=ur();F.get=t=>F(t,{method:"GET"});F.post=(t,s)=>F(t,{method:"POST",body:s});F.put=(t,s)=>F(t,{method:"PUT",body:s});const hr=async()=>F.get("/v1/categories"),mr=async t=>F.post("/v1/categories",{title:t}),fr=async t=>F.raw(`/v1/categories/${t}`,{method:"DELETE"}),pr=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return F.put(`/v1/categories/${t}`,n)},gr=async t=>F.put(`/v1/categories/${t}/mark-all-as-read`),Lt={articleWidth:90,fontSize:1.05,homePage:"all",layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},U=jt("settings",Lt,{encode:JSON.stringify,decode:JSON.parse}),Y=t=>U.get()[t],K=t=>U.set({...U.get(),...t}),xr=()=>U.set(Lt);q.extend(ns);q.extend(as);q.extend(is);const yr=t=>q(t).isAfter(q().subtract(24,"hour")),jr=()=>q().subtract(24,"hour").unix(),Pt=(t,s)=>{if(!s){const f=q(t).fromNow();return f==="a few seconds ago"?"just now":f}const r=q(),a=q(t).diff(r),o=q.duration(Math.abs(a)),i=o.years(),c=o.months(),l=o.days(),d=o.hours(),h=o.minutes(),m=[];if(i>0&&m.push(`${i} year${i>1?"s":""}`),c>0&&m.push(`${c} month${c>1?"s":""}`),l>0&&m.push(`${l} day${l>1?"s":""}`),d>0&&m.push(`${d} hour${d>1?"s":""}`),h>0&&m.push(`${h} minute${h>1?"s":""}`),m.length===0)return"just now";const b=m.join(" ");return a>0?`in ${b}`:`${b} ago`},br=()=>q().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),De=async(t,s)=>F.put("/v1/entries",{entry_ids:t,status:s}),wr=async t=>F.put(`/v1/entries/${t}/bookmark`),Sr=async t=>F.get(`/v1/entries/${t}/fetch-content`),oe=(t,s={})=>{const{baseUrl:r,orderField:n,offset:a,limit:o,status:i}=t,c=Y("orderDirection"),l=new URLSearchParams({order:n,direction:c,offset:a,limit:o,...s});return i&&l.append("status",i),`${r}?${l}`},vr=async(t=0,s=null)=>{const r=Y("orderBy"),n=Y("pageSize"),a={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s};return F.get(oe(a))},be=async(t=0,s=null,r=null)=>{const n=Y("orderBy"),a=r??Y("pageSize"),o=jr(),i={baseUrl:"/v1/entries",orderField:n,offset:t,limit:a,status:s},c={published_after:o};return F.get(oe(i,c))},Dt=async(t=0,s=null)=>{const r=Y("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},a={starred:"true"};return F.get(oe(n,a))},Ut=async(t=0)=>{const s=Y("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return F.get(oe(r))},Cr=async()=>F.get("/v1/feeds"),kr=async()=>F.get("/v1/feeds/counters"),Fr=async t=>F.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),Tr=async()=>F.raw("/v1/feeds/refresh",{method:"PUT"}),Ir=async(t,s,r)=>F.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),Er=async t=>F.raw(`/v1/feeds/${t}`,{method:"DELETE"}),ht=async(t,s)=>{const{categoryId:r,title:n,siteUrl:a,feedUrl:o,hidden:i,disabled:c,isFullText:l}=s;return F.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:a,feed_url:o,hide_globally:i,disabled:c,crawler:l})},Nr=async t=>F.put(`/v1/feeds/${t}/mark-all-as-read`),Ar=async()=>F.get("/v1/me"),Mr=async()=>{const t=await Ar();return F.put(`/v1/users/${t.data.id}/mark-all-as-read`)},B=Re({isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[]}),Qe=z(B,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(a=>({...a,unreadCount:s[a.id]??0})).sort((a,o)=>a.title.localeCompare(o.title,"en"))}),me=z([B,Qe],(t,s)=>{const{categoriesData:r}=t;return r.map(a=>{const o=s.filter(i=>i.category.id===a.id);return{...a,unreadCount:o.reduce((i,c)=>i+(c.unreadCount??0),0),feedCount:o.length}}).sort((a,o)=>a.title.localeCompare(o.title,"en"))}),Ot=z(me,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),$t=z([Qe,Ot],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Vt=z([Qe,$t,U],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),_t=z(Vt,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),Rr=z([B,Vt],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[a,o])=>s.some(i=>i.id===Number(a))?n+o:n,0)}),we=N(B,"categoriesData"),ee=N(B,"feedsData"),Oe=N(B,"historyCount"),$e=N(B,"isAppDataReady"),Ve=N(B,"starredCount"),zt=N(B,"unreadInfo"),Bt=N(B,"unreadTodayCount"),Ze=async()=>{$e(!1);const t=await Promise.all([kr(),be(0,"unread"),Dt(),Ut(),Cr(),hr()]),[s,r,n,a,o,i]=t,c=o.reduce((l,d)=>(l[d.id]=s.unreads[d.id]??0,l),{});zt(c),Bt(r.total??0),Ve(n.total??0),Oe(a.total??0),ee(o),we(i),$e(!0)},Te=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(o=>o.id===n.id)||n)},_e=(t,s)=>{const r={};let n=0;const a=t.filter(l=>l.status!==s);if(a.length===0)return;s==="read"?(Ae(l=>Math.max(0,l-a.length)),Me(l=>Math.max(0,l-a.length)),Oe(l=>l+a.length)):(Ae(l=>l+a.length),Me(l=>l+a.length),Oe(l=>Math.max(0,l-a.length)));for(const l of a){const d=l.feed.id,h=yr(l.published_at),m=s==="read"?-1:1;r[d]=(r[d]??0)+m,n+=h?m:0}Bt(l=>Math.max(0,l+n)),zt(l=>{const d={...l};for(const[h,m]of Object.entries(r))d[h]=Math.max(0,(d[h]??0)+m);return d});const o=a.map(l=>({...l,status:s})),{activeContent:i}=T.get(),c=o.find(l=>l.id===(i==null?void 0:i.id));c&&G(c),fe(l=>Te(l,o)),pe(l=>Te(l,o))},et=()=>{const{activeContent:t}=x(T),s=(i,c)=>{_e([i],c)},r=(i,c)=>{c?(Ve(d=>d+1),os({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Ve(d=>Math.max(0,d-1));const l={...i,starred:c};t&&G(l),fe(d=>Te(d,[l])),pe(d=>Te(d,[l]))};return{handleEntryStatusUpdate:s,handleFetchContent:async()=>{try{const i=await Sr(t.id);w.success("Fetched content successfully"),G({...t,content:i.content})}catch{w.error("Failed to fetch content, please try again later")}},handleToggleStarred:async i=>{const c=!i.starred;r(i,c),wr(i.id).catch(()=>{w.error(`Failed to ${c?"star":"unstar"} entry, please try again later`),r(i,!c)})},handleToggleStatus:async i=>{const c=i.status,l=c==="read"?"unread":"read";s(i,l),De([i.id],l).catch(()=>{w.error(`Failed to mark entry as ${l}, please try again later`),s(i,c)})}}},Lr=(t,s)=>{if(t.length===0||s==="none")return t;const r=t.map((d,h)=>({id:d.id,index:h})),n=new Map,a=new Map,o=new Map,i=[],c=t.slice().sort((d,h)=>d.id-h.id).filter(d=>{const{hash:h,title:m,url:b,id:f}=d;switch(s){case"hash":if(n.has(h))return i.push(d),!1;n.set(h,f);break;case"title":if(a.has(m))return i.push(d),!1;a.set(m,f);break;case"url":if(o.has(b))return i.push(d),!1;o.set(b,f);break;default:return!0}return!0}),l=i.filter(d=>d.status==="unread").map(d=>d.id);return l.length>0&&(_e(i,"read"),De(l,"read").catch(()=>{w.error("Failed to mark duplicate entries as read"),_e(i,"unread")})),c.sort((d,h)=>{const m=r.find(f=>f.id===d.id).index,b=r.find(f=>f.id===h.id).index;return m-b})},Pr=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},xe=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,a=r?s.toLowerCase():s;if(a.length===0)return 0;const o=Pr(a);let i=0,c=0;for(;i<n.length;)if(n[i]===a[c]?(i++,c++):c!==0?c=o[c-1]:i++,c===a.length)return i-c;return-1},Dr=t=>{const s=[],r=[];let n=[];const a=[],o=t.match(/([-+|]?)\s*"([^"]+)"/g);let i=t;o&&(n=o.map(l=>{const d=l.trim()[0],h=l.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(h);break;case"+":s.push(h);break;case"|":a.push([h]);break;default:s.push(h);break}return h}),i=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const c=i.split(/\s+/);for(const l of c){const d=l.replace(/^-|\+|\|$/,"");if(l.startsWith("-")&&d)r.push(d);else if(l.startsWith("+")&&d)s.push(d);else if(l.includes("|")){const h=l.split("|").filter(m=>m);h.length>0&&a.push(h)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:a}},Ur=(t,s,r=[],n=!0)=>{const{includeTerms:a,excludeTerms:o,exactPhrases:i,orConditions:c}=Dr(s);return t.filter(l=>r.some(d=>{const h=l[d];if(typeof h!="string")return!1;const m=n?h.toLowerCase():h;if(o.some(S=>xe(m,S,n)!==-1)||i.length>0&&!i.some(S=>xe(m,S,n)!==-1))return!1;const b=a.every(S=>xe(m,S,n)!==-1),f=c.length===0||c.some(S=>S.some(C=>xe(m,C,n)!==-1));return b&&f}))},Or=(t,s,r=[],n=!0)=>{try{if(!Array.isArray(t)||t.length===0)throw new Error("Invalid data input");if(typeof s!="string"||s.trim().length===0)throw new Error("Invalid query input");return Ur(t,s,r,n)}catch(a){return console.error(a.message),[]}},Se=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),$r=(t,s,r)=>r?Or(t,r,[s]):t,T=Re({activeContent:null,entries:[],filterStatus:Y("showStatus"),filterString:"",filterType:"Title",infoFrom:Y("homePage"),isArticleFocused:!1,loading:!0,offset:0,total:0,unreadCount:0,unreadEntries:[],unreadOffset:0}),tt=z(T,t=>{const{unreadEntries:s,unreadCount:r}=t;return s.length<r}),st=z(T,t=>{const{entries:s,total:r}=t;return s.length<r}),Vr=z(T,t=>{const{entries:s,filterStatus:r,unreadEntries:n}=t;return r==="all"?s:n}),rt=z([T,Vr,$t,U],(t,s,r,n)=>{const{filterString:a,filterType:o,infoFrom:i}=t,c=$r(s,o,a),{removeDuplicates:l,showAllFeeds:d}=n,h=!["starred","history"].includes(i),m=f=>d||!r.includes(f.feed.id),b=h?c.filter(m):c;return l==="none"||["starred","history"].includes(i)?b:Lr(b,l)}),G=N(T,"activeContent"),fe=N(T,"entries"),Ie=N(T,"filterStatus"),Ee=N(T,"filterString"),Ne=N(T,"filterType"),_r=N(T,"infoFrom"),ie=N(T,"isArticleFocused"),mt=N(T,"loading"),Ht=N(T,"offset"),zr=N(T,"total"),Ae=N(T,"unreadCount"),pe=N(T,"unreadEntries"),Me=N(T,"unreadOffset"),Br=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},ft=t=>{const s=Br(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},qt=({feed:t,className:s="feed-icon"})=>{const n=`https://icons.duckduckgo.com/ip3/${ft(t.site_url)??ft(t.feed_url)}.ico`;return e.jsx("img",{className:s,src:n,alt:"Feed icon"})},Wt=Q.Item,Hr=({category:t,path:s})=>{var i;const n=(i=x(_t)[t.id])==null?void 0:i.reduce((c,l)=>c+l.unreadCount,0),a=te(),o=()=>{a(`/category/${t.id}`),G(null)};return e.jsxs("div",{className:Le("category-title",{"active-subMenu":s===`/category/${t.id}`,"inactive-subMenu":s!==`/category/${t.id}`}),onClick:o,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&o()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(y.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},qr=({count:t})=>e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),ye=({path:t,Icon:s,label:r,count:n})=>{const a=qe(),o=te(),i=a.pathname===t,c=()=>{o(t),G(null)};return e.jsx(Wt,{onClick:c,className:Le("arco-menu-item",{"arco-menu-selected":i}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(qr,{count:n})]})},t)},Kt=()=>{const{homePage:t,showAllFeeds:s,showFeedIcon:r}=x(U),{historyCount:n,isAppDataReady:a,starredCount:o,unreadTodayCount:i}=x(B),c=x(me),l=x(_t),d=x(Ot),h=x(Rr),m=qe(),b=te(),[f,S]=p.useState([`/${t}`]),C=m.pathname;p.useEffect(()=>{S([C])},[C]);const P=()=>e.jsxs(e.Fragment,{children:[e.jsx(ye,{path:"/all",Icon:cs,label:"All",count:h}),e.jsx(ye,{path:"/today",Icon:ds,label:"Today",count:i}),e.jsx(ye,{path:"/starred",Icon:We,label:"Starred",count:o}),e.jsx(ye,{path:"/history",Icon:us,label:"History",count:n})]}),E=M=>{var W;return(W=l[M])==null?void 0:W.map(O=>e.jsx(Wt,{style:{position:"relative",overflow:"hidden"},onClick:u=>{u.stopPropagation(),b(`/feed/${O.id}`),G(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:O.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[r&&e.jsx(qt,{feed:O,className:"feed-icon-sidebar"}),O.title]}),O.unreadCount!==0&&e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:O.unreadCount})]})},`/feed/${O.id}`))},j=()=>c.filter(M=>s||!d.includes(M.id)).map(M=>e.jsx(it.Item,{name:`/category/${M.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(Hr,{category:M,path:C}),expandIcon:e.jsx(hs,{}),children:E(M.id)},M.id));return e.jsxs(Q,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:f,style:{width:"240px",height:"100%"},children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(wt,{className:"avatar",size:32,children:e.jsx(ls,{style:{color:"var(--color-bg-1)"}})}),e.jsx(y.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:"Articles"}),e.jsx(ve,{loading:!a,animation:!0,text:{rows:3}}),a&&P(),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:"Feeds"}),e.jsx(ve,{loading:!a,animation:!0,text:{rows:6}}),a&&e.jsx(it,{triggerRegion:"icon",bordered:!1,children:j()})]})},Wr=()=>{const{showAllFeeds:t,theme:s}=x(U),r=te(),n=qe().pathname,{setAddFeedModalVisible:a,setSettingsModalVisible:o}=Ye(),{isBelowLarge:i}=he(),[c,l]=p.useState(!1),[d,h]=p.useState(!1),[m,b]=p.useState(!1);p.useEffect(()=>{i||l(!1)},[i]),p.useEffect(()=>{n&&l(!1)},[n]);const f=()=>{K({showAllFeeds:!t})},S=()=>{K({theme:s==="light"?"dark":"light"})},C=()=>{xr(),h(!1)},P=()=>{cr(),$e(!1),r("/login"),w.success("Successfully logged out")},E=()=>s==="dark"?e.jsx(bs,{}):s==="system"?e.jsx(ws,{}):e.jsx(Ss,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(L,{className:"trigger",onClick:()=>l(!c),shape:"circle",size:"small",children:e.jsx(ms,{})})}),e.jsx(fs,{className:"sidebar-drawer",visible:c,title:null,footer:null,closable:!1,onCancel:()=>l(!1),placement:"left",width:240,children:e.jsx(Kt,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(Ce,{size:16,children:[e.jsx(de,{content:"Add a feed",mini:!0,children:e.jsx(L,{shape:"circle",size:"small",type:"primary",icon:e.jsx(St,{}),onClick:()=>a(!0)})}),e.jsx(de,{content:t?"Hide some feeds":"Show all feeds",mini:!0,children:e.jsx(L,{shape:"circle",size:"small",icon:t?e.jsx(ps,{}):e.jsx(gs,{}),onClick:f})}),e.jsx(L,{shape:"circle",size:"small",icon:e.jsx(xs,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(ot,{droplist:e.jsx(Q,{defaultSelectedKeys:[s],className:"theme-menu",children:["light","dark","system"].map(j=>e.jsxs(Q.Item,{className:"theme-menu-item",onClick:()=>K({theme:j}),children:[j.charAt(0).toUpperCase()+j.slice(1),s===j&&e.jsx(vt,{style:{marginLeft:8}})]},j))}),trigger:"hover",position:"bottom",children:e.jsx(L,{icon:E(),shape:"circle",size:"small",onClick:S})}),e.jsx(ot,{droplist:e.jsxs(Q,{children:[e.jsxs(Q.Item,{onClick:()=>o(!0),children:[e.jsx(ys,{className:"icon-right"}),"Settings"]},"0"),e.jsxs(Q.Item,{onClick:()=>h(!0),children:[e.jsx(ke,{className:"icon-right"}),"Reset Settings"]},"1"),e.jsxs(Q.Item,{onClick:()=>b(!0),children:[e.jsx(js,{className:"icon-right"}),"Logout"]},"2")]}),trigger:"click",position:"br",children:e.jsx(wt,{size:28,style:{cursor:"pointer"},children:e.jsx(Ct,{})})})]})}),e.jsx(Z,{title:"Confirm Reset",visible:d,onOk:C,onCancel:()=>h(!1),children:e.jsx("p",{children:"Are you sure you want to reset your settings? This action cannot be undone."})}),e.jsx(Z,{title:"Confirm Logout",visible:m,onOk:P,onCancel:()=>b(!1),children:e.jsx("p",{children:"Are you sure you want to logout?"})})]})},ze={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Green:{light:"#00B42A",dark:"#27C346"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Magenta:{light:"#F5319D",dark:"#F756A9"}},Be=t=>{const s=ze[t]||ze.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=Y("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},Gt=t=>{vs(Be(t),{list:!0}).map(Cs).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},Kr=()=>{const{articleWidth:t,fontSize:s,layout:r,showDetailedRelativeTime:n,showFeedIcon:a,themeColor:o}=x(U),i=c=>{K(c),c.themeColor&&Gt(c.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Accent color"}),e.jsx(y.Text,{type:"secondary",children:"Choose your accent color"})]}),e.jsx("div",{style:{display:"flex"},children:Object.keys(ze).map(c=>e.jsx(de,{content:c,children:e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:Be(c),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:c===o?`1px solid ${Be(c)}`:"none"},onClick:()=>i({themeColor:c}),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&i({themeColor:c})},"aria-label":`Change theme color to ${c}`})},c))})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Compact article list"}),e.jsx(y.Text,{type:"secondary",children:"Use small thumbnail in article list"})]}),e.jsx("div",{children:e.jsx(J,{checked:r==="small",onChange:c=>i({layout:c?"small":"large"})})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Show detailed relative time"}),e.jsx(y.Text,{type:"secondary",children:"Show detailed relative time in article list"})]}),e.jsx("div",{children:e.jsx(J,{checked:n,onChange:c=>i({showDetailedRelativeTime:c})})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Show feed icon"}),e.jsx(y.Text,{type:"secondary",children:"Show feed icon in feed list and article list"})]}),e.jsx("div",{children:e.jsx(J,{checked:a,onChange:c=>i({showFeedIcon:c})})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Font size"}),e.jsx(y.Text,{type:"secondary",children:"Adjust article text size"})]}),e.jsx("div",{children:e.jsxs(Ce,{children:[e.jsx(y.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(lt,{formatTooltip:c=>`${c}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:c=>i({fontSize:c})}),e.jsx(y.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Article width"}),e.jsx(y.Text,{type:"secondary",children:"Adjust article width"})]}),e.jsx("div",{children:e.jsxs(Ce,{children:[e.jsx(y.Text,{children:"60%"}),e.jsx(lt,{formatTooltip:c=>`${c}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:c=>i({articleWidth:c})}),e.jsx(y.Text,{children:"90%"})]})})]})]})},Gr=()=>{const t=x(me),[s]=D.useForm(),[r,n]=p.useState(!1),[a,o]=p.useState(""),[i,c]=p.useState({}),[l,d]=p.useState(!1),h=async()=>{if(a.trim()){try{const f=await mr(a);we(S=>[...S,{...f}]),w.success("Category added successfully")}catch(f){console.error("Failed to add category: ",f),w.error("Failed to add category")}o(""),d(!1)}},m=async(f,S,C)=>{try{const P=await pr(f,S,C);ee(E=>E.map(j=>j.category.id===f?{...j,category:{...j.category,title:S,hide_globally:C}}:j)),we(E=>E.map(j=>j.id===f?{...j,...P}:j)),w.success("Category updated successfully")}catch{w.error("Failed to update category")}n(!1),s.resetFields()},b=async f=>{try{(await fr(f.id)).status===204?(we(C=>C.filter(P=>P.id!==f.id)),w.success(`Deleted category: ${f.title}`)):w.error(`Failed to delete category: ${f.title}`)}catch(S){console.error(`Failed to delete category: ${f.title}`,S),w.error(`Failed to delete category: ${f.title}`)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(f=>e.jsx(ue,{className:"tag-style",closable:f.feedCount===0,size:"medium",onClick:()=>{c(f),n(!0),s.setFieldsValue({title:f.title})},onClose:async S=>{S.stopPropagation(),await b(f)},children:f.title},f.id)),l?e.jsx(_,{autoFocus:!0,className:"input-style",onBlur:h,onChange:o,onPressEnter:h,size:"small",value:a}):e.jsx(ue,{className:"add-category-tag",icon:e.jsx(St,{}),onClick:()=>d(!0),size:"medium",tabIndex:0,children:"Add"})]}),i&&e.jsx(Z,{className:"modal-style",onOk:s.submit,title:"Edit Category",unmountOnExit:!0,visible:r,onCancel:()=>{n(!1),s.resetFields()},children:e.jsxs(D,{form:s,layout:"vertical",onSubmit:f=>m(i.id,f.title,f.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(D.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(_,{placeholder:"Please input category title"})}),e.jsx(D.Item,{label:"Hidden",field:"hidden",initialValue:i.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(J,{})})]})})]})},Yr=t=>new Promise(s=>setTimeout(s,t)),{Paragraph:Xr}=y,Yt=kt(""),pt=N(Yt),Xt=z([B,Yt],(t,s)=>{const{feedsData:r}=t;return[...r].sort((n,a)=>n.disabled&&!a.disabled?1:!n.disabled&&a.disabled?-1:0).sort((n,a)=>a.parsing_error_count-n.parsing_error_count).filter(n=>Se(n.title,s)||Se(n.site_url,s)||Se(n.feed_url,s))}),Jr=z(Xt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),gt=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:br()}:t,Qr=()=>{const t=x(me),{showDetailedRelativeTime:s}=x(U),r=x(Xt),n=x(Jr),[a,o]=p.useState(!1),[i]=D.useForm(),[c,l]=p.useState(!1),[d,h]=p.useState(""),[m,b]=p.useState(null),{isBelowMedium:f}=he();p.useEffect(()=>{pt("")},[]);const S=u=>{b(u),l(!0),i.setFieldsValue({category:u.category.id,title:u.title,siteUrl:u.site_url,feedUrl:u.feed_url,hidden:u.hidden,disabled:u.disabled,crawler:u.crawler})},C=async(u,g,v=!0)=>{try{const I=(await u()).status===204;return v&&(I?w.success("Refreshed"):w.error("Failed to refresh")),ee($=>$.map(se=>g(se,I))),I}catch{return v&&w.error("Failed to refresh"),ee(I=>I.map($=>g($,!1))),!1}},P=async(u,g=!0)=>{const v=u.id||u.key;return C(()=>Fr(v),(k,I)=>gt(k,I,v),g)},E=async()=>{try{const u=await Promise.all(r.map(async g=>{const v=new URL(g.feed_url).hostname,k=g.feed_url.replace(v,d),I=await ht(g.id,{feedUrl:k});return{...g,...I}}));ee(g=>g.map(v=>u.find(k=>k.id===v.id)||v)),w.success("Bulk update successfully"),o(!1)}catch{w.error("Failed to bulk update, please try again")}},j=()=>{const[u,g]=p.useState(!1),v=async()=>{g(!1),await C(Tr,gt)},k=async()=>{g(!1);const $=r.filter(re=>re.parsing_error_count>0);w.success("Starting refresh of error feeds, please wait");const se=await Promise.all($.map(async re=>{const ce=await P(re,!1);return await Yr(500),ce})),ge=se.filter(Boolean).length,Ue=se.length-ge;w.success(`Feeds refreshed. Success: ${ge}, Failure: ${Ue}`)},I=()=>g(!1);return e.jsxs(e.Fragment,{children:[e.jsx(L,{icon:e.jsx(ke,{}),shape:"circle",onClick:()=>g(!0)}),e.jsx(Z,{className:"edit-modal",onCancel:I,title:"Refresh Feeds",visible:u,footer:[e.jsx(L,{onClick:I,children:"Cancel"},"cancel"),e.jsx(L,{type:"outline",onClick:k,children:"Error Feeds"},"error"),e.jsx(L,{type:"primary",onClick:v,children:"All Feeds"},"all")],children:e.jsx("p",{children:"Do you want to refresh all feeds or just the ones with errors?"})})]})},M=async u=>{try{(await Er(u.key)).status===204?(ee(v=>v.filter(k=>k.id!==u.key)),w.success(`Unfollowed feed: ${u.title}`)):w.error(`Failed to unfollow feed: ${u.title}`)}catch(g){console.error(`Failed to unfollow feed: ${u.title}`,g),w.error(`Failed to unfollow feed: ${u.title}`)}},W=[{title:"Title",dataIndex:"title",sorter:(u,g)=>u.title.localeCompare(g.title,"en"),render:(u,g)=>{const v=g.parsing_error_count;let k=g.disabled?`ðŸš« ${u}`:u;v>0&&(k=`âš ï¸ ${u}`);const I=e.jsxs("div",{children:[u,v>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"âš ï¸ Parsing error count: ",v]})]});return e.jsx(y.Ellipsis,{expandable:!1,children:e.jsx(de,{mini:!0,content:I,children:k})})}},!f&&{title:"Feed URL",dataIndex:"feed_url",sorter:(u,g)=>u.feed_url.localeCompare(g.feed_url,"en"),render:u=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:u})},{title:"Category",dataIndex:"category.title",sorter:(u,g)=>u.category.title.localeCompare(g.category.title,"en"),render:u=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(ue,{children:u})})},!f&&{title:"Checked at",dataIndex:"checked_at",sorter:(u,g)=>u.checked_at.localeCompare(g.checked_at,"en"),render:u=>e.jsx(y.Ellipsis,{expandable:!1,children:Pt(u,s)})},{title:"Actions",dataIndex:"op",fixed:"right",width:100,render:(u,g)=>e.jsxs(Ce,{children:[e.jsx("button",{"aria-label":"Edit this feed",className:"list-item-action",onClick:()=>S(g),type:"button",children:e.jsx(ct,{})}),e.jsx("button",{"aria-label":"Refresh this feed",className:"list-item-action",onClick:()=>P(g),type:"button",children:e.jsx(ke,{})}),e.jsx(Tt,{focusLock:!0,position:"left",title:"Unfollowï¼Ÿ",onOk:()=>M(g),children:e.jsx("span",{className:"list-item-action",children:e.jsx(ks,{})})})]})}].filter(Boolean),O=async(u,g)=>{try{const v=await ht(u,g);ee(k=>k.map(I=>I.id===u?{...I,...v}:I)),w.success("Feed updated successfully"),l(!1),i.resetFields()}catch{w.error("Failed to update feed")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{alignItems:"center",display:"flex",width:"100%"},children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(_.Search,{className:"search-input",placeholder:"Search title or site URL or feed URL",searchButton:!0,onChange:pt})}),e.jsxs("div",{style:{display:"flex",gap:16,paddingBottom:16,paddingLeft:16},children:[e.jsx(L,{icon:e.jsx(ct,{}),shape:"circle",onClick:()=>o(!0)}),e.jsxs(Z,{className:"edit-modal",onOk:E,title:"Bulk Update Hosts",visible:a,onCancel:()=>{o(!1),h("")},children:[e.jsxs(Xr,{children:["This will bulk update filtered feeds' hosts.",e.jsx("br",{}),"Only recommended for RssHub."]}),e.jsx(_,{placeholder:"rsshub.app",value:d,onChange:u=>h(u)})]}),e.jsx(j,{})]})]}),e.jsx(Ft,{borderCell:!0,className:"feed-table",columns:W,data:n,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),m&&e.jsx(Z,{className:"edit-modal",onOk:i.submit,title:"Edit Feed",unmountOnExit:!0,visible:c,onCancel:()=>{l(!1),i.resetFields()},children:e.jsxs(D,{form:i,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async u=>{const g={categoryId:u.category,title:u.title,siteUrl:u.siteUrl.trim(),feedUrl:u.feedUrl.trim(),hidden:u.hidden,disabled:u.disabled,isFullText:u.crawler};g.feedUrl?await O(m.key,g):w.error("Feed URL cannot be empty")},children:[e.jsx(D.Item,{label:"Category",required:!0,field:"category",rules:[{required:!0}],children:e.jsx(R,{placeholder:"Please select",children:t.map(u=>e.jsx(R.Option,{value:u.id,children:u.title},u.id))})}),e.jsx(D.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(_,{placeholder:"Please input feed title"})}),e.jsx(D.Item,{label:"Site URL",field:"siteUrl",rules:[{required:!0}],children:e.jsx(_,{placeholder:"Please input site URL"})}),e.jsx(D.Item,{label:"Feed URL",field:"feedUrl",rules:[{required:!0}],children:e.jsx(_,{placeholder:"Please input feed URL"})}),e.jsx(D.Item,{label:"Hidden",field:"hidden",initialValue:m.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(J,{})}),e.jsx(D.Item,{label:"Disabled",field:"disabled",initialValue:m.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(J,{})}),e.jsx(D.Item,{label:"Fetch original content",field:"crawler",tooltip:e.jsx("div",{children:"Only affects newly retrieved articles"}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(J,{})})]})})]})},Zr=()=>{const{homePage:t,markReadOnScroll:s,orderBy:r,pageSize:n,removeDuplicates:a,showStatus:o}=x(U);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Default show status"}),e.jsx(y.Text,{type:"secondary",children:"Which status to show by default:"})]}),e.jsx("div",{children:e.jsxs(R,{className:"input-select",placeholder:"Select status",value:o,onChange:i=>{K({showStatus:i}),Ie(i)},children:[e.jsx(R.Option,{value:"all",children:"All"}),e.jsx(R.Option,{value:"unread",children:"Unread"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Default home page"}),e.jsx(y.Text,{type:"secondary",children:"Which page to show by default:"})]}),e.jsx("div",{children:e.jsxs(R,{className:"input-select",onChange:i=>K({homePage:i}),placeholder:"Select page",value:t,children:[e.jsx(R.Option,{value:"all",children:"All"}),e.jsx(R.Option,{value:"today",children:"Today"}),e.jsx(R.Option,{value:"starred",children:"Starred"}),e.jsx(R.Option,{value:"history",children:"History"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Entries order"}),e.jsx(y.Text,{type:"secondary",children:"What order to show entries:"})]}),e.jsx("div",{children:e.jsxs(R,{className:"input-select",onChange:i=>K({orderBy:i}),placeholder:"Select order",value:r,children:[e.jsx(R.Option,{value:"published_at",children:"Published at"}),e.jsx(R.Option,{value:"created_at",children:"Created at"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Entries per page"}),e.jsx(y.Text,{type:"secondary",children:"Show how many entries per page:"})]}),e.jsx("div",{children:e.jsx(Fs,{className:"input-select",defaultValue:n,min:1,mode:"button",onChange:i=>K({pageSize:i}),size:"small"})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Remove duplicate articles"}),e.jsx(y.Text,{type:"secondary",children:"Automatically remove duplicate articles based on:"})]}),e.jsx("div",{children:e.jsxs(R,{className:"input-select",onChange:i=>K({removeDuplicates:i}),placeholder:"Select option",value:a,children:[e.jsx(R.Option,{value:"none",children:"None"}),e.jsx(R.Option,{value:"hash",children:"Hash"}),e.jsx(R.Option,{value:"title",children:"Title"}),e.jsx(R.Option,{value:"url",children:"URL"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Mark articles as read when scrolled off screen"}),e.jsx(y.Text,{type:"secondary",children:"Automatically mark articles as read when they are scrolled out of the visible screen area"})]}),e.jsx("div",{children:e.jsx(J,{checked:s,onChange:i=>K({markReadOnScroll:i})})})]})]})},en=[{title:"Key",dataIndex:"keyName",render:t=>e.jsx(ue,{children:t})},{title:"Function",dataIndex:"description"}],tn=[{key:"1",keyName:"Esc",description:"Exit the article view and return to the list."},{key:"2",keyName:"â†",description:"Navigate to the previous article in the list."},{key:"3",keyName:"Ctrl + â†",description:"Navigate to the previous unread article in the list."},{key:"4",keyName:"â†’",description:"Navigate to the next article in the list."},{key:"5",keyName:"Ctrl + â†’",description:"Navigate to the next unread article in the list."},{key:"6",keyName:"B",description:"Open the current article's link in a new browser tab."},{key:"7",keyName:"D",description:"Fetch and display the original content of the current article."},{key:"8",keyName:"M",description:"Toggle the read status of the current article."},{key:"9",keyName:"S",description:"Toggle the star status (bookmark) of the current article."},{key:"10",keyName:"V",description:"Open the photo slider for viewing all images in the current article."}],sn=()=>e.jsx(Ft,{borderCell:!0,columns:en,data:tn,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}}),rn=()=>{const t=(s,r)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[s,e.jsx("div",{style:{fontSize:"12px"},children:r})]});return e.jsxs(ae,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(ae.TabPane,{title:t(e.jsx(Ts,{style:{fontSize:"20px"}}),"Feeds"),children:e.jsx(Qr,{})},"1"),e.jsx(ae.TabPane,{title:t(e.jsx(Is,{style:{fontSize:"20px"}}),"Categories"),children:e.jsx(Gr,{})},"2"),e.jsx(ae.TabPane,{title:t(e.jsx(Es,{style:{fontSize:"20px"}}),"General"),children:e.jsx(Zr,{})},"3"),e.jsx(ae.TabPane,{title:t(e.jsx(Ns,{style:{fontSize:"20px"}}),"Appearance"),children:e.jsx(Kr,{})},"4"),e.jsx(ae.TabPane,{title:t(e.jsx(As,{style:{fontSize:"20px"}}),"Hotkeys"),children:e.jsx(sn,{})},"5")]})},nn=[{required:!0}],an=[{required:!0}],on=[{type:"boolean"}],ln=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=Ye();return e.jsx(Z,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(rn,{})})},cn=()=>{const t=x(me),{addFeedModalVisible:s,setAddFeedModalVisible:r}=Ye(),[n,a]=p.useState(!1),[o]=D.useForm(),i=async(c,l,d)=>{a(!0);try{await Ir(c,l,d),await Ze(),w.success("Added a feed successfully"),r(!1),o.resetFields()}catch{w.error("Failed to add a feed")}finally{a(!1)}};return e.jsx(Z,{title:"Add Feed",visible:s,unmountOnExit:!0,style:{width:"400px"},onOk:o.submit,confirmLoading:n,onCancel:()=>{r(!1),o.resetFields()},children:e.jsxs(D,{form:o,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async c=>{const l=c.url.trim();l?await i(l,c.category,c.crawler):w.error("Feed URL cannot be empty")},children:[e.jsx(D.Item,{label:"Feed URL",field:"url",rules:nn,children:e.jsx(_,{placeholder:"Please input a feed URL"})}),e.jsx(D.Item,{field:"category",label:"Category",required:!0,rules:an,children:e.jsx(R,{placeholder:"Please select a category",showSearch:!0,filterOption:(c,l)=>Se(l.props.children,c),children:t.map(c=>e.jsx(R.Option,{value:c.id,children:c.title},c.id))})}),e.jsx(D.Item,{field:"crawler",initialValue:!1,label:"Fetch original content",rules:on,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(J,{})})]})})},dn=()=>e.jsxs("div",{className:"main",children:[e.jsx(Ms,{}),e.jsx(ln,{}),e.jsx(cn,{})]}),Jt=()=>{const{theme:t,themeColor:s}=x(U),[r,n]=p.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);p.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),o=i=>n(i.matches);return a.addEventListener("change",o),()=>a.removeEventListener("change",o)},[]),p.useEffect(()=>{const a=o=>{const i=o?"dark":"light";document.body.setAttribute("arco-theme",i),document.body.style.colorScheme=i};Gt(s),a(t==="system"?r:t==="dark")},[r,t,s])},un=()=>{Jt();const{isBelowLarge:t}=he();return e.jsxs("div",{className:"app",children:[t?null:e.jsx(Rs.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(Kt,{})}),e.jsx(Wr,{}),e.jsx(dn,{})]})},Qt=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},He=t=>{var a;const n=(a=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:a.getAttribute("src");return{...t,imgSrc:n}},Zt=kt(!1),xt=N(Zt),nt=()=>{const{filterStatus:t,offset:s,unreadOffset:r}=x(T),{pageSize:n}=x(U),a=x(Zt),o=c=>{const l=(d,h)=>h.filter(m=>!d.some(b=>b.id===m.id));t==="all"?(fe(d=>[...d,...l(d,c)]),Ht(d=>d+n)):(pe(d=>[...d,...l(d,c)]),Me(d=>d+n))};return{handleLoadMore:async c=>{xt(!0);try{let l;if(t==="all"?l=await c(s+n):l=await c(r,t),l!=null&&l.entries){const d=l.entries.map(He);o(d)}}catch(l){console.error("Error fetching more articles: ",l)}finally{xt(!1)}},loadingMore:a}},at=Re({isPhotoSliderVisible:!1,selectedIndex:0}),hn=N(at,"isPhotoSliderVisible"),mn=N(at,"selectedIndex"),es=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=x(at);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:hn,selectedIndex:s,setSelectedIndex:mn}},ts=t=>{const{activeContent:s,filterStatus:r}=x(T),n=x(rt),a=x(tt),o=x(st),{isPhotoSliderVisible:i,setIsPhotoSliderVisible:c,setSelectedIndex:l}=es(),{loadingMore:d}=nt(),[h,m]=p.useState(!1),[b,f]=p.useState(!1);p.useEffect(()=>{b&&!d&&(m(!1),f(!1),P())},[b,d]),p.useEffect(()=>{if(s){const u=document.querySelector(".card-custom-selected-style");u&&u.scrollIntoView({behavior:"smooth",block:"nearest"})}},[s]);const S=(u,g)=>{var v;s&&(G(null),u.current&&(u.current.setAttribute("tabIndex","-1"),u.current.focus()),(v=g.current)==null||v.scrollTo(0,0))},C=(u=!1)=>{const g=n.findIndex(v=>v.id===(s==null?void 0:s.id));if(g>0){const v=u?n.slice(0,g).toReversed().find(k=>k.status==="unread"):n[g-1];v&&t(v)}},P=(u=!1)=>{var I;if(h)return;const g=n.findIndex($=>$.id===(s==null?void 0:s.id));if(g===n.length-1&&(r==="all"&&o||a)){m(!0),f(!0);return}if(g===-1){(I=document.querySelector(".entry-list"))==null||I.scrollTo(0,0);return}const k=u?n.slice(g+1).find($=>$.status==="unread"):n[g+1];k&&(t(k),f(!1))};return{exitDetailView:S,fetchOriginalArticle:u=>{s&&u()},navigateToNextArticle:P,navigateToPreviousArticle:C,openLinkExternally:()=>{s&&window.open(s.url,"_blank")},openPhotoSlider:()=>{!s||!Qt(s.content).length||i||(l(0),c(!0),ie(!1))},toggleReadStatus:u=>{s&&u()},toggleStarStatus:u=>{s&&u()}}},fn=({handleEntryClick:t,entryListRef:s,entryDetailRef:r})=>{const{activeContent:n}=x(T),{handleFetchContent:a,handleToggleStarred:o,handleToggleStatus:i}=et(),{exitDetailView:c,navigateToNextArticle:l,navigateToPreviousArticle:d}=ts(t);if(!n)return null;const h=n.status==="unread",m=n.starred;return e.jsxs(L.Group,{className:"action-buttons",children:[e.jsx(L,{icon:e.jsx(Ls,{}),onClick:()=>c(s,r),shape:"round",type:"primary"}),e.jsx(L,{icon:h?e.jsx(It,{}):e.jsx(Et,{}),onClick:()=>i(n),type:"primary"}),e.jsx(L,{icon:m?e.jsx(Ke,{style:{color:"#ffcd00"}}):e.jsx(We,{}),onClick:()=>o(n),type:"primary"}),e.jsx(L,{icon:e.jsx(Ps,{}),onClick:()=>d(),type:"primary"}),e.jsx(L,{icon:e.jsx(Ds,{}),onClick:()=>l(),type:"primary"}),e.jsx(L,{icon:e.jsx(Us,{}),onClick:a,shape:"round",type:"primary"})]})},pn=({url:t,text:s})=>{const[r,n]=p.useState(!1),a=()=>n(!r);return e.jsx(_s,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:a,onMouseLeave:a,children:s})},yt=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var S;const{fontSize:a}=x(U),[o,i]=p.useState(!1),[c,l]=p.useState(!1),{isBelowMedium:d}=he();p.useEffect(()=>{const P=(n?t.children[0]:t).attribs.src,E=new Image;E.src=P,E.onload=()=>l(E.width<=64&&E.height<=64)},[t,n]);const h=n?t.children[0]:t,m=()=>e.jsx("img",{...h.attribs,alt:h.attribs.alt??"image",style:c?{display:"inline-block",width:"auto",height:`${a}rem`,margin:0}:{}});if(c)return n?e.jsxs("a",{...t.attribs,children:[m(),(S=t.children[1])==null?void 0:S.data]}):m();const b=()=>i(!0),f=()=>i(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:b,onMouseLeave:f,children:[n?e.jsx("a",{...t.attribs,children:m()}):m(),e.jsx(L,{icon:e.jsx(zs,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:d||o?1:0,transition:"opacity 0.3s"},onClick:C=>{C.preventDefault(),r(s)}})]})})},gn=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const n=r.children[0];if(n.type==="tag"&&n.name==="img"){const a=t.findIndex(o=>o===n.attribs.src);return e.jsx(yt,{node:r,index:a,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const n=t.findIndex(a=>a===r.attribs.src);return e.jsx(yt,{node:r,index:n,togglePhotoSlider:s})}return r}}),xn=p.forwardRef(({handleEntryClick:t,entryListRef:s},r)=>{const n=te(),{activeContent:a}=x(T),{articleWidth:o,fontSize:i}=x(U),{isPhotoSliderVisible:c,setIsPhotoSliderVisible:l,selectedIndex:d,setSelectedIndex:h}=es(),m=()=>{Ne("author"),Ee(a.author)},b=j=>{h(j),l(M=>!M),ie(M=>!M)};if(p.useEffect(()=>{var M;const j=(M=r.current)==null?void 0:M.querySelector(".scroll-container");j&&(j.scrollTo(0,0),j.setAttribute("tabIndex","-1"),setTimeout(()=>{j.focus()},200))},[a==null?void 0:a.id]),!a)return e.jsxs("div",{ref:r,className:"content-empty",children:[e.jsx(Os,{style:{fontSize:"64px"}}),e.jsx(y.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const f=Qt(a.content),S=gn(f,b),C=$s(a.content,S),{id:P,title:E}=a.feed.category;return e.jsxs("div",{className:"article-content",onBlur:()=>ie(!1),onFocus:()=>ie(!0),ref:r,children:[e.jsxs("div",{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${o}%`},children:[e.jsx(y.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(y.Text,{children:e.jsx(pn,{url:`/feed/${a.feed.id}`,text:a.feed.title})}),e.jsx(y.Text,{onClick:m,style:{cursor:"pointer"},children:` - ${a.author}`}),e.jsx(y.Text,{children:e.jsx(ue,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>n(`/category/${P}`),children:E})})]}),e.jsx(y.Text,{className:"article-date",children:q(a.published_at).format("dddd, MMMM D, YYYY [at] h:mm A")}),e.jsx(H,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${i}rem`,width:`${o}%`},children:[C,e.jsx(Vs,{images:f.map(j=>({src:j,key:j})),loop:!1,visible:c,onClose:()=>{l(!1),ie(!0)},index:d,onIndexChange:h})]},a.id)]}),e.jsx(fn,{handleEntryClick:t,entryListRef:s,entryDetailRef:r})]})}),yn=({alt:t,borderRadius:s,height:r,src:n,status:a,width:o})=>{const[i,c]=p.useState(!1),{ref:l}=Pe({triggerOnce:!0,onChange:(d,h)=>{if(d&&!i){const m=new Image;m.onload=()=>c(!0),m.onerror=()=>{h.target.style.display="none"},m.src=n}}});return e.jsx("div",{className:"image-container",ref:l,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:i?e.jsx("img",{className:a==="unread"?"":"read",src:n,alt:t,style:{width:o,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(ve,{text:{rows:0},image:{style:{width:o,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},jn=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(yn,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},bn=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:a}=x(U),o=Le({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:o,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:t.imgSrc?r?"0 10px 0 0":"0 0 10px 0":"0"},children:e.jsx(jn,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(y.Text,{className:"article-card-title",children:t.title}),e.jsxs(y.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(qt,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Pt(t.published_at,a)]}),t.starred&&e.jsx(Ke,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},wn=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:a,showFeedIcon:o}=x(U),{activeContent:i}=x(T),c=i&&t.id===i.id,{handleToggleStarred:l,handleToggleStatus:d}=et(),[h,m]=p.useState(0),b=100,f=.5,S=t.starred,C=t.status==="unread",P=Bs({preventScrollOnSwipe:!0,delta:b/2,onSwiping:k=>{const I=Math.min(Math.abs(k.deltaX*f),b)*Math.sign(k.deltaX);m(I)},onSwiped:async k=>{try{k.deltaX>b?(await l(t),w.success(S?"Unmarked as starred":"Marked as starred")):k.deltaX<-b&&(await d(t),w.success(C?"Marked as read":"Marked as unread"))}catch{w.error("Failed to update, please try again")}m(0)}}),[E,j]=p.useState(!1),[M,W]=p.useState(!1),O=()=>d(t),u=20,{ref:g}=Pe({skip:M,onChange:async(k,I)=>{if(!(!a||!C)){if(k)j(!0);else if(E){const{top:$}=I.boundingClientRect;$<u&&(await O(),W(!0))}}}}),v=Hs({x:h});return p.createElement("div",{...P,className:"article-card",key:t.id},e.jsxs("div",{ref:g,children:[e.jsx(qs.div,{className:"swipe-card",style:v,children:e.jsx(Fe,{className:Le("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":c}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Fe.Meta,{description:e.jsx(bn,{entry:t,showFeedIcon:o,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:S?e.jsx(Ke,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(We,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:C?e.jsx(It,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(Et,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},Sn=()=>{const{layout:t}=x(U),{loading:s}=x(T),r=t==="large"?2:4,n=a=>e.jsx(Fe,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Fe.Meta,{description:e.jsx(ve,{loading:s,animation:!0,text:{rows:3,width:150}})})},a);return s?Array.from({length:r},(a,o)=>n(o)):null},vn=()=>{const{orderDirection:t}=x(U),{filterString:s,filterType:r}=x(T),{isBelowMedium:n}=he(),a=()=>{K({orderDirection:t==="desc"?"asc":"desc"})};return p.useEffect(()=>{Ne("title"),Ee("")},[]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(_.Search,{allowClear:!0,onChange:Ee,placeholder:"Search...",style:{width:n?"100%":278,marginLeft:8},value:s,addBefore:e.jsxs(R,{placeholder:"Select type",onChange:Ne,style:{width:100},value:r,children:[e.jsx(R.Option,{value:"title",children:"Title"}),e.jsx(R.Option,{value:"content",children:"Content"}),e.jsx(R.Option,{value:"author",children:"Author"})]})}),e.jsx(de,{mini:!0,content:t==="desc"?"Newest first":"Oldest first",children:e.jsx(L,{shape:"circle",size:"small",style:{margin:"0 8px",flexShrink:0},icon:t==="desc"?e.jsx(Ws,{}):e.jsx(Ks,{}),onClick:a})})]})},Cn=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},kn=(t,s,r)=>{p.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},Fn=({duration:t,color:s})=>{const[r,n]=p.useState([]);kn(r.length,t,()=>{n([])});const a=o=>{const i=o.currentTarget.getBoundingClientRect(),c=i.width>i.height?i.width:i.height,l=o.pageX-i.x-c/2,d=o.pageY-i.y-c/2,h={x:l,y:d,size:c,id:`${new Date().getTime()}-${l}-${d}`};n([...r,h])};return e.jsx("div",{className:"ripple-container",onMouseDown:a,children:r.length>0&&r.map(o=>e.jsx("span",{className:"ripple-span",style:{top:o.y,left:o.x,width:o.size,height:o.size,backgroundColor:s,animationDuration:`${t}ms`}},o.id))})},Tn=({getEntries:t})=>{const{filterStatus:s,loading:r}=x(T),n=x(tt),a=x(st),{loadingMore:o,handleLoadMore:i}=nt(),{ref:c}=Pe({skip:!(a||n),onChange:async l=>{!l||r||o||await i(t)}});return!r&&(s==="all"?a:n)&&e.jsxs("div",{className:"load-more-container",ref:c,children:[e.jsx(Ys,{loading:o,style:{paddingRight:"10px"}}),"Loading more ..."]})},In=p.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:a,pageSize:o}=x(U),i=a==="small",{loading:c}=x(T),l=x(rt),d=l.length-Math.ceil(o*.2)-1,h=x(tt),m=x(st),{loadingMore:b,handleLoadMore:f}=nt(),{ref:S}=Pe({skip:!(m||h),onChange:async j=>{!j||c||b||await f(t)}}),C=Gs({count:l.length,getScrollElement:()=>r.current,estimateSize:()=>i?120:280}),P=C.getVirtualItems(),E=p.useCallback(j=>j===d?Cn(C.measureElement,S):C.measureElement,[d,C.measureElement,S]);return e.jsxs(e.Fragment,{children:[e.jsx(vn,{}),e.jsxs("div",{className:"entry-list",ref:n,children:[e.jsx(Sn,{}),!c&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:C.getTotalSize(),width:"100%",position:"relative"},children:P.map(j=>e.jsx("div",{"data-index":j.index,ref:E(j.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${j.start}px)`},children:e.jsx(wn,{entry:l[j.index],handleEntryClick:s,mini:i,children:e.jsx(Fn,{color:"var(--color-text-4)",duration:1e3})})},j.key))})}),e.jsx(Tn,{getEntries:t})]})]})}),En=()=>{fe(t=>t.map(s=>({...s,status:"read"}))),pe(t=>t.map(s=>({...s,status:"read"}))),Ae(0)},Nn=p.forwardRef(({info:t,refreshArticleList:s,markAllAsRead:r},n)=>{const{filterStatus:a,loading:o}=x(T),i=async()=>{try{await r(),await Ze(),En(),w.success("All articles marked as read")}catch{w.error("Failed to mark all as read")}},c=l=>{n.current&&n.current.scrollTo(0,0),Ie(l)};return p.useEffect(()=>{Ne("title"),Ee("")},[a]),e.jsxs("div",{className:"entry-panel",children:[!["starred","history"].includes(t.from)&&e.jsx(Tt,{focusLock:!0,title:"Mark All As Read?",onOk:i,children:e.jsx(L,{icon:e.jsx(vt,{}),shape:"circle"})}),e.jsx(Xs.Group,{disabled:t.from==="history",onChange:c,options:[{label:"ALL",value:"all"},{label:"UNREAD",value:"unread"}],type:"button",value:a}),e.jsx(L,{icon:e.jsx(ke,{}),loading:o,shape:"circle",onClick:s})]})}),le=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleFocused:a,loading:o}=x(T),{isAppDataReady:i}=x(B),{orderBy:c,orderDirection:l,showStatus:d}=x(U),h=x(rt),{handleFetchContent:m,handleToggleStarred:b,handleToggleStatus:f,handleEntryStatusUpdate:S}=et(),[C,P]=p.useState(!1),E=p.useRef(null),j=p.useRef(null),M=p.useRef(null);p.useEffect(()=>{!C||["starred","history"].includes(t.from)||ce()},[c]),p.useEffect(()=>{["starred","history"].includes(t.from)?Ie("all"):Ie(d),_r(t.from),ce()},[t,l]);const W=async A=>{if(G(null),A.status!=="unread"){setTimeout(()=>{G({...A,status:"read"})},200);return}try{setTimeout(()=>{G({...A,status:"read"}),S(A,"read")},200),await De([A.id],"read")}catch{w.error("Failed to mark entry as read, please try again later"),S(A,"unread")}},{exitDetailView:O,fetchOriginalArticle:u,navigateToNextArticle:g,navigateToPreviousArticle:v,openLinkExternally:k,openPhotoSlider:I,toggleReadStatus:$,toggleStarStatus:se}=ts(W);p.useEffect(()=>{const A={ArrowLeft:()=>v(),ArrowRight:()=>g(),Escape:()=>O(E,M),b:k,d:()=>u(m),m:()=>$(()=>f(n)),s:()=>se(()=>b(n)),v:I},V=X=>{const ne=A[X.key];ne&&(X.key==="ArrowLeft"?v(X.ctrlKey):X.key==="ArrowRight"?g(X.ctrlKey):ne())};return a?document.addEventListener("keydown",V):document.removeEventListener("keydown",V),()=>{document.removeEventListener("keydown",V)}},[n,h,a]);const ge=(A,V,X,ne)=>{fe(A),pe(V),zr(X.total),Ae(ne.total)},Ue=(A,V)=>{if(A!=null&&A.entries&&(V==null?void 0:V.total)>=0){const X=A.entries.map(He),ne=V.entries.map(He);ge(X,ne,A,V)}},re=async()=>{mt(!0);try{const A=await s(),V=t.from==="history"?A:await s(0,"unread");Ue(A,V)}catch(A){console.error("Error fetching articles: ",A)}finally{mt(!1)}},ce=async()=>{var A;if((A=E.current)==null||A.scrollTo(0,0),Ht(0),Me(0),!i){await Ze();return}await re()};return p.useEffect(()=>{n&&G(null)},[]),p.useEffect(()=>{if(!i)try{re(),P(!0),ie(!0)}catch{w.error("Failed to fetch articles, please try again later")}},[i]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(dt,{in:!o,timeout:200,nodeRef:j,classNames:"fade",children:e.jsx(In,{cardsRef:j,getEntries:s,handleEntryClick:W,ref:E})}),e.jsx(Nn,{info:t,refreshArticleList:ce,markAllAsRead:r,ref:E})]}),e.jsx(dt,{in:n!==null,timeout:200,nodeRef:M,classNames:"fade",unmountOnExit:!0,children:e.jsx(xn,{handleEntryClick:W,entryListRef:E,ref:M})})]})},An=()=>e.jsx(le,{info:{from:"all",id:""},getEntries:vr,markAllAsRead:Mr}),Mn=()=>{const{id:t}=Nt(),{orderBy:s,pageSize:r}=x(U),n=async(a=0,o=null)=>{const i={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:a,limit:r,status:o};return F.get(oe(i))};return e.jsx(le,{info:{from:"category",id:t},getEntries:n,markAllAsRead:()=>gr(t)})},Rn=()=>{const t=te(),s=Js();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(Qs,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(L,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},Ln=()=>{const{id:t}=Nt(),{orderBy:s,pageSize:r}=x(U),n=async(a=0,o=null)=>{const i={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:a,limit:r,status:o};return F.get(oe(i))};return e.jsx(le,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>Nr(t)})},Pn=()=>e.jsx(le,{info:{from:"history",id:""},getEntries:Ut}),Dn="/assets/background-BMolBQF-.jpg",Un=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,a]of Object.entries(s))if(n!=="password"){const o=a==null?void 0:a.trim();t.setFieldValue(n,o),o||(r=!1)}else a||(r=!1);return r},je=(t,s)=>{t.key==="Enter"&&s.submit()},On=()=>{Jt();const[t]=Zs(),[s,r]=p.useState(!1),[n,a]=p.useState("token"),o=te(),i=async()=>{r(!0);const{server:l,token:d,username:h,password:m}=t.getFieldsValue();try{(await bt.raw("v1/me",{baseURL:l,headers:d?{"X-Auth-Token":d}:{Authorization:`Basic ${btoa(`${h}:${m}`)}`}})).status===200&&(w.success("Login successfully"),Rt({server:l,token:d,username:h,password:m}),o("/"))}catch(b){console.error(b),w.error(b.message)}r(!1)},c=async()=>{const l=t.getFieldsValue();if(!Je(l)){w.error("Please check your server address and credentials");return}await i()};return e.jsxs("div",{className:"page-layout",style:{height:"100%",display:"flex"},children:[e.jsx("div",{className:"form-panel",style:{backgroundColor:"var(--color-bg-1)",width:"50%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflowY:"auto",zIndex:2},children:e.jsxs("div",{className:"login-form",style:{width:"340px"},children:[e.jsx(y.Title,{heading:3,children:"Connect to your server"}),e.jsxs(D,{autoComplete:"off",form:t,layout:"vertical",onSubmit:async()=>{Un(t)?await c():w.error("Please fill in all required fields")},children:[e.jsx(D.Item,{field:"server",label:"Server address",rules:[{required:!0}],onKeyDown:l=>{je(l,t)},children:e.jsx(_,{disabled:s,placeholder:"Please input server address",prefix:e.jsx(er,{})})}),n==="token"&&e.jsx(D.Item,{field:"token",label:"API Token",rules:[{required:!0}],onKeyDown:l=>{je(l,t)},children:e.jsx(_.Password,{disabled:s,placeholder:"Please input API token",prefix:e.jsx(ut,{})})}),n==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(D.Item,{field:"username",label:"Username",rules:[{required:!0}],onKeyDown:l=>{je(l,t)},children:e.jsx(_,{disabled:s,placeholder:"Please input username",prefix:e.jsx(Ct,{})})}),e.jsx(D.Item,{field:"password",label:"Password",rules:[{required:!0}],onKeyDown:l=>{je(l,t)},children:e.jsx(_.Password,{disabled:s,placeholder:"Please input password",prefix:e.jsx(ut,{})})})]})]}),e.jsx(L,{loading:s,type:"primary",long:!0,onClick:()=>t.submit(),style:{marginTop:"20px"},children:"Connect"}),e.jsx(H,{orientation:"center",children:"Or connect with"}),e.jsx(L,{type:"secondary",long:!0,onClick:()=>a(n==="token"?"user":"token"),style:{marginTop:"20px"},children:n==="token"?"Username and password":"API Token"}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(y.Text,{disabled:!0,children:"Need more info?"}),e.jsx(tr,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:"Go to Miniflux official website"})]})]})}),e.jsx("div",{className:"background",style:{backgroundImage:`url(${Dn})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"50%",height:"100%"}})]})},$n=({children:t})=>{const s=x(Xe);return Je(s)?e.jsx(e.Fragment,{children:t}):e.jsx(At,{to:"/login"})},Vn=()=>e.jsx(le,{info:{from:"starred",id:""},getEntries:Dt}),_n=()=>{const t=async()=>{const s=await be(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=be(0,"unread",r).then(o=>o.entries));const a=n.map(o=>o.id);return De(a,"read")};return e.jsx(le,{info:{from:"today",id:""},getEntries:be,markAllAsRead:t})},zn=Y("homePage"),Bn=[{path:"/all",element:e.jsx(An,{})},{path:"/today",element:e.jsx(_n,{})},{path:"/starred",element:e.jsx(Vn,{})},{path:"/history",element:e.jsx(Pn,{})},{path:"/category/:id",element:e.jsx(Mn,{})},{path:"/feed/:id",element:e.jsx(Ln,{})}],ss=sr([{path:"/",element:e.jsx($n,{children:e.jsx(un,{})}),errorElement:e.jsx(Rn,{}),children:[...Bn,{index:!0,element:e.jsx(At,{to:`/${zn}`,replace:!0})}]},{path:"/login",element:e.jsx(On,{})}]);rr.createRoot(document.getElementById("root")).render(e.jsx(nr,{locale:ar,children:e.jsx(ir,{router:ss})}));
